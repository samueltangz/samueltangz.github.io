<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>HKCERT CTF 2020 Postmortem :: Mystify</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="On August 2020, @blackb6a was invited to co-organize HKCERT CTF 2020 (which is held on November 2020) as one of the challenge authors. This is a CTF for secondary and tertiary students in Hong Kong. Although I had experience preparing CTFs earlier, this is actually the first CTF officially prepared by Black Bauhinia. I have written four challenges for this CTF - Sanity Check II (Web), LF2 (Reverse), Sign In Please (Crypto) and Calm Down (Crypto)." />
<meta name="keywords" content="ctf" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://mystiz.hk/posts/2021/2021-03-28-hkcert-ctf/" />




<link rel="stylesheet" href="https://mystiz.hk/assets/style.css">

  <link rel="stylesheet" href="https://mystiz.hk/assets/mystiz.css">






<link rel="apple-touch-icon" href="https://mystiz.hk/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://mystiz.hk/img/favicon/mystiz.png">





<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://mystiz.hk/images/2021-03-28-hkcert-ctf/sanity-check.png" />


  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="mystiz613" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HKCERT CTF 2020 Postmortem">
<meta property="og:description" content="On August 2020, @blackb6a was invited to co-organize HKCERT CTF 2020 (which is held on November 2020) as one of the challenge authors. This is a CTF for secondary and tertiary students in Hong Kong. Although I had experience preparing CTFs earlier, this is actually the first CTF officially prepared by Black Bauhinia. I have written four challenges for this CTF - Sanity Check II (Web), LF2 (Reverse), Sign In Please (Crypto) and Calm Down (Crypto). There will also be some stories behind the scenes." />
<meta property="og:url" content="https://mystiz.hk/posts/2021/2021-03-28-hkcert-ctf/" />
<meta property="og:site_name" content="Mystify" />

  <meta property="og:image" content="https://mystiz.hk/images/2021-03-28-hkcert-ctf/sanity-check.png">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-03-28 17:54:00 &#43;0800 &#43;0800" />












  <script data-ad-client="ca-pub-3220069814773012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>
<body class="mystiz">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Mystify
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about-me">About Me</a></li>
        
      
        
          <li><a href="/blogroll">Blogroll</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about-me">About Me</a></li>
      
    
      
        <li><a href="/blogroll">Blogroll</a></li>
      
    
      
        <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://mystiz.hk/posts/2021/2021-03-28-hkcert-ctf/">HKCERT CTF 2020 Postmortem</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-03-28 
      </span>
    
    
    <span class="post-author">:: Mystiz</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://mystiz.hk/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/hkcert-ctf/">hkcert-ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/challenge-writing/">challenge-writing</a>&nbsp;
    
  </span>
  

  

  
    <img src="https://mystiz.hk/images/2021-03-28-hkcert-ctf/sanity-check.png" class="post-cover center" alt="HKCERT CTF 2020 Postmortem" />
  

  <div class="post-content js-toc-content"><div>
        <p>On August 2020, <a href="https://twitter.com/blackb6a" target="_blank" rel="nofollow">@blackb6a</a> was invited to co-organize <a href="https://ctftime.org/event/1145">HKCERT CTF 2020</a> (which is held on November 2020) as one of the challenge authors. This is a CTF for secondary and tertiary students in Hong Kong. Although I had experience preparing CTFs earlier, this is actually the first CTF officially prepared by Black Bauhinia. I have written four challenges for this CTF - <em>Sanity Check II</em> (Web), <em>LF2</em> (Reverse), <em>Sign In Please</em> (Crypto) and <em>Calm Down</em> (Crypto). There will also be some stories behind the scenes.</p>

<div class="alert warning">
  <strong>Why writing something that happened half year ago?</strong> I don&rsquo;t have a particular reason for this, I think they should be documented for completeness.
</div>


<h2 id="challenges">Challenges<a href="#challenges" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="sanity-check-ii-web">Sanity Check II (Web)<a href="#sanity-check-ii-web" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="challenge-summary">Challenge Summary<a href="#challenge-summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>It is the easiest challenge amongst the ones that I created. There are 32 (out of 74) and 42 (out of 69) solves in the secondary and tertiary divisions respectively.</p>

<blockquote>
<p>Is your sanity enough? I afraid you are unable to face the upcoming challenges...</p>

<p><a href="http://HOST:PORT">http://HOST:PORT</a></p>
</blockquote>

<p>In the challenge, there is a web service for player to input his name. After that, there will be a battle between the players and Cthulhu. If the player beats Cthulhu, then he wins the flag. However, the battle logic is performed on the client side. The Docker environment is available <a href="https://github.com/samueltangz/ctf-archive-created/tree/master/20201006-hkcert-ctf/sanity-check/env">here</a>.</p>


  <figure class="center" >
    <img src="/images/2021-03-28-hkcert-ctf/sanity-check.png"   />
    
  </figure>



<h4 id="motivation">Motivation<a href="#motivation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>I have been wondering why the cthulhu-styled <em>sanity check</em> never appeared in CTFs, given that there's a sanity check challenge in most of them.</p>

<div class="alert warning">
  I am going to skip the solution as this is pretty straight-forward.
</div>


<h3 id="lf2-reverse">LF2 (Reverse)<a href="#lf2-reverse" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="challenge-summary-1">Challenge Summary<a href="#challenge-summary-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>There is a solve from the tertiary division and zero solves from the secondary division.</p>

<blockquote>
<p>Have you ever played Little Fighter 2? I have modified <em>stage.dat</em> to make the game more interesting. Of course, I hid a flag inside, too.</p>

<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20201006-hkcert-ctf/lf2/public/stage.dat">stage.dat</a></p>
</blockquote>

<p>The <code>stage.dat</code> provided is pretty much the same as the <code>stage.dat</code> given from v2.0a of LF2, except that the first 123 bytes are different.</p>

<h4 id="motivation-1">Motivation<a href="#motivation-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>Since I am hosting a CTF for Hong Kong, I wanted to create some questions about the city. For example, Little Fighter 2 (LF2) is a game made in Hong Kong that I liked when I was young. It was the first game that I tried to modify the data files to add more skills on characters at that time.</p>

<h4 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>The intended way will be reverse engineering the executable for the game, <code>lf2.exe</code>. The are functions those encrypt and decrypt <code>.dat</code> files. Let's see the function at <code>0x4146B0</code>, which encrypts raw content into a <code>.dat</code> file.</p>


  <figure class="center" >
    <img src="/images/2021-03-28-hkcert-ctf/lf2-1.png"   />
    
      <figcaption class="right" >This is a simple encryption function for data files.</figcaption>
    
  </figure>



<p>The decompiled code suggests how a raw content are encrypted:</p>

<ol>
<li>Prepend 123 bytes to the content <em>(Lines 22-30)</em>.</li>
<li>Encrypt the content with Vigenere cipher <em>(Lines 34-41)</em>.</li>
</ol>

<p>The key is given on line 13, too: <code>SiuHungIsAGoodBearBecauseHeIsVeryGood</code>. The first 123 bytes are dropped normally. It is however crucial in the challenge and let's keep them. Hence, it suffices to decrypt the data file with the below snippet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;stage.dat&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    d <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()

key <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;SiuHungIsAGoodBearBecauseHeIsVeryGood&#39;</span>

d <span style="color:#f92672">=</span> bytes([(d[i] <span style="color:#f92672">-</span> key[i <span style="color:#f92672">%</span> len(key)]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(d))])

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;stage&#39;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    f<span style="color:#f92672">.</span>write(d)</code></pre></div>
<p>The flag <code>hkcert20{lf2_i5_st1l1_awes0me}</code> is right in front of us. Yeah, LF2 is still awesome and there are still animated films<sup class="footnote-ref" id="fnref:lf2-animation"><a class="footnote" href="#fn:lf2-animation">1</a></sup> regarding to the game last month!</p>

<h5 id="an-easier-solution">An easier solution<a href="#an-easier-solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>

<p>Instead of reversing the binary of the game, reverse the data changers. For example, <a href="https://lf2odc.netlify.app/">LF2 - Online Data Changer</a> is written in JavaScript. The below snippet shows how they decrypt the data files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;odBearBecauseHeIsVeryGoodSiuHungIsAGo&#34;</span>;

<span style="color:#75715e">//Algorithm from here: http://www.lf-empire.de/forum/showthread.php?tid=10301
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">decrypt</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
    
    <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(){
        <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">result</span>;
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
        
        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">123</span>, <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">len</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">klen</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">key</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">len</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>, <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>)
            <span style="color:#a6e22e">text</span> <span style="color:#f92672">+=</span> String.<span style="color:#a6e22e">fromCharCode</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">charCodeAt</span>(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">key</span>.<span style="color:#a6e22e">charCodeAt</span>(<span style="color:#a6e22e">j</span><span style="color:#f92672">%</span><span style="color:#a6e22e">klen</span>));
        
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">editor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ace</span>.<span style="color:#a6e22e">edit</span>(<span style="color:#e6db74">&#34;DCode&#34;</span>);
        <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">setValue</span>(<span style="color:#a6e22e">text</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
        <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">setUndoManager</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ace</span>.<span style="color:#a6e22e">UndoManager</span>());
    };
    
    <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsBinaryString</span>(<span style="color:#a6e22e">file</span>);
}</code></pre></div>
<p>Here we have the encryption (and decryption) algorithm. We are able to retrieve the flag by patching the script to decrypt the first 123 bytes.</p>
















  


<video autoplay loop  style="width: 100%; margin: 0 auto; display: block;">
  <source src="/images/2021-03-28-hkcert-ctf/lf2-2.webm" type="video/webm">
</video>

<h3 id="sign-in-please-crypto">Sign In Please (Crypto)<a href="#sign-in-please-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="challenge-summary-2">Challenge Summary<a href="#challenge-summary-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>There is a solve from the tertiary division and zero solves from the secondary division.</p>

<blockquote>
<p>I have implemented a secure authentication system. You can't eavesdrop the passwords, can you?</p>

<p><code>nc HOST PORT</code></p>

<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20201006-hkcert-ctf/sign-in-please/public/chall.py">chall.py</a></p>
</blockquote>

<p>We are given ten attempts in total for <em>spy</em> or <em>auth</em>. The objective is to recover a 16-byte password $p$.</p>

<ul>
<li>For the <em>spy</em> request, we are able to fix a permutation-box <code>pbox</code> and a four-byte salt. The password along with the given salt will be permuted based on <code>pbox</code> and is hashed with SHA-256. The digest is returned.</li>
<li>For the <em>auth</em> request, we need to hash the password along with the salt and the P-box given by the server and return its digest. If it checks out with the expected result, we will be given the flag.</li>
</ul>

<p>Remarkably, the permutation-box is not necessarily <em>straight</em>. The only condition is <code>len(set(pbox)) == 20</code>. Let's have some examples:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">password <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ABCDEFGHIJKLMNOP&#39;</span>
salt     <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;0123&#39;</span>

<span style="color:#75715e"># Example 1</span>
pbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">19</span>]
permutated_password <span style="color:#f92672">=</span> permute(pbox, password, salt)
<span style="color:#66d9ef">assert</span> permutated_password <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ABCDEFGHIJKLMNOP0123&#39;</span>

<span style="color:#75715e"># Example 2</span>
pbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">18</span>]
permutated_password <span style="color:#f92672">=</span> permute(pbox, password, salt)
<span style="color:#75715e"># No way, only 19 distinct elements in pbox</span>

<span style="color:#75715e"># Example 3</span>
pbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>]
permutated_password <span style="color:#f92672">=</span> permute(pbox, password, salt)
<span style="color:#66d9ef">assert</span> permutated_password <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ABCDEFGHIJKLMNOP0123DD&#39;</span>

<span style="color:#75715e"># Example 4</span>
pbox <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">11</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">12</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">13</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">14</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">15</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">16</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">17</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">18</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">19</span>]
permutated_password <span style="color:#f92672">=</span> permute(pbox, password, salt)
<span style="color:#66d9ef">assert</span> permutated_password <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ABCDEFGHIJJIHGFEDCBA&#39;</span></code></pre></div>
<h4 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>The challenge exploits the Merkle-Damgard construction for SHA256 to reveal the secret. There is a <a href="https://hackmd.io/@amyriad/S1ilHjrtv">writeup</a> compiled by <em>TWY</em> from Firebird CTF team.</p>

<h3 id="calm-down-crypto">Calm Down (Crypto)<a href="#calm-down-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="challenge-summary-3">Challenge Summary<a href="#challenge-summary-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>There is a solve from the tertiary division. I expected this problem to be <em>very</em> challenging, we did not release this to the secondary division.</p>

<blockquote>
<p>I am so excited having a chance talking to Alice. She told me to calm down - and sent me an encrypted secret.</p>

<p><code>nc HOST PORT</code></p>

<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20201006-hkcert-ctf/calm-down/public/chall.py">chall.py</a></p>
</blockquote>

<p>We are given a RSA modulus $n$ and a ciphertext $c$ that contains the flag. We are also given an oracle $\mathscr{O}: \mathbb{Z} \rightarrow \{0, 1\}$, where</p>

<p><span  class="math">\[\mathscr{O}(c) = 1\Longleftrightarrow m = c^d\ \text{mod}\ n\wedge m\equiv 46\ (\text{mod}\ 256).\]</span></p>

<p>In short, the oracle takes a ciphertext $c$ and returns a positive result (<code>nice</code>) if and only if its corresponding plaintext ends with a fullstop (ASCII value being 46).</p>

<h4 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>The challenge is a variant of least significant oracle and the Bleichenbacher's attack for RSA. Unfortunately, the message is so small (relative to the modulus) that it can be solved with <em>binary search</em>, which is unintended. This is a <a href="https://hackmd.io/@hoifanrd/SyeYX-HFP">writeup</a> compiled by <em>hoifanrd</em> from Firebird CTF team.</p>

<h2 id="behind-the-scenes">Behind the Scenes<a href="#behind-the-scenes" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="burning-nice-challenge-ideas">Burning nice challenge ideas<a href="#burning-nice-challenge-ideas" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>Since this is the first CTF to high school students in Hong Kong, we wanted to make some interesting hacking challenges. One idea I had is Minecraft command injection. Suppose that we have a web interface that allows players to shoot arrows by setting initial velocity <code>Y</code> and <code>Z</code> below. The objective is to hit the bullseye with the spawned arrow.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">summon arrow 0 100 0 {Fire:200,Motion:[0.0,Y,Z]}</code></pre></div>
<p>That looks easy, right? Here is the twist: There is a glass wall in between. The video shows <code>Y = 0.5</code> and <code>Z = 3.6</code>:</p>
















  


<video autoplay loop  style="width: 80%; margin: 0 auto; display: block;">
  <source src="/images/2021-03-28-hkcert-ctf/minecraft-1.webm" type="video/webm">
</video>

<p>Let's cut the crap. Because that I did not properly validating the initial velocity, there is a <em>Minecraft</em>-style command injection. Looking at the <a href="https://minecraft.gamepedia.com/Commands/summon">summon</a> command, there is a parameter called <code>Passengers</code> where we can mount a creeper on the arrow. This is what we have:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Y = 0.5
Z = 3.6], Passengers:[{&#34;id&#34;:&#34;minecraft:creeper&#34;}</code></pre></div>















  


<video autoplay loop  style="width: 80%; margin: 0 auto; display: block;">
  <source src="/images/2021-03-28-hkcert-ctf/minecraft-2.webm" type="video/webm">
</video>

<p>By looking up the documentation for <a href="https://minecraft.gamepedia.com/Creeper">creeper</a>, there are two important NBT tags those are specific to creepers: <code>ignited</code> and <code>Fuse</code>. <code>ignited</code> is a boolean flag indicating that the creeper is ignited, and <code>Fuse</code> is the number of ticks for the creeper to explode after ignited. By trial-and-error, we find the best set of parameters for the arrow to penetrate the glass wall and hit the bullseye.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Y = 0.4
Z = 3.6], Passengers:[{&#34;id&#34;:&#34;minecraft:creeper&#34;,&#34;ignited&#34;:1b,&#34;Fuse&#34;:10b}</code></pre></div>















  


<video autoplay loop  style="width: 80%; margin: 0 auto; display: block;">
  <source src="/images/2021-03-28-hkcert-ctf/minecraft-3.webm" type="video/webm">
</video>

<p>Unfortunately, I was not motivated enough to make the challenge happen. I instead used this as an example when I deliver a workshop prior to the game. This actually attracted some students enrolling to the contest.</p>

<h3 id="interesting-flag-submissions-osint-master">Interesting flag submissions: OSINT master<a href="#interesting-flag-submissions-osint-master" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>During the contest, I found there are some strange attempts on the crypto challenges I made. One of the submission being:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">flag{is_solving_an_linear_modular_equation_that_is_disguised_as_an_rsa_challenge_fun?}</code></pre></div>
<p>I found this particularly funny, since that was actually the flag of a challenge I made (<a href="https://github.com/samueltangz/ctf-archive-created/tree/master/20200901-firebird-intro-ctf/rotten-secured-algorithm">challenge</a> and <a href="/posts/2020/2020-09-21-firebird-intro-ctf-rsa/">writeup</a> here). Nice try, but this is a crypto challenge instead of an OSINT one (and I am not well-known reusing challenges).</p>

<h3 id="cooperation-is-difficult">Cooperation is difficult<a href="#cooperation-is-difficult" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>There are a number of co-organizers who helped creating questions. Since we are the most experienced playing CTFs, we took the leading role to create challenges. There are two people I feel particularly frustrating while working with them.</p>

<p>When the deadline is approaching, some of them made a lot of guessy challenges and I was very frustrated. Well... I think they are just redefining CTF games in a weird way. This is an example of a <em>crypto</em> challenge they made, where I didn't even know how is the hint related. If you are interested about the solution, just Google the numbers. I even tweeted <a href="https://twitter.com/mystiz613/status/1313431818100563968">here</a> and <a href="https://twitter.com/mystiz613/status/1315489874477150209">there</a> without context at that time.</p>


  <figure class="center" >
    <img src="/images/2021-03-28-hkcert-ctf/riddle.png"   />
    
      <figcaption class="right" >I tried my best to protect the author's identity.</figcaption>
    
  </figure>



<p>Luckily, we are the leading team for problemsetting and are able to decide what challenges should be included in the game. Most guessy challenges are rejected and students need not to see them during the contest. This may seemed good for the participants, but definitely kills my brain cells. One co-organizating party felt bad when their challenges got rejected. Although I have documented the reasons why aren't the challenges accepted (for example, it is impossible to recover a 9-byte message encrypted with a variable-size XOR key), he just didn't read it and blamed me. Well... I will never want to work with them.</p>

<p>To express my discontent, There is a weird signature on each of the challenges I made (one in <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20201006-hkcert-ctf/calm-down/public/chall.py#L2">Calm down</a>). I was expecting that the co-organizers is aware of this during the review period. However, they didn't look at the challenges at all. We decided to release it in production. 😄</p>
<div class="footnotes">

<hr>

<ol>
<li id="fn:lf2-animation">Desmond Lo (2021) &quot;小朋友齊打交 LITTLE FIGHTER: REBORN - EP. 1&quot;<br><a href="https://www.youtube.com/watch?v=aBU3vFYea7U">https://www.youtube.com/watch?v=aBU3vFYea7U</a>
 <a class="footnote-return" href="#fnref:lf2-animation">↩</a></li>
</ol>
</div>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://mystiz.hk/posts/2021/2021-04-01-binary-exploitation-1/">
                <span class="button__icon">←</span>
                <span class="button__text">My Path of Binary Exploitation (1)</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://mystiz.hk/posts/2021/2021-02-28-aeroctf/">
                <span class="button__text">Aero CTF 2021 Writeup</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>


<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    HKCERT CTF 2020 Postmortem
  </a>
  <div class="js-toc"></div>
</aside>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
      headingSelector: 'h1, h2, h3, h4',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
</script>



  </div>
  <aside class="ads">
    
  
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-3220069814773012"
    data-ad-slot="6927401005"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  </aside>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://mystiz.hk/assets/main.js"></script>
<script src="https://mystiz.hk/assets/prism.js"></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }], trust: true })"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
<script>
var viz = new Viz();

document.querySelectorAll("[class=graphviz]").forEach(node => {
  const escape = function (s) {
    const t = s.replace(/&amp;/g, '&')
    return t.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#34;/g, '"')
  }
  viz.renderSVGElement(escape(node.innerText), {
    engine: 'dot'
  }).then(function (element) {
    node.parentNode.appendChild(element)
    node.style.display = 'none'
  })
})
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>
<link href="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram-min.min.css" rel="stylesheet" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram.min.js" crossorigin="anonymous"
  onload="
    Array.from(document.getElementsByClassName('sequence-diagram')).forEach(dom => {
      const content = new DOMParser().parseFromString(dom.innerHTML, 'text/html').documentElement.textContent;
      dom.innerHTML = '';
      Diagram.parse(content).drawSVG(dom, {
        theme: 'simple',
        'font-family': 'Fira Code'
      })
    })"></script>


  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VLBDVW913"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2VLBDVW913');
</script>




  
</div>

</body>
</html>
