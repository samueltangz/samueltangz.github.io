<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>HKCERT CTF 2023 Postmortem (III): The Remaining Challenges :: Mystify</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="We will finally cover the non-crypto challenges that I wrote for HKCERT CTF 2023. This includes one misc (Hackforces), two pwn (ISA Jump Scare &amp;amp; ISA Jogger) and two reverse (The Flag Game &amp;amp; Loot and Scoot) challenges.
Hackforces Challenge Summary  Do you know Codeforces? Well, what you need is to find a corner case to make the given submission not work.
http://HOST:PORT/
Attachments: hackforces.zip
 We are given an introductory competitive programming problem (equivalent to Unique Paths II in LeetCode) with its solution implemented in C." />
<meta name="keywords" content="ctf" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://mystiz.hk/posts/2024/2024-01-27-hkcert-ctf-3/" />




<link rel="stylesheet" href="https://mystiz.hk/assets/style.css">

  <link rel="stylesheet" href="https://mystiz.hk/assets/mystiz.css">






<link rel="apple-touch-icon" href="https://mystiz.hk/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://mystiz.hk/img/favicon/mystiz.png">





<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://mystiz.hk/images/2024-01-27-hkcert-ctf/cover-3.jpg" />


  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="mystiz613" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HKCERT CTF 2023 Postmortem (III): The Remaining Challenges">
<meta property="og:description" content="We will finally cover the non-crypto challenges that I wrote for HKCERT CTF 2023. This includes one misc (Hackforces), two pwn (ISA Jump Scare &amp; ISA Jogger) and two reverse (The Flag Game &amp; Loot and Scoot) challenges." />
<meta property="og:url" content="https://mystiz.hk/posts/2024/2024-01-27-hkcert-ctf-3/" />
<meta property="og:site_name" content="Mystify" />

  <meta property="og:image" content="https://mystiz.hk/images/2024-01-27-hkcert-ctf/cover-3.jpg">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2024-01-27 05:30:02 &#43;0800 &#43;0800" />












  <script data-ad-client="ca-pub-3220069814773012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>
<body class="mystiz">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Mystify
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about-me">About Me</a></li>
        
      
        
          <li><a href="/blogroll">Blogroll</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about-me">About Me</a></li>
      
    
      
        <li><a href="/blogroll">Blogroll</a></li>
      
    
      
        <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://mystiz.hk/posts/2024/2024-01-27-hkcert-ctf-3/">HKCERT CTF 2023 Postmortem (III): The Remaining Challenges</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2024-01-27 
      </span>
    
    
    <span class="post-author">:: Mystiz</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://mystiz.hk/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/hkcert-ctf/">hkcert-ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/challenge-writing/">challenge-writing</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/reverse/">reverse</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/pwn/">pwn</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/misc/">misc</a>&nbsp;
    
  </span>
  

  

  
    <img src="https://mystiz.hk/images/2024-01-27-hkcert-ctf/cover-3.jpg" class="post-cover center" alt="HKCERT CTF 2023 Postmortem (III): The Remaining Challenges" />
  

  <div class="post-content js-toc-content"><div>
        <p>We will finally cover the non-crypto challenges that I wrote for HKCERT CTF 2023. This includes one misc (Hackforces), two pwn (ISA Jump Scare &amp; ISA Jogger) and two reverse (The Flag Game &amp; Loot and Scoot) challenges.</p>
<h2 id="hackforces">Hackforces<a href="#hackforces" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary">Challenge Summary<a href="#challenge-summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Do you know <a href="http://codeforces.com/">Codeforces</a>? Well, what you need is to find a corner case to make the given submission <em>not</em> work.</p>
<p>http://HOST:PORT/</p>
<p>Attachments: <a href="https://github.com/blackb6a/hkcert-ctf-2023-challenges/releases/download/v1.0.0/hackforces_c9b284d8311d29dad10b20493e56ff9e.zip">hackforces.zip</a></p>
</blockquote>
<p>We are given an introductory competitive programming problem (equivalent to <a href="https://leetcode.com/problems/unique-paths-ii/">Unique Paths II in LeetCode</a>) with its solution implemented in C.</p>
<pre tabindex="0"><code class="language-c=" data-lang="c=">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#define N 102
#define MOD 1000000007

int main () {
    int m, n;
    char a[N][N];
    int dp[N][N];

    memset(dp, 0, sizeof dp);

    scanf(&quot;%d %d\n&quot;, &amp;m, &amp;n);
    for (int i = 0; i &lt; m; i++) {
        scanf(&quot;%s&quot;, a[i]);
    }

    int non_zero_count = 0;

    dp[0][0] = a[0][0] != 'x' ? 1 : 0;
    for (int i = 0; i &lt; m; i++) {
        for (int j = 0; j &lt; n; j++) {
            if (a[i][j] == 'x') continue;
            if (i &gt; 0) dp[i][j] = (dp[i][j] + dp[i-1][j]) % MOD;
            if (j &gt; 0) dp[i][j] = (dp[i][j] + dp[i][j-1]) % MOD;
            if (dp[i][j]) non_zero_count += 1;
        }
    }

    printf(&quot;%d\n&quot;, non_zero_count);
    for (int i = 0; i &lt; m; i++)
        for (int j = 0; j &lt; n; j++)
            if (dp[i][j] &gt; 0)
                printf(&quot;%d %d %d\n&quot;, i, j, dp[i][j]);
}
</code></pre><p>There is a platform for us to upload test cases, and the goal is to find an valid test case to the given program that generates a different verdict than &ldquo;ACCEPTED&rdquo;.</p>
<h3 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="where-is-the-bug">Where is the bug?<a href="#where-is-the-bug" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Note that we will be required to print all the number of paths to each <em>reachable</em> chamber. In the program, it is checked at line 33 and it is assumed that the chamber at $(i, j)$ is reachable if <code>dp[i][j] &gt; 0</code>.</p>
<p>Notably, <code>dp[i][j]</code> is the number of possible paths reaching $(i, j)$ modulo $10^9 + 7$. If the number of paths reaching $(i, j)$ is a multiple of $10^9 + 7$, <code>dp[i][j]</code> would be zero and it will be considered unreachable by the program.</p>
<p>Now we want to find a configuration such that there are $(10^9+7)k$ possible paths to a chamber. For simplicity, we will find a configuration such that there are $10^9 + 7$ paths to the bottom-right chamber.</p>
<h4 id="constructing-numbers">Constructing numbers<a href="#constructing-numbers" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>If there are $n+1$ rows and $m+1$ columns that fill with all dots, then there are $\text{C}^{n+m}_{m}$ paths from the top left to the bottom right. However, it is impossible to find small $n$ and $m$ such that $\text{C}^{n+m}_m$ is a multiple of $10^9 + 7$. Therefore we must find ways to &ldquo;combine&rdquo; the numbers.</p>
<p>Suppose that we have two grids that there are $a$ and $b$ paths from the top left to the bottom right. There will be $a + b$ and $a \cdot b$ ways to traverse from the top left to the bottom right, respectively.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/hackforces-operations.png"   />
    
  </figure>


<p>In our case, we will be using only the additive property. We will use the greedy algorithm to find a sum of $\text{C}^n_k$s such that they sum to $10^9 + 7$. One of the config I found is $\text{C}^{97}_6 + \text{C}^{69}_5 + \text{C}^{39}_5 + \text{C}^{44}_3 + \text{C}^{16}_2 + \text{C}^5_1$. Thus the sizes of the rectangle grids are $92 \times 7$, $65 \times 6$, $35 \times 6$, $42 \times 4$, $15 \times 3$ and $5 \times 2$.</p>
<p>We can build a test case from the above information and submit to the platform, and retrieve the flag: <code>hkcert23{h4v1n9_k_m0d_p_3qu4ls_zer0_d0e5n7_m34n_k_i5_23r0}</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">34 94
..............................................................................................
.x............................................................................................
.x............................................................................................
.x............................................................................................
.x............................................................................................
.x............................................................................................
.x............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
..............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxx.................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxx.................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxx.................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxx.................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxx.................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
..............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
..............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx..........................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx..........................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx..........................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
..............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...............
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...............
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
..............................................................................................
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.....
.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.
</code></pre></div><h2 id="isa-jump-scare">ISA Jump Scare<a href="#isa-jump-scare" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-1">Challenge Summary<a href="#challenge-summary-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Can you jump <code>flag.txt</code>, jump the content and jump them to me?</p>
<p>Web: <a href="http://bauhinia-isa-hwuj66.hkcert23.pwnable.hk:28900/?id=5">http://bauhinia-isa-hwuj66.hkcert23.pwnable.hk:28900/?id=5</a></p>
<p>What is ISA: <a href="https://hackmd.io/@blackb6a/bauhinia-isa">https://hackmd.io/@blackb6a/bauhinia-isa</a></p>
<p><strong>Note:</strong> There is a guide for this challenge <a href="https://hackmd.io/@blackb6a/hkcert-ctf-2023-i-en-a58d115f39feab46">here</a>.</p>
<p><strong>Note:</strong> You can find the flag at the file <code>flag.txt</code></p>
<p>Attachments: <a href="https://github.com/blackb6a/hkcert-ctf-2023-challenges/releases/download/v1.0.0/isa-jump-scare_9e0b5de4f92acff7b1af96d59cb3503f.zip">isa-jump-scare.zip</a></p>
</blockquote>
<p>In this challenge, we are asked to write a commentless program to read <code>flag.txt</code>. However, there is a catch: There is a checker that validates whether each line of the input program starts with a <code>JMP</code>.</p>
<h3 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Let&rsquo;s first have a look at the below ISA code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">0x400000: JMP 0x40000d; JMP 0x400000
          ⬆️

0x40001b: NOP
</code></pre></div><p>The program control (<code>PC</code>) would be <code>0x400000</code> (beginning of the code) when we run the program. In this case, the instruction to be executed would be <code>JMP 0x40000d</code>.</p>
<p>Although <code>0x40000d</code> is <em>not</em> a address of the beginning of an instruction, similar to a large number of <a href="https://devblogs.microsoft.com/oldnewthing/20220111-00/?p=106144">interpreters available in real life</a>, the interpreter simply parses the instruction starting from <code>PC</code>. In this case, <code>0x40000d</code> points at the beginning of the <code>JMP 0x400000</code> (which is intended to be a comment). The interpreter thinks that this would be the next instruction and decided to run <code>JMP 0x400000</code> afterwards.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">0x400000: JMP 0x40000d; JMP 0x400000
                        ⬆️

0x40001b: NOP
</code></pre></div><p>In this case, we can actually &ldquo;write&rdquo; two instructions in one line, and the comment is could be executed during runtime.</p>
<p>We will want to execute some other commands than <code>JMP</code> in the challenge. How do we achieve that? We can leverage the <code>JMP</code> instruction and jump to the address you want, even in the middle of an instruction.</p>
<p>Alas, the checker does not allow us to write comments. Fortunately the interpreter does not check whether the instructions are valid <em>at the beginning</em>. It would be fine as long as we are <em>not</em> running invalid instructions. This would be handy in our case.</p>
<p>To execute an arbitrary instruction, say <code>[INSTRUCTION]</code>, we can break down into two separate instructions which both of them start with <code>JMP</code>:</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">JMP +4
JMP [INSTRUCTION]
</code></pre><p>When the program control points to the beginning of the first instruction, it will jump four bytes ahead and point to <code>[INSTRUCTION]</code>. With this idea, we can write a program to read the flag: <code>hkcert23{jump_1n70_m1dd13_0f_1n57ruc710n_1s_r34l1y_fun}</code>.</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">JMP +4
JMP PUSH 0x7478742e
JMP +4
JMP PUSH 0x67616c66
JMP +4
JMP MOV R8, 3
JMP +4
JMP MOV R1, SP
JMP +4
JMP MOV R2, 0x410000
JMP +4
JMP MOV R3, 100
JMP +4
JMP SYSCALL
JMP +4
JMP MOV R8, 1
JMP +4
JMP MOV R1, 0x410000
JMP +4
JMP MOV R2, 100
JMP +4
JMP SYSCALL
JMP +4
JMP MOV R8, 2
JMP +4
JMP MOV R1, 0
JMP +4
JMP SYSCALL
</code></pre><h2 id="isa-jogger">ISA Jogger<a href="#isa-jogger" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-2">Challenge Summary<a href="#challenge-summary-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>I heard that <code>MOV</code> is Turing complete. Convince me by reading <code>flag.txt</code>!</p>
<p>Web: <a href="http://bauhinia-isa-hwuj66.hkcert23.pwnable.hk:28900/?id=6">http://bauhinia-isa-hwuj66.hkcert23.pwnable.hk:28900/?id=6</a></p>
<p>What is ISA: <a href="https://hackmd.io/@blackb6a/bauhinia-isa">https://hackmd.io/@blackb6a/bauhinia-isa</a></p>
<p><strong>Note:</strong> You can find the flag at the file <code>flag.txt</code></p>
<p>Attachments: <a href="https://github.com/blackb6a/hkcert-ctf-2023-challenges/releases/download/v1.0.0/isa-jogger_2f0b6c22aa5f1f87770f205016f44a1a.zip">isa-jogger.zip</a></p>
</blockquote>
<p>This challenge is similar to <a href="#isa-jump-scare">ISA Jump Scare</a>. Except that we are allowed to use only the <code>MOV</code> instruction instead of the <code>JMP</code> instruction.</p>
<h3 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>This time we are able to use only the <a href="https://hackmd.io/@blackb6a/bauhinia-isa#MOV-Move"><code>MOV</code></a> instruction. We are able to write to arbitrary memory segments, including the code segment. We can write a self-modifying code to evade the checker at the beginning. If there is a <code>PUSH</code> instruction after the check, it is still fine.</p>
<p>The instruction <code>MOV [R8+0x400123], 0x54534554</code> sets <code>TEST</code> to the address <code>0x400123</code> if <code>R8</code> is zero. With the idea, we can modify the end of the program to read the flag: <code>hkcert23{m0v_1s_7ur1n9_c0mp1373_4nd_y0u_ju5t_v3r1fi3d_th4t_f0r_m3}</code>.</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">MOV [R8+0x4004e3], 0x48535550
MOV [R8+0x4004e7], 0x37783020
MOV [R8+0x4004eb], 0x37383734
MOV [R8+0x4004ef], 0xa653234
MOV [R8+0x4004f3], 0x48535550
MOV [R8+0x4004f7], 0x36783020
MOV [R8+0x4004fb], 0x36313637
MOV [R8+0x4004ff], 0xa363663
MOV [R8+0x400503], 0x20564f4d
MOV [R8+0x400507], 0x202c3852
MOV [R8+0x40050b], 0x4f4d0a33
MOV [R8+0x40050f], 0x31522056
MOV [R8+0x400513], 0x5053202c
MOV [R8+0x400517], 0x564f4d0a
MOV [R8+0x40051b], 0x2c325220
MOV [R8+0x40051f], 0x34783020
MOV [R8+0x400523], 0x30303031
MOV [R8+0x400527], 0x4f4d0a30
MOV [R8+0x40052b], 0x33522056
MOV [R8+0x40052f], 0x3031202c
MOV [R8+0x400533], 0x59530a30
MOV [R8+0x400537], 0x4c414353
MOV [R8+0x40053b], 0x4d0a0a4c
MOV [R8+0x40053f], 0x5220564f
MOV [R8+0x400543], 0x31202c38
MOV [R8+0x400547], 0x564f4d0a
MOV [R8+0x40054b], 0x2c315220
MOV [R8+0x40054f], 0x34783020
MOV [R8+0x400553], 0x30303031
MOV [R8+0x400557], 0x4f4d0a30
MOV [R8+0x40055b], 0x32522056
MOV [R8+0x40055f], 0x3939202c
MOV [R8+0x400563], 0x5359530a
MOV [R8+0x400567], 0x4c4c4143
MOV [R8+0x40056b], 0x4f4d0a0a
MOV [R8+0x40056f], 0x38522056
MOV [R8+0x400573], 0xa32202c
MOV [R8+0x400577], 0x20564f4d
MOV [R8+0x40057b], 0x202c3152
MOV [R8+0x40057f], 0x59530a30
MOV [R8+0x400583], 0x4c414353
MOV [R8+0x400587], 0x4c
</code></pre><h2 id="the-flag-game">The Flag Game<a href="#the-flag-game" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-3">Challenge Summary<a href="#challenge-summary-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Did you beat The Password Game? Let&rsquo;s beat The Flag Game this time!</p>
<p>http://HOST:PORT/ (Docker environment available <a href="https://github.com/blackb6a/hkcert-ctf-2023-challenges/tree/master/01-the-flag-game/env">here</a>)</p>
</blockquote>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/the-flag-game-demo.png"   />
    
  </figure>


<p>We are shown a game similar to <a href="https://neal.fun/password-game/">the password game</a>, and no source code is given and we need to find a flag that satisfies all the rules.</p>
<h3 id="solution-3">Solution<a href="#solution-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="maybe-we-can-do-that-manually">Maybe we can do that manually?<a href="#maybe-we-can-do-that-manually" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>There are the first 25 rules:</p>
<ol>
<li>Your flag must be at least 6 characters.</li>
<li>Your flag must start with <code>hkcert23</code>.</li>
<li>Your flag must include exactly one <code>{</code> and one <code>}</code>.</li>
<li>The length of your flag must be a prime.</li>
<li>The digits in your flag must add up to 26.</li>
<li>The length of your flag must not be greater than the answer to the ultimate question of life, the universe, and everything.</li>
<li>Your flag must contain at least three underscores.</li>
<li>Your flag must not contain the substring <code>flag</code>.</li>
<li>Your flag must fulfil the flag format.</li>
<li>The number of digits in your flag must be a prime.</li>
<li>The number of <code>1</code>&rsquo;s in your flag must be thrice the number of <code>6</code>&rsquo;s in your flag.</li>
<li>At most 30% of your flag are digits.</li>
<li>Your flag must not contain any characters from <code>fail</code>.</li>
<li>Your flag must include at most two distinct vowels.</li>
<li>Your flag must include five characters, not necessarily distinct, from <code>mystiz</code>.</li>
<li>Your flag must contain exactly 20 distinct characters.</li>
<li>Your flag must not contain upper-case characters.</li>
<li>Your flag must contain the substring <code>y0u</code>.</li>
<li>Your flag must not contain consecutive double letters.</li>
<li>At least 40% of your flag are hexadecimal digits.</li>
<li>Your flag must match the REGEX <code>/[A-Za-z0-9]{9}/</code>.</li>
<li>The ASCII values of the characters in your flag must sum up to a multiple of 65.</li>
<li>Every occurrance of <code>n</code> in your flag must immediately followed by a digit.</li>
<li>No characters in your flag can occur more than 6 times.</li>
<li>Rule 22 should still be satisfied if each of the <code>3</code>s in your flag have been replaced by a <code>@</code>.</li>
</ol>
<p>Apparently, there is hope finding the flag. Maybe we can try harder&hellip;</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/the-flag-game-rule-29.png"   />
    
      <figcaption class="right" >What even is that rule?</figcaption>
    
  </figure>


<h4 id="doing-it-in-a-reverse-engineering-way">Doing it in a reverse engineering way<a href="#doing-it-in-a-reverse-engineering-way" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="alert warning">
  ✋🏾 <strong>Don&rsquo;t attempt manually.</strong> It might be a good idea doing it manually as to explore the challenge. However, it might be a rabbit hole because the text description might not reflect the actual rule correctly. On the other hand, the number of rules is unknown to us. Maybe there are 1000 or 10000?
</div>

<p>It is worth noting that the flag checking procedure is done solely on the client side. Thus we can read everything we need from the source code. Additionally, when we read <code>/js/app.38bf3c86.js</code>, we can see that there is a trailing line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//# sourceMappingURL=app.38bf3c86.js.map
</span></code></pre></div><p>This is a good sign, and we can see that there is a <code>/js/app.38bf3c86.js.map</code>. This is heavily used during development, because we are able to look up the line of code that causes unexpected errors, even if the code is minified. We are also to recover the source code from the source map, and the browsers are doing that automatically. For Chrome, we can go to &ldquo;Sources&rdquo; → &ldquo;Page&rdquo; and read the source code.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/the-flag-game-source-map.png"   />
    
  </figure>


<p>We can retrieve the full list of rules from the recovered <code>rules.js</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rules</span> <span style="color:#f92672">=</span> [{
  <span style="color:#75715e">// first 25 rules skipped
</span><span style="color:#75715e"></span>}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Your flag must reach a strength 4 in &lt;a href=&#34;https://dropbox.tech/security/zxcvbn-realistic-password-strength-estimation&#34; target=&#34;_blank&#34; ref=&#34;nofollow&#34;&gt;zxcvbn password test&lt;/a&gt;.&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">zxcvbn</span>(<span style="color:#a6e22e">u</span>).<span style="color:#a6e22e">score</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">4</span>
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Rule 20 should no longer be satisfied if all of the &lt;code&gt;d&lt;/code&gt;s in your flag are removed.&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/d/g</span>, <span style="color:#e6db74">&#39;&#39;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;&#39;</span>).<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">c</span> =&gt; <span style="color:#e6db74">&#39;0123456789abcdefABCDEF&#39;</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">c</span>)).<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/d/g</span>, <span style="color:#e6db74">&#39;&#39;</span>).<span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.4</span>
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̸͇̥͙̙̼̰̬͔̜̠̺̮̍̅̊͆͆̂͆̐͊̏͜͝͠ö̵͓̩̲̱͎̠͓̈́͂͂̑̆̌̈́̈́̀̔́̃͛̕u̷̜̜͎̼͙̝͋͆̿̄̕r̵̛͈͉͕̾͂̏̿͌̉ ̸̛̛̛̝̳̩̙͒̔͋ͅf̴͎̲͈̤̠̗͙̠̮͂̀̇̈́̊̄̏͊͘̕͘͘l̷̡͔̤̣̮̓̐̃̆̀̇̂̓͐͝ą̵̛̹͓͈̟͖̒̂̔̑̀̓̓̈̌̓͌͌̀̕ͅǧ̸̨̉̈́̑͋̀͘ ̸̨̺̬̾̓̃̌̔m̸͕̗̏̏̏̉̽͘͘u̵̡̧̢̺̮̘̪̖͖̗̝̲̥͌͂s̶̛̲̥̦̰̊̃́́̉̎̈̂͗͛́̌͘͝t̵̤̳̩͓̦̹͚̫̹̣̪̠͛̃̏́̓̽̃̈̉̐̿̄͋̑͜ ̷̛̭͙͔͉̪͍͖̪̥͙͓̱͍̉̓̈́́̾̎͋͊̈́̈̈́b̸̡̛̗͙̤̠͖̳̄̃̽͂͆͌͠͝e̵̢̛̬̼͖͕̰͍̳̠̟̱͍̞̼͍̍͌̀́́̐̅̽ ̸̛̞̙̓̓͊͛̉̓̀̀̍͋͗̕͘͝▒̴̡̱͋͒̋̐̈́█̴̲̈̀͊͐̀̐̓̆͆͒̊̈̑̐̕▒̷̢̮̗̤̙͖̤̎̿͐▓̸̮̃▓̷͚̩͚͕̯́̉̓̂͝ͅ█̸͚͌͗̑̂̋͛̉͛͋̋͘̚͜▒̴̖͒͝͝▓̸̣̦̊͗̌́̈̓͝█̵̡̡̼̹͖̼̜̦̟̙͖͓͆͊▓̷̨̡̩̼̗̐̋̏̄̒̔͌͂̆͜͝▒̷̛̥̒͂͋͘͠▓̴̢̧͓̠̲̘̖͓̜̱̦̭̭͓͆̈́̀̋̑̔̔͊͗͜͠▒̸͚̬̺̙̪̗̟͋̆̍̎̃̍͑̌̑̿̔̓̈͘͘͜█̶̧̛̞̯̻̥͍̑̽̉̂͂͆͋͌̍̓̋̉͝͝▒̷̫̞̄͛̐́̃̚̕▓̴̨̡̲̬̯̝͉̥̅̇͐͠.̸̨̨̛̠̲̹̮̙̤̬̞̼̖̿͐̒̉̓̎̔̾́͆͝&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">8</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;b08c89&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̴̢͚͉̞̙͕̫͚̝̜͕̩̍̈́̈́̽̃ǫ̴̧̢̳̫̤̰̝͖͖̜̼͚̼̓̇̀́̇̾͑͒̑̈̀̂̓u̷̯̫͎͙̤̰̩̜͇͐̋̌̄́̇̽̈̒̒̈̕͜͜͝r̴̡̧̗̩̼͕͓̗̬͈̤̘̣̟͚̊͒̍̈́͊̚͝ ̷̹̹̺̜̗̮͕̩̗̪̩̗̓̃̋̌͂̐̆͌͘̕̚͝f̶̘̥̘͚̣̝͖̫̬̬̘̝͉̈́̈́̿̈́̑͆̽̾͘͝l̴̢͈̱̜̤̞̬̜̬̟̯̻͒̈́͒̽̓̇͒̊͆͘͠͠ą̸̢̛̞̥̤̞̭̬̻̥̱͆̇͛̒̐̀̅̍̌̉̈́͝͝g̵̡̜͈͎͙̺̘̱̩͈͓̭̈́͊̃̍̃̊̈́͆̓̄͜͝͝ ̵̧̞̜̝̰̻̯̟͖̭̫̒͋͒́̄̓̓͘̕͜͝ͅͅm̸̡̨̧̧͍̻͈̼̜͕͖͚̯̪̅̄̋̉̊̈͐̈́͗̈́̚ǘ̵̮̱̩̋́̈́̀̌̓͒̄̐͌̚͝s̷̨̘͎͓̜͈̙̮̙͍͖͊t̴̙̲͗̽̿͛̊̽̔͋̒̐̎ ̷̝̱͓̞͉̫̏̐́́̔̆̓̀̌͘͝͠b̴̝̗͙͇̘͖̬̲̘̗͍͂̈́̔̾͗̓̽̔̓̕̕͘͝ͅę̴͍̘̲͕́͂͛̅́̓̾̽̚͘̚͜͝͝ ̵̨̛͎͈̙̬̎͐̑̀͗͆͘ͅ▒̸̛͍͓̈́̈́́̂͂̐́̕͠▓̷͚̥̳̼̔͗̒͑̀̃ͅ█̸̥̟̬̝͚̖͔̹̋̃̂͌͑͗̚̕█̸̨̖͓͚͙͙̙̝͔̻̯̲̮͚͐͆͑͗̈̄̎̀̂͒̈͘͜͝█̶̱̳͚̜̘͖̱̼̊̈́͆̓͋͑̄̀̉̐̚▓̴̧̢̡̱̺͚̠̖͋́̑̃̓́̊̔̈́̊͘̚̚▒̵̨̡̢̻̗͎͕͖̱̹̜̝̝̲̉̅͊̀▒̶̡͙̪͕̜͔̬̜͍͗▓̸̥̣̣͗̍͐͠͠█̶̯̯̤̊͋̋̎͊͆͋̾̂̌̅̈́̄̑▓̸͇͓̝̈̒̈́͂█̵̡͎̥̦̙̑̉͒̽͐̂̊̌̔̄̌̽̕͝▒̶̡̨̙͖̬̗͓̞͚̆̚▓̸̧͔͙͓̹͈̫͕̗̅͗̀͑̂͗̂̄̓̀̐̚▒̶͈̭̄͜█̶̨̢̧̧̥͖͕̯͕̗͙͐͊̃̀̎̍̉̍͐̐̃̉̿͜.̴̧̧̡͎̳̻̯̞͖͔̦͔͆͒̅̇̋̍͋̑̿͜&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">14</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;d0687a&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ỷ̶̭͙̈́̋͗͒̔̂̋͗̋͝͝ơ̶̡̨͉̤̜̫͍̩̂̿͊̒̄͛͜ų̸̻̙̭̱̆͑̃̋̚͝ͅȑ̴̢̝͈̠͙͍͈̭͙̪̳͉͇̂ ̸̲͇͐̃̋͛͂̓̓̀̾̚͠f̸̨͚̗̺̹̀̈́͆̈̈́̊̀͝l̵̥̝̯̥̗̗̝̙̜̦̝̩̺̊̍̇̑̂̈͑̍̄̇̑͐͘͝͝a̶̡̮͕̩̰͍̩̩͐̽̄̒̇͑̈́̉̍̍͛͊͊͘ģ̸̨̡͇̩̼̪̫̘̬̭̦͓̈́̀̂͝ ̴̛̱̙̜͇͚͖͒͗̑̅́͂̅̊̊̕̚̚͜͝m̷͍̫̖̰͓̀͛̂̿̿͠͝u̷̖͎̰̙̰̘̬͕̒̐͛́s̴̱͍̯͎̘̬̻͎̟̄̋͛͝ṭ̷̨̙̪̗̥͙̝̦̲́̍̃̋̉̑̒͛͘͝ ̸̨̢̡̛͉̹̝̟̜̩͕̼̆̇̄̊̾̓͌̓̃̊́ͅb̴̡̨̡̛͔̥̱̟̱̫̠͚̖̺̀̃̐̇̍̽̿̀̇̏͒͂̚͝ẹ̴͚̟̟͚͖̺̱͕͙̬͎̯̫̝̉ ̴̧̢̘͖͎̤̩̙̳̺̖̅͆́̀̈́̍̉̓͐͛̀̏͂͘͠ͅ█̸̨̤̫̗̬̮̞̤̟́̾̀͘█̷̛͙̰̤̹̼̥̏̐̅̑̊͆́̎͛͋͝͝▓̵̡͈̗͇͔̟̖̮͚̳̙̝͓͗̍͊́̆͊̋͐͊̈́̔̚͠█̷̠̤̽͂̀̎̀̈́̕̚█̷̨̧̦̰̘̱͚̰̣̏͌̇͝▒̸̛̪͕̐͒̑́̀̊͑̃̇̂̈̚▒̶̦̣̙̮̦͓̖̹͚͇̯̋̐͛̔͛͛̊̈́̂̇̌͗͘̕▓̷̬̂̈̈͑̇͛̚▓̸͔̞̬̩͉͍̈́͋͐̑͂͗̀̌̄͒̒̕͠█̴̝͕͙̩̦̺̰̖͍̩̙͖̻̬̖̽̃́͌̈́̌̒̊͠▓̵̢̛̞̳̻͓̣̻̙̖̘̲̐̔́́͗̈́̇̅̒̇͝▓̸͇͔̩̜̖̗̼̔̋̎̽̍̔͂̔̓̒̑͂̔▒̵̡͖̼̺̰͔̜̩͔̺̫̯͉̖̝͗͂̑̎̊͐̉̀̈́̄̔͑͗́█̷̢̛̳̤̣͔͔̯̂͋͑̓̏̔̈́͝ͅ█̵̧̰̓̾̈́͊̒̀͛́̐̐▒̷̨̨̢̧̜͕̲̗̒̾͛͋̎͠͠.̷̧̦͓͇̫̮͚͌͛͊̐̑̉̍̊̈́̚̕ͅ&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;87b3c7&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ŷ̴̝ǒ̶̬̼͝ȕ̵͉̺̊r̵͈̎́ ̷̘̆͌f̶̟̎l̸̲͐ạ̶̜͐̈́g̷̨̖͝ ̷̛̰̽m̶͉͙̽ū̶͖̥̀ś̸̢͔͝ẗ̴͕̮̌ ̸̪̾́b̵̜̋e̵̟̟͌̓ ̵̨̍̚▓̸̬̕▒̷̻̙̉▒̴̳̘͂█̴̜̆͛▓̸̽ͅ▓̷̬̅͂▒̴̬̗̏▒̴̳͚́̇█̷̞͛▓̶̱͕̐▒̷̳̒▒̵̲̿▓̵̝̯͘▓̶̠̈̈́▓̵̜̘͐▒̷̼̙̓̏.̸̧̹̎&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">22</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;8b035b&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ỷ̴̮͍͒ǫ̴̈́ŭ̸̧͚͒r̴̳̓ ̵̘͇̅͆f̷̮̑ḻ̴̡̂ă̵͇͋͜g̵͇͆ ̸̝̯͐̇m̵͚̿u̵͙̜͆̽s̷̢͠t̴̩̳̔̕ ̴͈̤̒̒b̵͓̄è̷̞̉ ̴̘̓̍█̷̧̖̈́▒̸̈́̕ͅ▒̵̟͛█̵̟͑̀▓̴͍͊▓̴͖͚̓̎█̶͙̝̍█̶̠̐̕▒̴͍̐̊█̴̮̑̾ͅ█̵̿ͅ▓̸͓̂█̴̧̯̊̒█̶̲̞̍▒̴̱̉͠▒̸̪̑.̷̻̅&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">40</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;8a9de8&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̶̼̥̔̚ȏ̴̟̦u̶̗͆r̴̨̛ ̸̤͖̉f̶̪̣͒l̷͎̾a̵͖̜̒́ḡ̵̣͖̇ ̸̺͕͌͗m̸̞̫͊̉u̶̫͎̓s̸̜͑̊t̵͈͕̚ ̶̹̋̽b̶̯̑̈ẻ̴̜̈́ ̴̟́̽▓̶̛̹͂▓̴̡̈́█̴͚̻̃̉█̸̦͇̓▓̴͓̻͊̅▓̴̗̹͂▓̸̯͈̈́̉█̸̹̠̏▓̷̐̾͜█̸͔̃▒̶̺͐͜▓̶͚̯͗͛▓̴̹̖̈́͑█̴̙̬̄▓̶̖͔̔̔█̶͔͖͊͛.̷͓̎̾&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">26</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;7be965&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̴̬͊͘͝ö̵̺́ȗ̴͈̌͐r̸͇̀͐͗ ̷̗̬̭͒͛͐f̴̗͓̂ḻ̴͎̝̄a̵̡̚g̷̻̹̯̒̾ ̷̜̎͘m̶̪̎͌ṷ̴̿ṡ̶̺̇̕t̷͖́̃ ̷̺͛͝b̸͈͑̋́e̷̢͇͒ ̷̭̪̈́█̶̲̔▒̵̧̺͂͂͜▓̴̦̰̉̄▒̸̗̓̔▓̴͉̻̇̑͘͜▓̶̛͎̀▒̶̧̆█̴̢̪̻̐▓̸̥̗̞̓̒͊▒̷̹̋̂̀▓̶̧̠͖̈̌▒̷̯͆█̶̙͈̟̓͛▓̶̰̉▒̷̡̟̾̕▒̴̟̑̎̽ͅ.̸̯͈̾͌̔ͅ&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;bf7eeb&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̴̨̠̓̕͘ő̶̥̖̈́u̸̪̎͆̊r̵͕̀ ̶̧̞͔̄̈́̕f̴͙͌l̸̲̩̫̀ḁ̸͚̎̅͑g̵͉̲̬̀͊̔ ̵̤͎͒̅̾m̵̼̮͋̑̌u̷͉̤͔̔̏̃s̵̬̋̔t̷̥͚̘̃̑ ̷̞͆̏b̴̩͙̓̕ê̸̖ ̷̨͚̒́▓̷͉̉▓̷̙̯̹̆͐█̸̡̨̮͗̍▓̷͋͜▒̷͍̩͌̈́̏▒̶̢̽͂͒▒̵̙̹̯̑̈́̈́▒̷̥̮̣̋͂̾▓̵̢̈̅̏▒̴̰͚̈́̎́▒̵͇͎͛̀█̷̲̦̈̓̔█̷̡̇̈́█̸̜̬͆̈́̀▒̷̡̦̆̓▓̵͎̱̱͂̍.̶̮̿̓̕&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">36</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;7ef31a&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̷̡͍̠͆̈́o̵̰̹̫̍͑ǘ̴̳͍̑̂r̵͍̀͆̃ͅ ̶̲̿̋̽f̴̤̊l̶̢̐͒͜a̷̧̘̥͋́̋g̵̳̅ ̵̼̣̱̀͂m̴̰͍̮̂u̸̜̞̲͐̽̀s̴̪̄̑ṯ̷̬̋ ̸̟̪̓͘͝b̴͍̄ë̸͖͖̙͘̕ ̴̛̟̃̍ͅ▒̵̖̊͊͜█̵̢͎͒█̵͕̯̈́█̸̞̊̋̌▓̷̘́̐▓̵͙͐▒̶̤̏͊͝▓̶̜͒▓̷̤̗͙̊̚▒̶̟̙͕͑̀̔▓̴̢̦͗̀͝▒̶̙͈̈▓̴͖̌█̶̖͚̥͝▓̵̡̮̂▓̴̥͉̄.̴̛͔̙̓̀&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">24</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;40f34c&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̴̨̤̒͜ŏ̸̝͇͜u̷̡̹̇r̷̺͎̘͝ ̷͕͚̋f̵͕͖̗̈̋l̵͉̣̕ậ̵̛̂ǵ̸͓ ̴̨̣̪̄͐͐m̸̻̀̋̑ṵ̵̡̖̌ś̶̩̗͌͒t̵͓̙̀̽̒ ̴̰͓̱̓͗b̴̢̈́͛͜ȇ̴̹ ̵̰̐█̸̱̰̭̂█̶̘̈̉█̸̖̟͇͆█̵̧̪̒̿█̴̜͂͗▓̴̥͚͓̀█̶̡̛̼̥̅͘▒̴̻͓͂▒̷̳̿▓̵̰̹̬̍▓̶̜̗̉̾▓̶̺̆̊̏ͅ█̶̳̬̆▓̸̨̬̤̂͑̏▓̶̼̠̹̈́█̵̹̞͗̀̚.̶̘̍̏̇&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;b72709&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̷̳̮̓͑́o̵̰̩̾̓̎ű̷͙͇r̸̰̫̰̃̇̑ ̵̨̙̟͂̔̄f̴͓̝͑l̵̝̺̥̑̈́a̷͖͓̔͜g̵̝͇̅́͂ ̵͉̺̊̓̀ṁ̵̭̙̆u̵̲͂̉s̵̩̅͑ͅt̵̙̳̒̚ͅ ̴̢̲̩͒̊b̷̳̤̈è̷̡̈ ̸̞͙͛̋̒█̴̨̺̿̃ͅ▒̷̹͑͜█̸̯̎͒̌█̸͍̘͐̈́▒̷̩̲͈͆▓̵̥̖̈́▒̴̺̂̽█̴̨̪̣̚▒̵̲̮̊▓̷̳͐▒̷̼̹͈͋͝█̵̟̳̻̂͘▒̶̧̪̇▒̸̦͉̭̈█̸̃͛ͅ█̸̡̇.̶͙̻͒̄̋&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">38</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;e3c817&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̶̮͙͆̓̄o̵͈͎̅̉̔u̴̲̻͋̑r̷̰̰͐̚ ̷̦̫̪̎͠f̶̼̀l̷̹̇̆͝a̴̛͓̰̺g̵̯͒ ̴̛̯͉͛͠m̷̹͙̓̉̏ụ̷̊s̵̨̠̕t̸͓̫̞̆ ̷͍͝b̷̲́̉͠ė̶̡̺̱ ̴͖̀█̸̝͗̂▒̷̠́́͝▓̸̙̝͈̎́▓̴͓͑▒̸͎̈́̿̕▓̶̪̀▓̶̧͕̇ͅ█̴̜̰͛̎▓̴̡̯̰̇͒▒̵͖̌▓̶͓̦̈̀▒̵͎͎͚̔█̵͔͉͆̔█̶̩̦̞̃█̷̨̣͈́█̵̱̣̩̊̃.̵̛̗͒&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">28</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;0b67cb&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ȳ̷̢͙̒͒o̵̡̩̳̗͑̄ũ̴͔̱̉̒̃r̶͎̯̱͐́ ̷̠̦̀̑̚ͅf̵̠̤̭́͠l̴͕̲̿͝͠a̸̘͕̭̹͌g̸̬̹̏ ̵̮͐̑m̶̮̫̟͋̔ụ̸͇̅s̴͎͇̆̔͆̚ţ̶̙̮̼̐̌ ̴͙͒̓͋̇b̷̢̒͝e̶̙͈͖̊̽͜͠ ̸̩̝̕͝▓̵̼͈́͜▒̷̙͈̓͛̕͜█̸͓̘̤͂͑͋͌▒̶̙̱̗͇̑͆͠͝█̸̦͆̓█̵͔͓́▓̵̡̩́▒̵̛̦̫̬͔▓̶̦̹̯̒ͅ█̵͔͖̊̿̇▒̸͍̜͂̚▒̴̲̋͐▒̴͎̻͝▓̸̫̾͊█̷̡͍͓̼̄̀̿̒▓̴̄̃̄͜.̷̢̟͌̔̎̈&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">32</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;f9f48b&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̵͖͇͐̌̇ö̶͖͆u̴̪̍ŗ̵̛̼̗̦̒ ̷̠̣̠͆̋͜͝f̸͖͛l̸̡̢̛̠͒a̷̡̩̗͗g̶̖͍̅́̋͛ ̸̨̮̺̯͝m̵̩͍͛͜͝͠u̶͎̩͑̊̈́̀s̵͕̀͛ṫ̴̩̣̰̺ ̶͍̦̃͂b̷̲̣͝e̶͇̮̊̈́ ̴̢͓͊͝▓̶̣̳̠̻͗͑▓̵̌̀̈́́ͅ▓̶̘͎̅͋̇͊█̷̣̰̥͎̽█̵̢̜̩͎̆̅̀̓▓̴̘̦̦͉͂̉͒̚█̴̟̭͎̱̈́▓̴̭͔̗͐̏̇͗͜▓̷̻̪̝͆͝█̶͉̬̠̥̉̑̔█̵͚̠͈̦̈́́͊▒̸͓͎͈́́▒̷̱̲̖̾̽▓̷̱̺̋̈́͋̽▒̸̨͗̾͐▒̶̛͈͓̺̯̃́.̴̱̺͎̽̈́̿&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">34</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;69260f&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ỵ̶͕̹͆́o̵̪͙̖͛̈́́͝ȕ̸͓̭̈́͠ṟ̵̌͗̎ ̸͚̘͐́f̶̡̛̫̻̤̔l̵͈͂̉͝ͅa̸͈͠͝g̷̝͂̒͐̒ ̵̢̦̈́̊̀͊m̸̗̅̌̋͜͝u̴̢̩̇̎͘͠s̸͇̟̻͐͘t̸̩̮̯͗̀͠ ̸̖̄͜͠b̵̮̤́̓͘ē̵̙̙͋̒ ̵̨̠̈́̾█̴̞̌͠▓̵̧͉̲̼͑█̸̗̫̽▒̷̃͒̃͜█̷̻̼̯̽̈́̔▓̶͓̩̪̌█̴̡̙͍̻̈͊█̸̨̬̱̎͑̎█̵̦͈̈́̎̔ͅ▒̸̝͍̼̥͂͂͊͘▒̴̛̯̥̯̣̇̕▓̵̬̮̟͉̋▒̷̤̪͓̼͒▒̴̧̛͈͖͊̌͒͜▓̵̡̂͆▓̷̭̙̫̿.̸̳̚&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">18</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;c25dd2&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ỳ̷̼͝o̴͈̊u̴̞̱̹̒̑̕ṙ̴̼̳̱͖̚͜ ̴̠̦̃͋̕͝f̷̨̲̣́̈́l̷͚͊̉̎ã̶̧̲̱̩g̴̠͓̊̑̾ ̶̺͇̗̂̂͑ḿ̴̳̎̋̈́̕u̸̯̭̳͂͌̊s̸͕͖̬͓͋̉̃̏̑ţ̷̯̟̃̉̏̄ ̶̗̞̣̦̤̄͗͌͑̀b̷̨̭̗̈́̓̐e̸̹̰̱̫͛̑̑̚ ̸̨̬̱̲̮͑̓̓▒̷̪̲͆̇▒̷̠͌̈̓͂͝▓̴͎̖̃́͗̇█̴̖̲̀▓̶̨̭͈̗̃͜▒̸̢̭̑̊̆█̷̭͍͈̍̑͘͝█̵̠̼̺̠̭̒̑̃́█̵̣̈͘█̷͚̫̮̔̆́̕▓̶͖̭͙̼͗̐█̸̱͔̇͊̐͗̓͜█̷̡̤̯͖̉͗͊̉̉█̴̡͛̔͠█̷̜͛͑̃̂█̴̢̦̥̯̽.̸̳͔͓͙̈̈̏̔ͅ&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;cbe2c9&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ÿ̶̻́̍͒͂̒ǫ̵̔̍͝û̶̯̯͙̌̾͛̂ŕ̸̜̥̪̓̂̈́ ̵̝͇͑̉̓̽͠ͅf̷̧̖͖̌ḻ̵̨̅̒a̸̳͍͔̭͗̽͋̽g̴̼̉̄͑̔̕ ̷̪̹̃̇̆̾̇ḿ̷͔͖̤͘ų̴̫̓̈́̍s̷̢̹̎t̴̞̬͋̑̒͜ ̷̡̭͙̠̃͑̈́̅͒b̷̻̟̜͇̏̾̏͌̕ȇ̶̢͕̜͖̜́̄̈ ̷̝͕̦̦̾̒▒̵̧͖̤̑͛͐̎̈́▓̵̨̝͗̔̈́͘█̵̰̻̐̿͌͂͌▓̸͔̙͎̥̀̌́̓▓̸̛̯̤͈̦̓͛▓̴̧̢͇͔̈́̃͆͘̕█̵̯̤̲̦̗̈█̷̢̣̳̙̰̈́̚█̸̙̬̩̗̂̃̓̍͐█̷̪̗͇͙͒̔͜▓̷͈̱̻̬͇̑█̵̱̫̯̪̙́̋͐█̴͙͕̟̱̞͋█̸͓̏͋̀▒̵̥͕͆͊̾͘͝▒̸̺̗͎̫̏.̵̺͝&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;ce45fd&#39;</span>)
}, {
  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Y̶̤̺̝͋͊̑͠͝o̸͎͈̩͌͂̅̒ṷ̸̪̈́̽r̴̙̯̦̗̈̄̿̀͗ ̸̜̿̌f̵̧̼͎͍͗̓ͅļ̶̛̼͇̅a̴̖̦̯͆͆͝͝g̴̘̅̿̓͛ ̸̰͓̩͙̐͘͝m̵̫̳̙͌̀̎ụ̶̉̃s̶͋ͅt̶̥͖̜̟̒̽͂͝ ̶̲̜̘͑̐͋̈́b̷̞̐̈̔̋̽͜e̷̡̻̰̅̍͗̓̒ ̵͚̠̠͍̒̑▒̸̫̜̉̉́͠▓̴̢͚́̑̿̈́█̶̬̖̞̓͂̀͒▒̴̩͙͜͝▒̵̗̦̕͠█̷̯̫̝͒̽̾̋▓̷̭̺̻͕̄̄̉̏̇▒̷̧̎▒̶̣̫̱̐̒▒̶̫͚̙̈́▒̴̺̬̼͈̏̎̐̕█̶͓̩͗͂̐̐▒̸̱̗̹̬͒̍▓̸̠̦̋̿̊̈▒̵̝̑̐̊̓̈█̶̜̔̊ͅ.̶̧̛̣͊͐̂&#39;</span>,
  <span style="color:#a6e22e">checker</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">u</span>) =&gt; <span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">42</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;e3c817&#39;</span>)
}]
</code></pre></div><p>We can see that the &ldquo;obfuscated&rdquo; rules are checking the SHA256 and SHA224 digests of the prefixes. We can rewrite the above rules as a checker function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isFlag</span>(<span style="color:#a6e22e">flag</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">8</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;b08c89&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;ce45fd&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;87b3c7&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">14</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;d0687a&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;cbe2c9&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">18</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;c25dd2&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;b72709&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">22</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;8b035b&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">24</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;40f34c&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">26</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;7be965&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">28</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;0b67cb&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;bf7eeb&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">32</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;f9f48b&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">34</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;69260f&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">36</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;7ef31a&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">38</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;e3c817&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha224</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">40</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;8a9de8&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">sha256</span>(<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">substr</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">42</span>)).<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#39;e3c817&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
}
</code></pre></div><p>Since we know the flag starts with <code>hkcert23</code>, we know 8 bytes of the flag. To recover the full flag, we can repeatedly exhaust two more bytes to check if the next rule is valid.</p>
<p>Eventually we will have the flag: <code>hkcert23{h0p3_y0u_u53d_th3_s0urc3m4p}</code>.</p>
<h2 id="loot-and-scoot">Loot and Scoot<a href="#loot-and-scoot" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-4">Challenge Summary<a href="#challenge-summary-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Collect the keys and unlock the crypt to the flag.</p>
<p>http://HOST:PORT/</p>
<p>Attachments: <a href="https://github.com/blackb6a/hkcert-ctf-2023-challenges/releases/download/v1.0.0/loot-and-scoot_91f788ef9735eb6ba507b61fa313e230.zip">loot-and-scoot.zip</a></p>
</blockquote>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-game.png"   />
    
  </figure>


<p>In the challenge, we are given a binary (written in C) which is the server, as well as a web client for interaction.</p>
<p>The goal is to unlock the chambers and interact with <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-flag.png" style="display: inline;"> the flag within 100 seconds, as we have 100 HP and we lose 1 HP every second.</p>
<h3 id="solution-4">Solution<a href="#solution-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>We are given the binary for the backend written in C and a HTTP client. The backend uses protocol buffers and websocket to allow interactions with the web.</p>
<p>As the challenge author, I will just skip the reverse engineering part and share the source code directly.</p>



  <div class="collapsable-code">
    <input id="985416723" type="checkbox" checked />
    <label for="985416723">
      <span class="collapsable-code__language">c</span>
      <span class="collapsable-code__title">Source code for game.c</span>
      <span class="collapsable-code__toggle" data-label-expand="[△]" data-label-collapse="[▽]"></span>
    </label>
    <pre class="language-c" ><code>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;ws.h&gt;
#include &#34;maze_runner.pb-c.h&#34;

#define GRID_COLS 55
#define GRID_ROWS 55
#define COORD(x, y) (GRID_COLS * y &#43; x)
#define DIST2(x, y) ((x) * (x) &#43; (y) * (y))
#define TILESET_SIZE 12
#define ITEM_COUNT 4
#define MAX_CLIENTS 1024

typedef struct GameTile GameTile;
typedef struct Player Player;
typedef struct Monster Monster;

typedef struct Context
{
    GameTile **tileset;
    GameTile **grid;
    Player *player;
    Monster *monster;
    int *inventory;
    char *message;
    ws_cli_conn_t *client;
} Context;

typedef struct Player
{
    int x;
    int y;
    int facing;
    int health;
} Player;

typedef struct Monster
{
    int x;
    int y;
} Monster;

typedef struct GameTile
{
    int type;
    void (*on_enter)(Context *ctx, int x, int y);
    void (*on_interact)(Context *ctx, int x, int y);
    int is_walkable;
    int is_interactable;
} GameTile;

// ---

unsigned long long int GRID[] = {
    0, 0, 0, 2459530691549855744, 144680483117212162, 2450523355428823554, 2306443351725048354, 137975832616, 9007199793717280, 9042384163708960, 2450558539798685984, 153722729841951266, 2450523492867768866, 2345624797730, 2305843009215791104, 35321811050496, 536879136, 2450523492865671168, 153687544932999714, 2459565738516677154, 2305878202748379682, 2314885393377402912, 2314885530281582624, 2305843147189518368, 2450558676702994944, 2450523492867768834, 153687682908815906, 2305878193621565986, 35321813147648, 9042384163708928, 9007336695791648, 153687544930902562, 144680483115115010, 153687682906718722, 2305878194122793474, 2314885392842629152, 2305843009750573056, 2449958335265374208, 144680483115115010, 2459565876492509730, 144680346215129602, 9007337230565922, 538968064, 9007337230565376, 153685474722979872, 2459565875957735938, 2459530691583549986, 153722729841959426, 2314850345907396610, 9042383628935168, 2305878194122653728, 153722721216233504, 2450523492330897954, 2459565738516677154, 144715668026163714, 2314885530279477280, 2314885393379491872, 0, 2459530554110902272, 144715530048242178, 2459565875955638818, 9607679205057058, 2305878331563704352, 2314885392840532000, 0, 144715530585120768, 2450523354891944450, 2459565875955630626, 9044591812682274, 9007199254749216, 2314885530816356352, 2305843009213693952, 2459565738518774304, 153687544932991490, 2459565875955630626, 2305878339648365090, 2305878331026841600, 2314885530279485472, 2314885392840523776, 153687545467765250, 153687682906726946, 2459565875955630594, 2314885530850034178, 2305878331024736288, 2314885530816356384, 153157709678510080, 2450558539261936130, 153687682369856002, 144715667487195650, 35322350141954, 8192, 2314885530816356352, 2459563668847731234, 2459565876494606882, 5927337589569888802, 144680487954305634, 137438962178, 35184908967936, 2459000718894309408, 2459530683498897442, 144680346213032482, 144680345678250530, 144680346215121410, 2305843146652647458, 9007199254749216, 137977929760, 2459565739021967392, 144715667489292802, 144680346215121442, 2450523355428823586, 9007336693702656, 9007337232662528, 2105376, 144680345678127136, 153722867280912898, 2459530554144588290, 2315415366607708706, 2305878331563712544, 2314885530279485472, 32, 153722729839861792, 144680345678250498, 2459565875955638818, 9044591812682274, 2305843147191615520, 9007199793717248, 0, 153687682371944992, 2450523354889855522, 2459565876494598690, 2305878340187333154, 2305843146652655616, 2105376, 0, 153687682371953152, 2459565875957735970, 153722866744042018, 137474744866, 137977921536, 2305843009750573088, 35184911056928, 153687682906726946, 153687544930902562, 2459565738516677122, 2314850346444390914, 2314885530279477248, 2314885530816348192, 144150509886898208, 2450558539798807074, 2450523492330897922, 153722729302983170, 2305843146654745122, 9042383628935200, 2305878331563712512, 153685474725068832, 2459565739053548066, 144715668024066562, 144715530050339330, 9042384163700738, 9007336695791648, 2305878194122661888, 2459565730432032800, 2450523354889855490, 2450558677237760546, 153722729302991362, 9007337230565408, 2314885530281574432, 9007199791620128, 153722729271402528, 153722729302991362, 144715530048242210, 565157602402850, 2314885393377402880, 2105344, 35184911065088, 2450523424146063392, 144680345678250498, 144680483117203970, 3035428494472512002, 2314850346444267552, 2314850346446364672, 2314885393379500064, 2459530691585638443, 2459530692120420898, 2459565875957735970, 9160491554, 0, 0, 0, 0};

void on_default_enter(Context *ctx, int x, int y) {}

void on_default_interact(Context *ctx, int x, int y) {}

void on_key_1_interact(Context *ctx, int x, int y)
{
    char *message = malloc(20 &#43; 1);
    strcpy(message, &#34;You picked up a key.&#34;);
    ctx-&gt;message = message;

    ctx-&gt;inventory[0] &#43;= 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_key_2_interact(Context *ctx, int x, int y)
{
    char *message = malloc(20 &#43; 1);
    strcpy(message, &#34;You picked up a key.&#34;);
    ctx-&gt;message = message;

    ctx-&gt;inventory[1] &#43;= 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_key_3_interact(Context *ctx, int x, int y)
{
    char *message = malloc(20 &#43; 1);
    strcpy(message, &#34;You picked up a key.&#34;);
    ctx-&gt;message = message;

    ctx-&gt;inventory[2] &#43;= 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_key_4_interact(Context *ctx, int x, int y)
{
    char *message = malloc(20 &#43; 1);
    strcpy(message, &#34;You picked up a key.&#34;);
    ctx-&gt;message = message;

    ctx-&gt;inventory[3] &#43;= 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_gate_1_interact(Context *ctx, int x, int y)
{
    if (ctx-&gt;inventory[0] == 0)
    {
        char *message = malloc(32 &#43; 1);
        strcpy(message, &#34;You don&#39;t have the required key!&#34;);
        ctx-&gt;message = message;
        return;
    }
    else
    {
        char *message = malloc(22 &#43; 1);
        strcpy(message, &#34;You unlocked a gate.&#34;);
        ctx-&gt;message = message;
    }
    ctx-&gt;inventory[0]--;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_gate_2_interact(Context *ctx, int x, int y)
{
    if (ctx-&gt;inventory[1] == 0)
    {
        char *message = malloc(32 &#43; 1);
        strcpy(message, &#34;You don&#39;t have the required key!&#34;);
        ctx-&gt;message = message;
        return;
    }
    else
    {
        char *message = malloc(22 &#43; 1);
        strcpy(message, &#34;You unlocked a gate.&#34;);
        ctx-&gt;message = message;
    }
    ctx-&gt;inventory[1]--;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_gate_3_interact(Context *ctx, int x, int y)
{
    if (ctx-&gt;inventory[2] == 0)
    {
        char *message = malloc(32 &#43; 1);
        strcpy(message, &#34;You don&#39;t have the required key!&#34;);
        ctx-&gt;message = message;
        return;
    }
    else
    {
        char *message = malloc(22 &#43; 1);
        strcpy(message, &#34;You unlocked a gate.&#34;);
        ctx-&gt;message = message;
    }
    ctx-&gt;inventory[2]--;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_gate_4_interact(Context *ctx, int x, int y)
{
    if (ctx-&gt;inventory[3] == 0)
    {
        char *message = malloc(32 &#43; 1);
        strcpy(message, &#34;You don&#39;t have the required key!&#34;);
        ctx-&gt;message = message;
        return;
    }
    else
    {
        char *message = malloc(22 &#43; 1);
        strcpy(message, &#34;You unlocked a gate.&#34;);
        ctx-&gt;message = message;
    }
    ctx-&gt;inventory[3]--;
    ctx-&gt;grid[COORD(x, y)]-&gt;type = 2;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable = 1;
    ctx-&gt;grid[COORD(x, y)]-&gt;on_interact = on_default_interact;
    ctx-&gt;grid[COORD(x, y)]-&gt;is_interactable = 0;
}

void on_flag_interact(Context *ctx, int x, int y)
{
    FILE *fd = fopen(&#34;flag.txt&#34;, &#34;r&#34;);
    char flag[128];
    char *message = malloc(256);

    fscanf(fd, &#34;%s&#34;, flag);
    sprintf(message, &#34;Congratulations! You got the flag: %s.\n&#34;, flag);
    ctx-&gt;message = message;
}

int walk(Context *ctx, int dx, int dy)
{
    int x1 = ctx-&gt;player-&gt;x, y1 = ctx-&gt;player-&gt;y;

    int x2 = x1 &#43; dx, y2 = y1 &#43; dy;

    if (!ctx-&gt;grid[COORD(x2, y2)]-&gt;is_walkable)
        return 1;
    if (ctx-&gt;monster-&gt;x == x2 &amp;&amp; ctx-&gt;monster-&gt;y == y2)
        return 1;
    ctx-&gt;player-&gt;x &#43;= dx;
    ctx-&gt;player-&gt;y &#43;= dy;
    ctx-&gt;grid[COORD(x2, y2)]-&gt;on_enter(ctx, x2, y2);
    return 0;
}

int DXS[4] = {&#43;0, &#43;1, &#43;0, -1};
int DYS[4] = {-1, &#43;0, &#43;1, &#43;0};

int FAN_XXS[4] = {0, &#43;1, 0, -1};
int FAN_XYS[4] = {&#43;1, 0, -1, 0};
int FAN_YXS[4] = {-1, 0, &#43;1, 0};
int FAN_YYS[4] = {0, &#43;1, 0, -1};

Context *ctxs[MAX_CLIENTS];

void send_state_via_ws(Context *ctx)
{
    if (ctx == NULL)
        return;
    ws_cli_conn_t *client = ctx-&gt;client;

    int x = ctx-&gt;player-&gt;x;
    int y = ctx-&gt;player-&gt;y;

    int x2 = ctx-&gt;player-&gt;x &#43; DXS[ctx-&gt;player-&gt;facing];
    int y2 = ctx-&gt;player-&gt;y &#43; DYS[ctx-&gt;player-&gt;facing];

    Response res = RESPONSE__INIT;

    // grids
    Tile **grids = malloc(25 * sizeof(Tile *));
    int n_grids = 0;

    for (int i = 0; i &lt; 5; i&#43;&#43;)
    {
        for (int j = -i; j &lt;= i; j&#43;&#43;)
        {
            Tile *tile = malloc(sizeof(Tile));
            tile__init(tile);
            tile-&gt;offset_horizontal = i;
            tile-&gt;offset_vertical = j;

            int x = ctx-&gt;player-&gt;x &#43; FAN_XXS[ctx-&gt;player-&gt;facing] * i &#43; FAN_XYS[ctx-&gt;player-&gt;facing] * j;
            int y = ctx-&gt;player-&gt;y &#43; FAN_YXS[ctx-&gt;player-&gt;facing] * i &#43; FAN_YYS[ctx-&gt;player-&gt;facing] * j;

            int type;
            if (x &lt; 0 || x &gt;= GRID_COLS)
                type = 0;
            else if (y &lt; 0 || y &gt;= GRID_ROWS)
                type = 0;
            else
                type = ctx-&gt;grid[COORD(x, y)]-&gt;type;
            tile-&gt;type = type;
            grids[n_grids&#43;&#43;] = tile;
        }
    }

    res.n_grids = n_grids;
    res.grids = grids;

    // entities
    Entity **entities = malloc(25 * sizeof(Entity *));
    int n_entities = 0;

    for (int i = 0; i &lt; 5; i&#43;&#43;)
    {
        for (int j = -i; j &lt;= i; j&#43;&#43;)
        {
            Entity *entity = malloc(sizeof(Entity));
            entity__init(entity);
            entity-&gt;offset_horizontal = i;
            entity-&gt;offset_vertical = j;

            int x = ctx-&gt;player-&gt;x &#43; FAN_XXS[ctx-&gt;player-&gt;facing] * i &#43; FAN_XYS[ctx-&gt;player-&gt;facing] * j;
            int y = ctx-&gt;player-&gt;y &#43; FAN_YXS[ctx-&gt;player-&gt;facing] * i &#43; FAN_YYS[ctx-&gt;player-&gt;facing] * j;

            if (ctx-&gt;monster-&gt;x == x &amp;&amp; ctx-&gt;monster-&gt;y == y)
                entity-&gt;type = 1;

            entities[n_entities&#43;&#43;] = entity;
        }
    }

    res.n_entities = n_entities;
    res.entities = entities;

    // inventory
    res.n_item_counts = ITEM_COUNT;
    res.item_counts = ctx-&gt;inventory;

    // message
    res.message = ctx-&gt;message;

    // possible moves
    int n_possible_moves = 0;
    Move possible_moves[4] = {0};
    possible_moves[n_possible_moves&#43;&#43;] = MOVE__LEFT;
    possible_moves[n_possible_moves&#43;&#43;] = MOVE__RIGHT;
    if (0 &lt;= x2 &amp;&amp; x2 &lt; GRID_COLS &amp;&amp;
        0 &lt;= y2 &amp;&amp; y2 &lt; GRID_ROWS &amp;&amp;
        ctx-&gt;grid[COORD(x2, y2)]-&gt;is_walkable)
        possible_moves[n_possible_moves&#43;&#43;] = MOVE__FORWARD;
    if (0 &lt;= x2 &amp;&amp; x2 &lt; GRID_COLS &amp;&amp;
        0 &lt;= y2 &amp;&amp; y2 &lt; GRID_ROWS &amp;&amp;
        ctx-&gt;grid[COORD(x2, y2)]-&gt;is_interactable)
        possible_moves[n_possible_moves&#43;&#43;] = MOVE__INTERACT;

    res.n_possible_moves = n_possible_moves;
    res.possible_moves = possible_moves;

    res.health = ctx-&gt;player-&gt;health;

    size_t packed_response_size = response__get_packed_size(&amp;res);
    char *packed_response = malloc(packed_response_size);
    response__pack(&amp;res, packed_response);
    ws_sendframe_bin(client, packed_response, packed_response_size);

    if (ctx-&gt;message != NULL)
    {
        free(ctx-&gt;message);
        ctx-&gt;message = NULL;
    }
    for (int i = 0; i &lt; 25; i&#43;&#43;)
        free(grids[i]);
    free(grids);
    free(packed_response);

void onopen(ws_cli_conn_t *client)
{
    char *cli;
    cli = ws_getaddress(client);

    int client_id = ws_get_id(client);

    // ---

    GameTile *wall_tile = malloc(sizeof(GameTile));
    wall_tile-&gt;type = 0;
    wall_tile-&gt;on_enter = on_default_enter;
    wall_tile-&gt;on_interact = on_default_interact;
    wall_tile-&gt;is_walkable = 0;
    wall_tile-&gt;is_interactable = 0;

    GameTile *fake_wall_tile = malloc(sizeof(GameTile));
    fake_wall_tile-&gt;type = 1;
    fake_wall_tile-&gt;on_enter = on_default_enter;
    fake_wall_tile-&gt;on_interact = on_default_interact;
    fake_wall_tile-&gt;is_walkable = 1;
    fake_wall_tile-&gt;is_interactable = 0;

    GameTile *walk_tile = malloc(sizeof(GameTile));
    walk_tile-&gt;type = 2;
    walk_tile-&gt;on_enter = on_default_enter;
    walk_tile-&gt;on_interact = on_default_interact;
    walk_tile-&gt;is_walkable = 1;
    walk_tile-&gt;is_interactable = 0;

    GameTile *flag_tile = malloc(sizeof(GameTile));
    flag_tile-&gt;type = 3;
    flag_tile-&gt;on_enter = on_default_enter;
    flag_tile-&gt;on_interact = on_flag_interact;
    flag_tile-&gt;is_walkable = 0;
    flag_tile-&gt;is_interactable = 1;

    GameTile *gate_1_tile = malloc(sizeof(GameTile));
    gate_1_tile-&gt;type = 4;
    gate_1_tile-&gt;on_enter = on_default_enter;
    gate_1_tile-&gt;on_interact = on_gate_1_interact;
    gate_1_tile-&gt;is_walkable = 0;
    gate_1_tile-&gt;is_interactable = 1;

    GameTile *gate_2_tile = malloc(sizeof(GameTile));
    gate_2_tile-&gt;type = 5;
    gate_2_tile-&gt;on_enter = on_default_enter;
    gate_2_tile-&gt;on_interact = on_gate_2_interact;
    gate_2_tile-&gt;is_walkable = 0;
    gate_2_tile-&gt;is_interactable = 1;

    GameTile *gate_3_tile = malloc(sizeof(GameTile));
    gate_3_tile-&gt;type = 6;
    gate_3_tile-&gt;on_enter = on_default_enter;
    gate_3_tile-&gt;on_interact = on_gate_3_interact;
    gate_3_tile-&gt;is_walkable = 0;
    gate_3_tile-&gt;is_interactable = 1;

    GameTile *gate_4_tile = malloc(sizeof(GameTile));
    gate_4_tile-&gt;type = 7;
    gate_4_tile-&gt;on_enter = on_default_enter;
    gate_4_tile-&gt;on_interact = on_gate_4_interact;
    gate_4_tile-&gt;is_walkable = 0;
    gate_4_tile-&gt;is_interactable = 1;

    GameTile *key_1_tile = malloc(sizeof(GameTile));
    key_1_tile-&gt;type = 8;
    key_1_tile-&gt;on_enter = on_default_enter;
    key_1_tile-&gt;on_interact = on_key_1_interact;
    key_1_tile-&gt;is_walkable = 0;
    key_1_tile-&gt;is_interactable = 1;

    GameTile *key_2_tile = malloc(sizeof(GameTile));
    key_2_tile-&gt;type = 9;
    key_2_tile-&gt;on_enter = on_default_enter;
    key_2_tile-&gt;on_interact = on_key_2_interact;
    key_2_tile-&gt;is_walkable = 0;
    key_2_tile-&gt;is_interactable = 1;

    GameTile *key_3_tile = malloc(sizeof(GameTile));
    key_3_tile-&gt;type = 10;
    key_3_tile-&gt;on_enter = on_default_enter;
    key_3_tile-&gt;on_interact = on_key_3_interact;
    key_3_tile-&gt;is_walkable = 0;
    key_3_tile-&gt;is_interactable = 1;

    GameTile *key_4_tile = malloc(sizeof(GameTile));
    key_4_tile-&gt;type = 11;
    key_4_tile-&gt;on_enter = on_default_enter;
    key_4_tile-&gt;on_interact = on_key_4_interact;
    key_4_tile-&gt;is_walkable = 0;
    key_4_tile-&gt;is_interactable = 1;

    GameTile **tileset = malloc(TILESET_SIZE * sizeof(GameTile *));
    tileset[0] = wall_tile;
    tileset[1] = fake_wall_tile;
    tileset[2] = walk_tile;
    tileset[3] = flag_tile;
    tileset[4] = gate_1_tile;
    tileset[5] = gate_2_tile;
    tileset[6] = gate_3_tile;
    tileset[7] = gate_4_tile;
    tileset[8] = key_1_tile;
    tileset[9] = key_2_tile;
    tileset[10] = key_3_tile;
    tileset[11] = key_4_tile;

    GameTile **grid = malloc(GRID_ROWS * GRID_COLS * sizeof(GameTile *));
    for (int x = 0; x &lt; GRID_COLS; x&#43;&#43;)
        for (int y = 0; y &lt; GRID_ROWS; y&#43;&#43;)
        {
            unsigned long long int range_grid = GRID[COORD(x, y) &gt;&gt; 4];
            grid[COORD(x, y)] = tileset[(range_grid &gt;&gt; (4 * (COORD(x, y) &amp; 0xf))) &amp; 0xf];
        }

    Player *player = malloc(sizeof(Player));
    player-&gt;x = 3;
    player-&gt;y = 27;
    player-&gt;facing = 1;
    player-&gt;health = 100;

    Monster *monster = malloc(sizeof(Monster));
    monster-&gt;x = GRID_COLS - 4;
    monster-&gt;y = GRID_ROWS - 4;

    int *inventory = malloc(sizeof(int) * ITEM_COUNT);

    memset(inventory, 0, sizeof(int) * ITEM_COUNT);

    Context *ctx = malloc(sizeof(Context));
    ctx-&gt;tileset = tileset;
    ctx-&gt;grid = grid;
    ctx-&gt;player = player;
    ctx-&gt;monster = monster;
    ctx-&gt;inventory = inventory;
    ctx-&gt;client = client;
    ctx-&gt;message = NULL;

    send_state_via_ws(ctx);

    ctxs[client_id] = ctx;
}

void onclose(ws_cli_conn_t *client)
{
    char *cli;
    cli = ws_getaddress(client);
    int client_id = ws_get_id(client);

    Context *ctx = ctxs[client_id];

    for (int i = 0; i &lt; TILESET_SIZE; i&#43;&#43;)
        free(ctx-&gt;tileset[i]);
    free(ctx-&gt;tileset);
    free(ctx-&gt;grid);
    free(ctx-&gt;player);
    free(ctx-&gt;monster);
    free(ctx-&gt;inventory);
    free(ctx);
    ctxs[client_id] = NULL;
}

void onmessage(ws_cli_conn_t *client,
               const unsigned char *msg, uint64_t size, int type)
{
    char *cli;
    cli = ws_getaddress(client);

    int client_id = ws_get_id(client);
    Context *ctx = ctxs[client_id];

    Request *req = request__unpack(NULL, size, msg);
    if (req == NULL)
        return;

    switch (req-&gt;move)
    {
    case MOVE__LEFT:
        ctx-&gt;player-&gt;facing = (ctx-&gt;player-&gt;facing - 1) &amp; 3;
        break;
    case MOVE__RIGHT:
        ctx-&gt;player-&gt;facing = (ctx-&gt;player-&gt;facing &#43; 1) &amp; 3;
        break;
    case MOVE__FORWARD:
        int dx = DXS[ctx-&gt;player-&gt;facing];
        int dy = DYS[ctx-&gt;player-&gt;facing];
        walk(ctx, dx, dy);
        break;
    case MOVE__INTERACT:
        int x = ctx-&gt;player-&gt;x &#43; DXS[ctx-&gt;player-&gt;facing];
        int y = ctx-&gt;player-&gt;y &#43; DYS[ctx-&gt;player-&gt;facing];
        ctx-&gt;grid[COORD(x, y)]-&gt;on_interact(ctx, x, y);
        break;
    default:
        return;
    }
    send_state_via_ws(ctx);
}

int sgn(int x)
{
    if (x == 0)
        return 0;
    if (x &lt; 0)
        return -1;
    return 1;
}

// Return 1 if the game is still running, 0 otherwise
int tick(Context *ctx)
{
    int dx = ctx-&gt;player-&gt;x - ctx-&gt;monster-&gt;x;
    int dy = ctx-&gt;player-&gt;y - ctx-&gt;monster-&gt;y;

    ctx-&gt;player-&gt;health -= 1;
    if (ctx-&gt;player-&gt;health == 0)
        return 0;

    if (DIST2(dx, dy) == 1)
    {
        ctx-&gt;player-&gt;health -= 10;
        if (ctx-&gt;player-&gt;health &lt;= 0)
        {
            ctx-&gt;player-&gt;health = 0;
            return 0;
        }
        char *message = malloc(27 &#43; 1);
        strcpy(message, &#34;You were bitten by a snake!&#34;);
        ctx-&gt;message = message;
    }
    else if (DIST2(dx, dy) &lt;= 10 * 10)
    {
        int facing = 0;
        if (abs(dx) &gt;= abs(dy))
        {
            facing = 2 - sgn(dx);
        }
        else
        {
            facing = 1 &#43; sgn(dy);
        }

        int x = ctx-&gt;monster-&gt;x &#43; DXS[facing];
        int y = ctx-&gt;monster-&gt;y &#43; DYS[facing];
        if (ctx-&gt;grid[COORD(x, y)]-&gt;is_walkable)
        {
            ctx-&gt;monster-&gt;x = x;
            ctx-&gt;monster-&gt;y = y;
        }
    }

    return 1;
}

int main()
{
    struct ws_events evs;
    evs.onopen = &amp;onopen;
    evs.onclose = &amp;onclose;
    evs.onmessage = &amp;onmessage;

    ws_socket(&amp;evs, 8080, 1, 1000);

    while (1)
    {
        for (int i = 0; i &lt; MAX_CLIENTS; i&#43;&#43;)
        {
            Context *ctx = ctxs[i];
            if (ctx == NULL)
                continue;
            int is_alive = tick(ctx);
            if (!is_alive)
            {
                char *message = malloc(25 &#43; 1);
                strcpy(message, &#34;You ran out of stamina...&#34;);
                ctx-&gt;message = message;
            }
            send_state_via_ws(ctx);
            if (!is_alive)
            {
                ws_cli_conn_t *client = ctx-&gt;client;
                ws_close_client(client);
            }
        }
        sleep(1);
    }

    return 0;
}
</code></pre>
  </div>


<p>When connected to the server, the binary will run the <code>onopen</code> function and define a context specific to the client. A <code>Context</code> struct is created and the struct members are defined and it stores the current game state, which will be constantly updated during the gameplay. If we look at the variable <code>GRID</code> and the tileset, we are able to draw the game map by ourselves:</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map.png"   />
    
  </figure>


<p>The player spawns in the middle left at the beginning. There are four keys at the corners and there are five gates yet to be unlocked with these keys. The objective is to interact with the flag in the middle right.</p>
<p>There are some difficulties identified by reading the map:</p>
<ol>
<li>We might need to penetrate through walls to grab the keys on the left.</li>
<li>We have to dodge the snake to grab the key on the bottom right.</li>
<li>We might need to duplicate the key on the top right.</li>
</ol>
<h4 id="penetrating-the-walls-part-one">Penetrating the walls, part one<a href="#penetrating-the-walls-part-one" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>To start with, we will grab <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-key-3.png" style="display: inline;"> on the bottom left. Observe that there is a different wall tile near the key.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map-key-3.png"   />
    
      <figcaption class="right" >The bottom right corner of the map.</figcaption>
    
  </figure>


<div class="alert danger">
  😡 <strong>They are visually the same in the game!</strong> I intentionally used a different sprite for the different wall tiles, which actually looked the same in the game. However, I expect one could note the differences by extracting the type IDs of the tiles.
</div>

<p>The normal wall tiles (type <code>0</code>) are given the attribute <code>is_walkable = 0</code>, while the special wall tile (type <code>1</code>) has the attribute <code>is_walkable = 1</code>. Although it looks like a wall, we can actually walk through it.</p>
<h4 id="dodging-the-snake">Dodging the snake<a href="#dodging-the-snake" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>We are going to grab <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-key-4.png" style="display: inline;"> without getting bitten by snakes, which is fatal. We will lost 10 HP every bite. Also, the snake will attempt to move forward to our direction if we are too close to it. Fortunately, the snake AI is pretty dumb and you could easily lure it away. Since we did not rate limit the client&rsquo;s requests, it is also fine to walk 100 blocks per second. This allow us easily avoiding the venom.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map-key-4.gif"   />
    
      <figcaption class="right" >Juking the snake.</figcaption>
    
  </figure>


<h4 id="duplicating-the-key">Duplicating the key<a href="#duplicating-the-key" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-key-2.png" style="display: inline;"> is easy to grab. There are no snakes, no impenetrable walls, no nothing. We can walk towards the key and grab that manually. Since the corresponding key will be consumed when we open a gate, we need multiple <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-key-2.png" style="display: inline;">s. That is actually not the case, and we will actually unlock <em>both</em> gates at once.</p>
<p>This is actually a flaw (intended!) in the program. Look at the source code when a gate is interacted:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">on_gate_2_interact</span>(Context <span style="color:#f92672">*</span>ctx, <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y)
{
    <span style="color:#66d9ef">if</span> (ctx<span style="color:#f92672">-&gt;</span>inventory[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
    {
        <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>message <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
        strcpy(message, <span style="color:#e6db74">&#34;You don&#39;t have the required key!&#34;</span>);
        ctx<span style="color:#f92672">-&gt;</span>message <span style="color:#f92672">=</span> message;
        <span style="color:#66d9ef">return</span>;
    }
    <span style="color:#66d9ef">else</span>
    {
        <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>message <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">22</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
        strcpy(message, <span style="color:#e6db74">&#34;You unlocked a gate.&#34;</span>);
        ctx<span style="color:#f92672">-&gt;</span>message <span style="color:#f92672">=</span> message;
    }
    ctx<span style="color:#f92672">-&gt;</span>inventory[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">--</span>;
    ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x, y)]<span style="color:#f92672">-&gt;</span>type <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
    ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x, y)]<span style="color:#f92672">-&gt;</span>is_walkable <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x, y)]<span style="color:#f92672">-&gt;</span>on_interact <span style="color:#f92672">=</span> on_default_interact;
    ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x, y)]<span style="color:#f92672">-&gt;</span>is_interactable <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>The grid is copied to client&rsquo;s context when the connection is made. Also, the line</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x, y)]<span style="color:#f92672">-&gt;</span>is_walkable <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</code></pre></div><p>sets the gate into a walkable grid when we have the key. It is important to note that <code>ctx-&gt;grid[COORD(x, y)]</code> is a <em>pointer</em> to the <code>GameTile</code>. Instead of setting the grid on a particular coordinate to a walkable path, it sets the &ldquo;gate 2&rdquo; tile into a walkable tile. With that said, every &ldquo;gate 2&rdquo; tile will be replaced by a path tile.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map-gate-2.gif"   />
    
      <figcaption class="right" >Opening two gates with one key.</figcaption>
    
  </figure>


<h4 id="penetrating-the-walls-part-two">Penetrating the walls, part two<a href="#penetrating-the-walls-part-two" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>We will try to get through the inpenetratable wall to get <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-key-1.png" style="display: inline;"> on the top left&hellip; Well, you simply can&rsquo;t. You must get through the first gate without having that key.</p>
<p>The map in this game is implemented as an one-dimensional array and the indexes are calculated by the <code>COORD</code> macro from 2D coordinates. Smell something fishy?</p>
<p>Look at the map again and label the indexes and the coordinates on the tiles:</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map-gate-1-1.gif"   />
    
      <figcaption class="right" >The middle left and middle right of the map.</figcaption>
    
  </figure>


<p>However, the state sent to us includes a list of possible moves. If we are at $x = 0$ and we are facing leftwards, $x_2$ below is $x_2 = -1 &lt; 0$. Now we do not have <code>FORWARD</code> in our <code>possible_moves</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">send_state_via_ws</span>(Context <span style="color:#f92672">*</span>ctx)
{
    <span style="color:#75715e">// (skipped...)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> x2 <span style="color:#f92672">=</span> ctx<span style="color:#f92672">-&gt;</span>player<span style="color:#f92672">-&gt;</span>x <span style="color:#f92672">+</span> DXS[ctx<span style="color:#f92672">-&gt;</span>player<span style="color:#f92672">-&gt;</span>facing];
    <span style="color:#66d9ef">int</span> y2 <span style="color:#f92672">=</span> ctx<span style="color:#f92672">-&gt;</span>player<span style="color:#f92672">-&gt;</span>y <span style="color:#f92672">+</span> DYS[ctx<span style="color:#f92672">-&gt;</span>player<span style="color:#f92672">-&gt;</span>facing];
    <span style="color:#75715e">// (skipped...)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> x2 <span style="color:#f92672">&amp;&amp;</span> x2 <span style="color:#f92672">&lt;</span> GRID_COLS <span style="color:#f92672">&amp;&amp;</span>
        <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> y2 <span style="color:#f92672">&amp;&amp;</span> y2 <span style="color:#f92672">&lt;</span> GRID_ROWS <span style="color:#f92672">&amp;&amp;</span>
        ctx<span style="color:#f92672">-&gt;</span>grid[COORD(x2, y2)]<span style="color:#f92672">-&gt;</span>is_walkable)
        possible_moves[n_possible_moves<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> MOVE__FORWARD;
    <span style="color:#75715e">// (skipped...)
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Thus we will be unable to move forward as it has been blocked by the web client:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">moveForward</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">possibleMovesList</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">proto</span>.<span style="color:#a6e22e">Move</span>.<span style="color:#a6e22e">FORWARD</span>)) <span style="color:#66d9ef">return</span>
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">request</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">proto</span>.<span style="color:#a6e22e">Request</span>()
  <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">setMove</span>(<span style="color:#a6e22e">proto</span>.<span style="color:#a6e22e">Move</span>.<span style="color:#a6e22e">FORWARD</span>)

  <span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">serializeBinary</span>())
}
</code></pre></div><p>To deal with that, we can patch the function and throw the guard clause away. Since the server does <em>not</em> check require $x_2 \geq 0$ in the <code>walk</code> function. In this way, we can simply &ldquo;teleport&rdquo; from the left to the right.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-map-gate-1-2.gif"   />
    
      <figcaption class="right" >We moved in a warped space!</figcaption>
    
  </figure>


<p>Finally, let me share a screenshot of the game <em>Danganronpa v3</em>, where I borrowed the idea in this part.</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-danganronpa.png"   />
    
      <figcaption class="right" >Taken from the game <em>Danganronpa v3</em>, where this part is inspired from.</figcaption>
    
  </figure>


<p>Now we can skip the first gate and unlock the remaining gates. What is left is to walk towards the flag tile and interact with it, yielding the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">hkcert23{h0w_d1d_y0u_f1nd_s0_m4ny_vu1n3r461117y_47_th3_s4m3_t1m3??}
</code></pre></div><h3 id="postmortem">Postmortem<a href="#postmortem" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>I am very happy that the challenge actually worked. This is one of the challenges I wrote in late October, which is less than one month before the CTF begins. Good that it is still a decent challenge. Since the main focus is to identify bugs rather than dig deep into reverse engineering, I decided to implement the backend in C. Given that I am such an inexperienced C programmer, I am very grateful that the challenge was not pwnable (at least during the contest period).</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/lihkg-dog-math.gif"   />
    
  </figure>


<p>Apart from handling the C pointers, I also struggled a lot of visualing stuffs in 3D. Eventually, I decided to build everything from the ground up using CSS. That was not easy for someone like me (who is bad at geometry), and I spent around one day to get this implemented. Without <a href="https://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/">this blogpost from Franklin Ta</a>, I think I can never have the challenge finished. This is one of the screenshots I took while I develop:</p>

  <figure class="center" >
    <img src="/images/2024-01-27-hkcert-ctf/loot-and-scoot-dev-walls.png"   />
    
  </figure>


<p>Finally, I did not work on the graphics at all. What I did is to glue the royalty-free resources below into a viable user interface. Kudos to the project owners!</p>
<ul>
<li><a href="https://ronenness.github.io/RPGUI/">RPGUI</a> as the web interface</li>
<li><a href="https://thkaspar.itch.io/tth-animals">Tiny, tiny Heroes - Animals</a> for the snake, our only enemy in the game</li>
<li><a href="https://analogstudios.itch.io/dungeonold">dungeonOld_</a> for the tileset</li>
<li><a href="https://snoopethduckduck.itch.io/things">Things</a> for the items, including the keys and the flag</li>
<li><a href="https://bagong-games.itch.io/hana-caraka-base-character">Hana Caraka - Base Character</a> for the player used in the above illustrations</li>
</ul>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://mystiz.hk/posts/2024/2024-02-03-tetctf-adapt/">
                <span class="button__icon">←</span>
                <span class="button__text">TetCTF 2024: adapt</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://mystiz.hk/posts/2024/2024-01-27-hkcert-ctf-2/">
                <span class="button__text">HKCERT CTF 2023 Postmortem (II): Harder Crypto Challenges</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>


<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    HKCERT CTF 2023 Postmortem (III): The Remaining Challenges
  </a>
  <div class="js-toc"></div>
</aside>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
      headingSelector: 'h1, h2, h3, h4',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
</script>



  </div>
  <aside class="ads">
    
  
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-3220069814773012"
    data-ad-slot="6927401005"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  </aside>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://mystiz.hk/assets/main.js"></script>
<script src="https://mystiz.hk/assets/prism.js"></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }], trust: true })"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
<script>
var viz = new Viz();

document.querySelectorAll("[class=graphviz]").forEach(node => {
  const escape = function (s) {
    const t = s.replace(/&amp;/g, '&')
    return t.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#34;/g, '"')
  }
  viz.renderSVGElement(escape(node.innerText), {
    engine: 'dot'
  }).then(function (element) {
    node.parentNode.appendChild(element)
    node.style.display = 'none'
  })
})
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>
<link href="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram-min.min.css" rel="stylesheet" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram.min.js" crossorigin="anonymous"
  onload="
    Array.from(document.getElementsByClassName('sequence-diagram')).forEach(dom => {
      const content = new DOMParser().parseFromString(dom.innerHTML, 'text/html').documentElement.textContent;
      dom.innerHTML = '';
      Diagram.parse(content).drawSVG(dom, {
        theme: 'simple',
        'font-family': 'Fira Code'
      })
    })"></script>


  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VLBDVW913"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2VLBDVW913');
</script>




  
</div>

</body>
</html>
