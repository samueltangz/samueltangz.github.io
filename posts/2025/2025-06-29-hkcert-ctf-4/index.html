<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>HKCERT CTF 2024 Quals Writeup (IV): The Reverse Challenges :: Mystify</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="I also wrote some reverse challenges this year: Void, Cyp.ress and Bashed!. We will cover them all in the last part of the blog post.
Void Challenge Summary  I made a simple webpage that checks whether the flag is correct&amp;hellip; Wait, where are the flag-checking functions?
 We are given a static webpage (source code here), where it asks us for the flag:
 The goal is to provide a legit flag." />
<meta name="keywords" content="ctf" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://mystiz.hk/posts/2025/2025-06-29-hkcert-ctf-4/" />




<link rel="stylesheet" href="https://mystiz.hk/assets/style.css">

  <link rel="stylesheet" href="https://mystiz.hk/assets/mystiz.css">






<link rel="apple-touch-icon" href="https://mystiz.hk/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://mystiz.hk/img/favicon/mystiz.png">





<meta name="twitter:card" content="summary" />


  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="mystiz613" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HKCERT CTF 2024 Quals Writeup (IV): The Reverse Challenges">
<meta property="og:description" content="I also wrote some reverse challenges this year: Void, Cyp.ress and Bashed!. We will cover them all in the last part of the blog post." />
<meta property="og:url" content="https://mystiz.hk/posts/2025/2025-06-29-hkcert-ctf-4/" />
<meta property="og:site_name" content="Mystify" />

  
    <meta property="og:image" content="https://mystiz.hk/img/favicon/mystiz.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2025-06-29 15:30:03 &#43;0800 &#43;0800" />












  <script data-ad-client="ca-pub-3220069814773012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>
<body class="mystiz">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Mystify
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about-me">About Me</a></li>
        
      
        
          <li><a href="/blogroll">Blogroll</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about-me">About Me</a></li>
      
    
      
        <li><a href="/blogroll">Blogroll</a></li>
      
    
      
        <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://mystiz.hk/posts/2025/2025-06-29-hkcert-ctf-4/">HKCERT CTF 2024 Quals Writeup (IV): The Reverse Challenges</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2025-06-29 
      </span>
    
    
    <span class="post-author">:: Mystiz</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://mystiz.hk/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/hkcert-ctf/">hkcert-ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/challenge-writing/">challenge-writing</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/reverse/">reverse</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content js-toc-content"><div>
        <p>I also wrote some reverse challenges this year: <em>Void</em>, <em>Cyp.ress</em> and <em>Bashed!</em>. We will cover them all in the last part of the blog post.</p>
<h2 id="void">Void<a href="#void" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary">Challenge Summary<a href="#challenge-summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>I made a simple webpage that checks whether the flag is correct&hellip; Wait, where are the flag-checking functions?</p>
</blockquote>
<p>We are given a static webpage (source code <a href="https://github.com/blackb6a/hkcert-ctf-2024-challenges/blob/main/09-void/env/chall/files/index.html">here</a>), where it asks us for the flag:</p>















  


<video autoplay loop  style="width: 100%; margin: 0 auto; display: block;">
  <source src="/images/2025-06-29-hkcert-ctf/void-fail.webm" type="video/webm">
</video>
<p>The goal is to provide a legit flag.</p>
<h3 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>There is a bunch of whitespaces inside the <code>with</code> block. They are not the regular whitespace (U+0020), but the Hangul filler (<code>ㅤ</code>, U+3164). They are replaced with <code>_</code> below for visibility:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">with</span> (<span style="color:#a6e22e">ㅤ</span><span style="color:#e6db74">``</span> ) {
<span style="color:#a6e22e">_______</span>
<span style="color:#a6e22e">____</span>
<span style="color:#a6e22e">_______</span>
<span style="color:#a6e22e">________________</span>
<span style="color:#a6e22e">_______</span>
<span style="color:#a6e22e">_______________</span>
[<span style="color:#a6e22e">snipped</span>]
}
</code></pre></div><p>The below snippet written by <a href="https://twitter.com/aemkei" target="_blank" rel="nofollow">@aemkei</a> is why the invisible code block works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">\u3164</span>(){<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">f</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#a6e22e">p</span><span style="color:#f92672">=</span>[]  
,<span style="color:#66d9ef">new</span> Proxy({},{<span style="color:#a6e22e">has</span><span style="color:#f92672">:</span>(<span style="color:#a6e22e">t</span>,<span style="color:#a6e22e">n</span>)=&gt;(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">push</span>(
<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">length</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>),<span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">length</span><span style="color:#f92672">&amp;&amp;</span>(<span style="color:#a6e22e">p</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">||</span><span style="color:#a6e22e">p</span>[
<span style="color:#ae81ff">1</span>]<span style="color:#f92672">||</span>eval(<span style="color:#a6e22e">f</span>),<span style="color:#a6e22e">f</span><span style="color:#f92672">+=</span>String.<span style="color:#a6e22e">fromCharCode</span>
(<span style="color:#a6e22e">p</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">4</span><span style="color:#f92672">|</span><span style="color:#a6e22e">p</span>[<span style="color:#ae81ff">1</span>]),<span style="color:#a6e22e">p</span><span style="color:#f92672">=</span>[]),<span style="color:#f92672">!</span><span style="color:#ae81ff">0</span>)})}<span style="color:#75715e">//aem1k
</span></code></pre></div><p>To generate one byte, the function reads two lines from the &ldquo;code block&rdquo; and let there be $s+1$ and $t+1$ whitespaces on the two lines. It will append the character with ASCII value $16s + t$ to <code>p</code>. After <code>p</code> is ready, it will be evaluated by the <code>eval</code> function. Thus we can inject the functions in this way.</p>
<p>We can extract the <code>with</code> block and parse it manually to retrieve the <em>actual</em> code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;flag&#39;</span>);
<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">focus</span>();

<span style="color:#a6e22e">handleKeyPress</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span> =&gt; <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;Enter&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">check</span>();

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;hkcert24{j4v4scr1p7_1s_n0w_alm0s7_y3t_4n0th3r_wh173sp4c3_pr09r4mm1n9_l4ngu4g3}&#39;</span>) {
        <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">disabled</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
        <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;correct&#39;</span>);
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;wrong&#39;</span>);
        <span style="color:#a6e22e">setTimeout</span>(() =&gt; <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;wrong&#39;</span>), <span style="color:#ae81ff">500</span>);
    }
}
</code></pre></div>
  <figure class="left" >
    <img src="/images/2025-06-29-hkcert-ctf/void-success.png"   />
    
  </figure>


<div class="alert info">
  <p><strong>Alternative solutions.</strong> There are some simpler solutions provided by the contestants, which I found interesting:</p>
<ul>
<li><em>@wyli</em> downloaded the source code and changed <code>eval</code> to <code>console.log</code>. The source code is then logged into the console.</li>
<li><em>@jas</em> typed <code>alert(f)</code> into the console and the source code pops up. This is because <code>f</code> is the variable that stores the code inside the function <code>\u3164</code>.</li>
</ul>

</div>

<h2 id="cypress">Cyp.ress<a href="#cypress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-1">Challenge Summary<a href="#challenge-summary-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>You will get sser.pyc when you reverse the title. Now reverse it back for me.</p>
<p>Attachment: <a href="https://github.com/blackb6a/hkcert-ctf-2024-challenges-public/releases/download/v1.0.0/cypress_5788c6411dc79b08e280746a07306538.zip">cypress_5788c6411dc79b08e280746a07306538.zip</a></p>
</blockquote>
<p>We are given a <code>.pyc</code> file.</p>
<h3 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>We can throw the <code>.pyc</code> file to the online decompilers. Most of the existing decompilers do not support Python 3.12. While <a href="http://tool.lu/en_US/pyc">tool.lu</a> is accepting Python 3.12, it fails to decompile the entire binary file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python</span>
<span style="color:#75715e"># visit https://tool.lu/pyc/ for more information</span>
<span style="color:#75715e"># Version: Python 3.12</span>

<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
<span style="color:#f92672">import</span> hashlib
<span style="color:#75715e"># WARNING: Decompyle incomplete</span>
</code></pre></div><p>We are hinted, however, that it uses the <code>os</code>, <code>requests</code>, <code>Crypto</code> and <code>hashlib</code> packages. We can override these packages to guess the program&rsquo;s logic.</p>
<div class="alert danger">
  ⚠️ <strong>Warning!</strong> Do this only if you trust the author, or work in an isolated environment. Running unknown code on your own machine is dangerous.
</div>

<p>To do this, we will create multiple files along with the <code>.pyc</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">├── sser.cpython-312.pyc
├── Crypto
│   ├── __init__.py
│   └── Cipher.py
├── hashlib.py
├── os.py
└── requests.py
</code></pre></div><p>This is a sample transcript by running the program with <code>python3.12 sser.cpython-312.pyc</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">python3.12 sser.cpython-312.pyc
Traceback (most recent call last):
  File &#34;sser.py&#34;, line -1, in &lt;module&gt;
ImportError: cannot import name &#39;AES&#39; from &#39;Crypto.Cipher&#39; (/[omitted]/Crypto/Cipher.py)
</code></pre></div><p>We will create a placeholder class in <code>Crypto/Cipher.py</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AES</span>:
    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;AES(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
</code></pre></div><p>Re-running the program, we are asked to provide <code>hashlib.sha256</code>, as shown below. Let&rsquo;s update <code>hashlib.py</code> in a similar fashion.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">python3.12 sser.cpython-312.pyc
&#39;What is the flag?&gt; &#39;
hkcert24{test}
Traceback (most recent call last):
  File &#34;sser.py&#34;, line -1, in &lt;module&gt;
  File &#34;sser.py&#34;, line 9, in get_nonce
AttributeError: module &#39;hashlib&#39; has no attribute &#39;sha256&#39;
</code></pre></div><p>Now we have the class implemented. Let&rsquo;s re-run the binary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">python3.12 sser.cpython-312.pyc
&#39;What is the flag?&gt; &#39;
hkcert24{test}
hashlib.sha256((b&#39;pow/yB8T$D@\x05\x89\\\xc7\xa2n\x99\x03\xbd&#39;,), {})
Traceback (most recent call last):
  File &#34;sser.py&#34;, line -1, in &lt;module&gt;
  File &#34;sser.py&#34;, line 9, in get_nonce
AttributeError: &#39;sha256&#39; object has no attribute &#39;digest&#39;
</code></pre></div><p>Turns out they are using the <code>.digest</code> method of the <code>sha256</code> class. Let&rsquo;s add that as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">sha256</span>:
    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;hashlib.sha256(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">digest</span>(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">256</span>
</code></pre></div><p>However, the program does not seem to terminate when we re-run the binary. Let&rsquo;s update <code>hashlib.py</code> to</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">sha256</span>:
    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        res <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">32</span>)
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;hashlib.sha256(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">) := </span><span style="color:#e6db74">{</span>res<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
        self<span style="color:#f92672">.</span>res <span style="color:#f92672">=</span> res

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">digest</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>res
</code></pre></div><div class="alert warning">
  😕 <strong>Why isn&rsquo;t <code>os.py</code> taken effect?</strong> Turns out that we are using a different importer when importing <code>os</code> &ndash; it does not use the <code>SourceFileLoader</code> but the <code>FrozenImporter</code>. This hints that <code>os.py</code> might not be overridden.
</div>

<p>Now the program finally terminates:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">python3.12 sser.cpython-312.pyc
&#39;What is the flag?&gt; &#39;
hkcert24{test}
hashlib.sha256((b&#39;pow/D\xa5\xbb\x85u\xb2~~\xb7\xae\xb2/\x97\xf4\xc9\x02&#39;,), {}) := b&#39;\x9b\xfcR\xd0\xea\\L&lt;\x0c&#34;\xb6u&#34;\xdc\x85\xbc@\x90\xf1\x06&amp;\xf5\xe5\xb7\xd9+6_\xd5[\xbe$&#39;
[...omitted...]
hashlib.sha256((b&#39;pow/\x8f?j\xbc\xc7\xbd\x85\xfb\x88\x90\xee,\xd7~\xba\x05&#39;,), {}) := b&#39;Q\xc4\xf6\xf9\x9c\xe7\x91_\x99 &lt;%i\xa8\x8c\xfb\xad\x9c\xdf\xe7&gt;L\x19\xa7.\x8c\x1eN\n\xcc\xae-&#39;
hashlib.sha256((b&#39;pow/\x94Py\xed\xeb}\xce6q\xacx\xfbw.\xe4\xd2&#39;,), {}) := b&#39;\x00\x00\x00\x92A\x85\xcfl\x88\x16\x81L\x1b\x10Y\xa9kP\xd2DT\x1f\xc7&lt;\x0b2:\x96v^\xbb\x9e&#39;
Traceback (most recent call last):
  File &#34;sser.py&#34;, line -1, in &lt;module&gt;
AttributeError: module &#39;requests&#39; has no attribute &#39;post&#39;
</code></pre></div><p>Running the program multiple times and collect the last line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">hashlib.sha256((b&#39;pow/\xf9\x1a\xdf\xb9@u\xcf*W\x9a\x9d\x94F\xcbg\xe3&#39;,), {}) := b&#39;\x00\x00\x00\x99\xa7-\xd0\x04\x89\x1e^\xf6\xf2O2\x1d^\x11/\x9esg\nk\x1a\xda\x12\xadL\xe7\xda\x13&#39;
hashlib.sha256((b&#39;pow/zg\xe6\x8c\xeea\x8aw\x8bT\x93\x96&gt;\x97\xd0\x0c&#39;,), {}) := b&#39;\x00\x00\x00E\xa9\xaa\xa3~=\xe0\x1fv\xd2\xc9Z\xfdW\xa1\x89#\xe7\xcdq\xc2\xdb\x06\x0c\xbc&lt;\xbc\xedc&#39;
</code></pre></div><p>The first three bytes of the digest are always $\texttt{000000}$. We will update <code>hashlib.py</code> to always return three leading null bytes. Also, we will create <code>requests.py</code> and define as well <code>self.text</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">post</span>:
    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;post(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
        self<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</code></pre></div><p>After that, we got <code>AttributeError: type object 'AES' has no attribute 'new'</code>. Let&rsquo;s work on some changes on <code>Crypto/Cipher.py</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Updated Crypto/Cipher.py</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AES</span>:
    MODE_CFB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1337</span>

    <span style="color:#a6e22e">@classmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">new</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">cipher</span>:
            <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;cipher.encrypt(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;ciphertext&#39;</span>

        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;AES.new(</span><span style="color:#e6db74">{</span>args<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>kwargs<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
        <span style="color:#66d9ef">return</span> cipher()
</code></pre></div><p>Now we have a full transcript that doesn&rsquo;t fail:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">python3.12 sser.cpython-312.pyc
&#39;What is the flag?&gt; &#39;
hkcert24{test}
hashlib.sha256((b&#39;pow/\xb6n&lt;\xba\xcb\x89\xf4\\\x0b\xb6G\x9d\xea\x98\xd3M&#39;,), {}) := b&#39;\x00\x00\x00\x1b\xfayjX\xf6\x7f-\xb5i\x1a\x07\xb4\x96@\x979\x8a8\x9c\xde=NV|\xd5i&gt;5&#39;
post((&#39;https://c12-cypress.hkcert24.pwnable.hk/&#39;,), {&#39;json&#39;: {&#39;nonce&#39;: &#39;b66e3cbacb89f45c0bb6479dea98d34d&#39;}})
hashlib.sha256((b&#39;key/\xb6n&lt;\xba\xcb\x89\xf4\\\x0b\xb6G\x9d\xea\x98\xd3M&#39;,), {}) := b&#39;\x00\x00\x00\xdfa\xcaf\x82%\xf5\xd6p*O(\x99\x9d\xe9/6\x82JT\x05\xf5#\x028\x07\x01\xc9\xe5&#39;
hashlib.sha256((b&#39;iv/\xb6n&lt;\xba\xcb\x89\xf4\\\x0b\xb6G\x9d\xea\x98\xd3M&#39;,), {}) := b&#39;\x00\x00\x00,\xfe\x18IS\xbafZ\x80|&amp;S\xc1\xc4/\x86\x96\xed\xb5\x9f\xed\xee|,\x1f\xaa\x80\xa1\xb0&#39;
AES.new((b&#39;\x00\x00\x00\xdfa\xcaf\x82%\xf5\xd6p*O(\x99&#39;, 1337, b&#39;\x00\x00\x00,\xfe\x18IS\xbafZ\x80|&amp;S\xc1&#39;), {})
cipher.encrypt((b&#39;hkcert24{test}&#39;,), {})
🙅
</code></pre></div><p>Additionally, when sending a POST request to the remote endpoint with a proper nonce (i.e., its hash has leading null bytes), it will return a hexstring. Maybe this is the ciphertext that we want to compare? We can have a rough guess on the flow:</p>
<div style="text-align: center;">
  <div class="graphviz">
  digraph {
    graph [bgcolor="transparent"]
    node [color="#ffe4e1", fontcolor="#ffe4e1", fillcolor="#33333c", style="filled"]
    edge [color="#ffe4e1", fontcolor="#ffe4e1"]

    
node[shape=box]
n1 -&amp;gt; n2
n2 -&amp;gt; n3
n3 -&amp;gt; n4
n4 -&amp;gt; n5

n1[label=&amp;#34;Generate nonce with three leading null bytes in its hash&amp;#34;, margin=&amp;#34;0.2,0&amp;#34;]
n2[label=&amp;#34;Request \&amp;#34;something\&amp;#34; from the remote challenge server&amp;#34;, margin=&amp;#34;0.2,0&amp;#34;]
n3[label=&amp;#34;Derive a key and an IV from the nonce&amp;#34;, margin=&amp;#34;0.2,0&amp;#34;]
n4[label=&amp;#34;Encrypt the message using AES-CFB&amp;#34;, margin=&amp;#34;0.2,0&amp;#34;]
n5[label=&amp;#34;Print 🙅 when the ciphertext doesn&amp;#39;t match with the HTTP response&amp;#34;, margin=&amp;#34;0.2,0&amp;#34;]

  }
  </div>
</div>    
<p>We can reverse the process &ndash; by generating a proper nonce, we can ask the server for the encrypted flag. Since we have the key and the IV, we are able to decrypt the flag on our own:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">hkcert24{y0u_c4n_h00k_func710ns_t0_35c4p3_fr0m_r3v3r5e_3n9e3r1n9}
</code></pre></div><h4 id="zoomers-solution">Zoomer&rsquo;s solution<a href="#zoomers-solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Turns out <em>ChatGPT</em> is able to rebuild 80% of the code &ndash; below is the reconstructed code with <code>GPT-4o</code>. We will provide a diff to the actual source code (the red lines are the incorrect ones):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">  import os
  import requests
  from Crypto.Cipher import AES
  import hashlib

  def get_nonce():
      while True:
          nonce = os.urandom(16)
          h = hashlib.sha256(b&#39;pow/&#39; + nonce).digest()
<span style="color:#f92672">-         if h[0] &lt; 3:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+         if h[:3] == b&#39;\0\0\0&#39;:
</span><span style="color:#a6e22e"></span>              return nonce


  flag = input(&#34;What is the flag?&gt; &#34;)
  nonce = get_nonce()

  r = requests.post(
      &#34;https://c12-cypress.hkcert24.pwnable.hk/&#34;,
      json={
<span style="color:#f92672">-         &#34;key&#34;: hashlib.sha256(flag.encode()).digest().hex(),
</span><span style="color:#f92672">-         &#34;iv&#34;: hashlib.sha256(nonce).digest().hex(),
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+         &#34;nonce&#34;: nonce.hex(),
</span><span style="color:#a6e22e"></span>      },
  )

<span style="color:#f92672">- c0 = bytes.fromhex(r.text[:32])
</span><span style="color:#f92672">- c1 = bytes.fromhex(r.text[32:])
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+ c0 = bytes.fromhex(r.text)
</span><span style="color:#a6e22e"></span>
  cipher = AES.new(
<span style="color:#f92672">-     hashlib.sha256(flag.encode()).digest(),
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+     hashlib.sha256(b&#34;key/&#34; + nonce&#34;).digest()[:16],
</span><span style="color:#a6e22e"></span>      AES.MODE_CFB,
<span style="color:#f92672">-     hashlib.sha256(nonce).digest()
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+     hashlib.sha256(b&#34;iv/&#34; + nonce&#34;).digest()[:16]
</span><span style="color:#a6e22e"></span>  )

<span style="color:#f92672">- decrypted = cipher.decrypt(c1)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+ c1 = cipher.encrypt(flag)
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">- if decrypted == b&#34;🙆🙅&#34;:
</span><span style="color:#f92672">-     print(&#34;Correct!&#34;)
</span><span style="color:#f92672">- else:
</span><span style="color:#f92672">-     print(&#34;Wrong!&#34;)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+ print(&#39;🙆🙅&#39;[c0 != c1])
</span></code></pre></div><h2 id="bashed">Bashed!<a href="#bashed" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-2">Challenge Summary<a href="#challenge-summary-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>The program has only one meaningful function, and the function is less than 500 bytes long. What&rsquo;s hard understanding it?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">./out.sh ***FLAG***
❤️
</code></pre></div><p>Attachment: <a href="https://github.com/blackb6a/hkcert-ctf-2024-challenges-public/releases/download/v1.0.0/bashed_89d984b177c984086cf3a5db1cb30adf.zip">bashed_89d984b177c984086cf3a5db1cb30adf.zip</a></p>
</blockquote>
<p>The contestants are given <code>❤️.sh</code>, which has a lot of emojis. The below is a snippet of the bash file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
FLAG<span style="color:#f92672">=</span>$1
GALF<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">if</span> ! <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$FLAG<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span>~ ^<span style="color:#f92672">[</span>0-9A-Za-z_<span style="color:#f92672">{}]{</span>87<span style="color:#f92672">}</span>$ <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span> echo 💔; exit 0; <span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">function</span> 🌚<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo <span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#34;%d&#34;</span> <span style="color:#e6db74">&#34;&#39;</span>$1<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 🌝<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo <span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#34;%x&#34;</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 🍋<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    u<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">${</span>FLAG:<span style="color:#66d9ef">$(($(</span>🌚 $1<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">)))</span>:<span style="color:#66d9ef">$(($(</span>🌚 $2<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">)))</span><span style="color:#e6db74">}</span> | sha1sum<span style="color:#66d9ef">)</span>;
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>u:1:1<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">$(</span>🌝 <span style="color:#66d9ef">$(($(</span>🌚 $3<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">))))</span> <span style="color:#f92672">]]</span>;
        <span style="color:#66d9ef">then</span> wget https://c22-bashed.hkcert24.pwnable.hk/$4.sh -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;1; GALF<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>GALF*<span style="color:#66d9ef">$(</span>🌚 $6<span style="color:#66d9ef">)))</span>;
        <span style="color:#66d9ef">else</span> wget https://c22-bashed.hkcert24.pwnable.hk/$5.sh -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;1; GALF<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>GALF*<span style="color:#66d9ef">$(</span>🌚 $7<span style="color:#66d9ef">)))</span>;
    <span style="color:#66d9ef">fi</span>;
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 👂<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $1 $5 $2 $3 $7 $6 $4; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 👃<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $5 $6 $4 $7 $3 $2 $1; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 👄<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $5 $6 $2 $4 $3 $1 $7; <span style="color:#f92672">}</span>
<span style="color:#75715e"># ...</span>

👚 👣 👺 👅 👳 👱 👄 👂  
👢 👄 💅 👂 👣 👲 👅 👋  
👥 👈 💐 💁 👄 👞 👒 👧 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👄 💇 👥 💁 👒 💀 👅 👂 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👞 👆 💅 👂 💄 👅 👽 💓  
<span style="color:#75715e"># ...</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$GALF<span style="color:#e6db74">&#34;</span> -ne <span style="color:#ae81ff">0</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span> echo ❤️; <span style="color:#66d9ef">else</span> echo 💔; <span style="color:#66d9ef">fi</span>
</code></pre></div><p>The goal is to execute <code>./out.sh **FLAG**</code> and make it output <code>❤️</code>.</p>
<h3 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="the-engine-self-updating-script-files">The engine: Self-updating script files<a href="#the-engine-self-updating-script-files" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Suppose that you have a file called <code>foo.sh</code> with the below content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
wget https://mystiz.hk/fun -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span>
echo :<span style="color:#f92672">)</span>
</code></pre></div><p>Guess what will be printed? You can try it if you are interested. In short, <em>I don&rsquo;t know</em>. It depends on what is hosted on <code>https://mystiz.hk/fun</code>.</p>
<p>Assume that below is the content on the <code>/fun</code> endpoint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
wget https://mystiz.hk/fun -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span>
echo :<span style="color:#f92672">(</span>
</code></pre></div><p>In that case, running <code>./foo.sh</code> in your terminal would print <code>:(</code>.</p>
<p>The idea, in short, is that Bash keeps track of the &ldquo;pointer&rdquo; of the script - after each command, it proceeds to read the next command and executes it.</p>
<p>The first command is <code>wget ...</code>, and the next instruction will be at the beginning of <code>echo :)</code>. When the command is executed, the file is overwritten. It then reads the next command, which is overwritten to <code>echo :(</code>.</p>
<p>This is the heart of the challenge, and let&rsquo;s proceed with reverse engineering the given script.</p>
<h4 id="understanding-the-functions-in-the-challenge-file">Understanding the functions in the challenge file<a href="#understanding-the-functions-in-the-challenge-file" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> 🌚<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo <span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#34;%d&#34;</span> <span style="color:#e6db74">&#34;&#39;</span>$1<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 🌝<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> echo <span style="color:#66d9ef">$(</span>printf <span style="color:#e6db74">&#34;%x&#34;</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 🍋<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    u<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">${</span>FLAG:<span style="color:#66d9ef">$(($(</span>🌚 $1<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">)))</span>:<span style="color:#66d9ef">$(($(</span>🌚 $2<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">)))</span><span style="color:#e6db74">}</span> | sha1sum<span style="color:#66d9ef">)</span>;
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${</span>u:1:1<span style="color:#e6db74">}</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">$(</span>🌝 <span style="color:#66d9ef">$(($(</span>🌚 $3<span style="color:#66d9ef">)</span><span style="color:#f92672">-</span><span style="color:#66d9ef">$(</span>🌚 👂<span style="color:#66d9ef">))))</span> <span style="color:#f92672">]]</span>;
        <span style="color:#66d9ef">then</span> wget https://c22-bashed.hkcert24.pwnable.hk/$4.sh -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;1; GALF<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>GALF*<span style="color:#66d9ef">$(</span>🌚 $6<span style="color:#66d9ef">)))</span>;
        <span style="color:#66d9ef">else</span> wget https://c22-bashed.hkcert24.pwnable.hk/$5.sh -O <span style="color:#66d9ef">$(</span>basename $0<span style="color:#66d9ef">)</span> &gt;/dev/null 2&gt;&amp;1; GALF<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>GALF*<span style="color:#66d9ef">$(</span>🌚 $7<span style="color:#66d9ef">)))</span>;
    <span style="color:#66d9ef">fi</span>;
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 👂<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $1 $5 $2 $3 $7 $6 $4; <span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> 👃<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $5 $6 $4 $7 $3 $2 $1; <span style="color:#f92672">}</span>
<span style="color:#75715e"># ...</span>
</code></pre></div><p>There are a number of functions in the Bash file, namely, <code>🌚</code>, <code>🌝</code>, <code>🍋</code>, <code>👂</code> and so on.</p>
<p>We can see that</p>
<ul>
<li><code>🌚(x)</code> returns the ASCII value of the character <code>x</code>,</li>
<li><code>🌝(x)</code> returns the number <code>x</code> in hex, and</li>
<li><code>👂</code>, <code>👃</code>, &hellip; are calling <code>🍋</code> with the parameters shuffled.</li>
</ul>
<p><code>🍋</code> is the most complicated function. There are seven parameters in the function (we will use <code>x1</code> up to <code>x7</code>), and it performs the following procedures:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#960050;background-color:#1e0010">🍋</span>(x1, x2, x3, x4, x5, x6, x7):
    X <span style="color:#f92672">=</span> ord(<span style="color:#e6db74">&#39;👂&#39;</span>) <span style="color:#75715e"># 128066</span>

    u <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(FLAG[x1<span style="color:#f92672">-</span>X:(x1<span style="color:#f92672">-</span>X)<span style="color:#f92672">+</span>(x2<span style="color:#f92672">-</span>X)])<span style="color:#f92672">.</span>hexdigest()
    <span style="color:#66d9ef">if</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> format(<span style="color:#e6db74">&#39;x&#39;</span>, (x3<span style="color:#f92672">-</span>X)):
        download_and_replace(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;https://c22-bashed.hkcert24.pwnable.hk/</span><span style="color:#e6db74">{</span>x4<span style="color:#e6db74">}</span><span style="color:#e6db74">.sh&#39;</span>)
        GALF <span style="color:#f92672">*=</span> ord(x6)
    <span style="color:#66d9ef">else</span>:
        download_and_replace(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;https://c22-bashed.hkcert24.pwnable.hk/</span><span style="color:#e6db74">{</span>x5<span style="color:#e6db74">}</span><span style="color:#e6db74">.sh&#39;</span>)
        GALF <span style="color:#f92672">*=</span> ord(x7)
</code></pre></div><p>Here <code>download_and_replace</code> is a function that downloads and replaces the current Bash file.</p>
<p>Finally, <code>GALF</code> starts at <code>1</code> and the goal is to make <code>GALF != 0</code> after a series of &ldquo;emojis&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">👚 👣 👺 👅 👳 👱 👄 👂  
👢 👄 💅 👂 👣 👲 👅 👋  
👥 👈 💐 💁 👄 👞 👒 👧 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👄 💇 👥 💁 👒 💀 👅 👂 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👞 👆 💅 👂 💄 👅 👽 💓  
👋 👈 💌 👢 👱 👂 👛 👅  
<span style="color:#75715e"># ...</span>
</code></pre></div><p>Since the numbers are 64 bits in Bash on a 64-bit OS, we will eventually get a $0$ if we have multiplied 64 $2$&rsquo;s. Therefore, we must find a path that multiplies less than 64 $2$&rsquo;s to keep <code>GALF</code> nonzero.</p>
<div class="alert warning">
  🙏 <strong>Apologies!</strong> Sorry if you are using a 32-bit operating system - I haven&rsquo;t considered it enough to support that. However, please consider getting a 64-bit one.
</div>

<h4 id="call-sequence-of-the-functions">Call sequence of the functions<a href="#call-sequence-of-the-functions" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>As an example, the third instruction is</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">👥 👈 💐 💁 👄 👞 👒 👧 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👄 💇 👥 💁 👒 💀 👅 👂 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👞 👆 💅 👂 💄 👅 👽 💓  
</code></pre></div><p>This is equivalent to the instruction <code>🍋 👞 👄 👈 👧 👒 💁 💐</code> because of how <code>👥</code> is defined:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">function</span> 👥<span style="color:#f92672">()</span> <span style="color:#f92672">{</span> 🍋 $5 $4 $1 $7 $6 $3 $2; <span style="color:#f92672">}</span>
</code></pre></div><p>The eighth parameter onwards is dropped. Also, the below shows the ASCII values of the parameters:</p>
<ul>
<li>👞 (ASCII value: $128094 = 128066 + 28$)</li>
<li>👄 (ASCII value: $128068 = 128066 + 2$)</li>
<li>👈 (ASCII value: $128072 = 128066 + 6$)</li>
<li>👧 (ASCII value: $128103 = 128066 + 37$)</li>
<li>👒 (ASCII value: $128082 = 128066 + 16$)</li>
<li>💁 (ASCII value: $128129 = 128066 + 63$)</li>
<li>💐 (ASCII value: $128144 = 128066 + 78$)</li>
</ul>
<p>Therefore the actual logic for this line would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 👥 👈 💐 💁 👄 👞 👒 👧</span>
<span style="color:#75715e"># --&gt; 🍋 👞 👄 👈 👧 👒 💁 💐</span>

u <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(FLAG[<span style="color:#ae81ff">28</span>:<span style="color:#ae81ff">30</span>])<span style="color:#f92672">.</span>hexdigest() <span style="color:#75715e"># 👞 = 128066 + 28, 👄 = 128066 + 2 </span>
<span style="color:#66d9ef">if</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;6&#39;</span>: <span style="color:#75715e"># 👈 = 128066 + 6</span>
    download_and_replace(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;https://c22-bashed.hkcert24.pwnable.hk/👧.sh&#39;</span>)
    GALF <span style="color:#f92672">*=</span> <span style="color:#ae81ff">128129</span> <span style="color:#75715e"># 💁 = 128129</span>
<span style="color:#66d9ef">else</span>:
    download_and_replace(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;https://c22-bashed.hkcert24.pwnable.hk/👒.sh&#39;</span>)
    GALF <span style="color:#f92672">*=</span> <span style="color:#ae81ff">128144</span> <span style="color:#75715e"># 💐 = 128144</span>
</code></pre></div><p>If <code>u[1:2] == '6'</code>, it will proceed and call the next instruction from <code>👧.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">👋 👈 💌 👢 👱 👂 👛 👅 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👶 💉 👯 💍 👃 💅 👗 👂 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👌 💏 👃 👟 💔 💌 👤 👵 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>👋 👵 👚 👣 💈 👈 💃 👃
</code></pre></div><p>Otherwise, it would call the below instruction from <code>👒.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">👋 👈 💌 👢 👱 👂 👛 👅
</code></pre></div><p>We can see that the next instruction depends on the file downloaded. There is only one path that makes <code>GALF</code> nonzero, and these are the conditions:</p>
<p>$$
\begin{aligned}
f(\text{flag}_{1} \ \| \ \text{flag}_{2}) &amp;= \texttt{0a}_{16} \\
f(\text{flag}_{2} \ \| \ \text{flag}_{3}) &amp;= \texttt{17}_{16} \\
\vdots &amp; \\
f(\text{flag}_{2} \ \| \ \text{flag}_{3}) &amp;= \texttt{17}_{16}
\end{aligned}
$$</p>
<p>Here $f(x)$ is the second hexadecimal character of $\texttt{SHA1}(x)$. There is a unique solution for this, too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">hkcert24{s33m1n9ly_b3g19n_b4sh_scr1p7s_c0u1d_b3_d4n93r0us_wh3n_7h3y_4r3_s3lf_m0d1fy1n9}
</code></pre></div><div class="alert info">
  <strong>🧀 Cheese!</strong> There are much more solves than I anticipated. Turns out that there is an unintended solution &ndash; <em>@desp</em> mentioned that he <em>englished</em> through. On the other hand, <em>@Aali</em> cheesed in a way by checking whether <code>0 &lt;= x3 &lt; 16</code>, since this is the only way to get the hash check passing.
</div>


      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://mystiz.hk/posts/2025/2025-06-30-google-ctf/">
                <span class="button__icon">←</span>
                <span class="button__text">Google CTF 2025 Quals Writeup</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://mystiz.hk/posts/2025/2025-06-29-hkcert-ctf-3/">
                <span class="button__text">HKCERT CTF 2024 Quals Writeup (III): The Web Challenges</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>


<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    HKCERT CTF 2024 Quals Writeup (IV): The Reverse Challenges
  </a>
  <div class="js-toc"></div>
</aside>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
      headingSelector: 'h1, h2, h3, h4',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
</script>



  </div>
  <aside class="ads">
    
  
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-3220069814773012"
    data-ad-slot="6927401005"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  </aside>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://mystiz.hk/assets/main.js"></script>
<script src="https://mystiz.hk/assets/prism.js"></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }], trust: true })"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
<script>
var viz = new Viz();

document.querySelectorAll("[class=graphviz]").forEach(node => {
  const escape = function (s) {
    const t = s.replace(/&amp;/g, '&')
    return t.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#34;/g, '"')
  }
  viz.renderSVGElement(escape(node.innerText), {
    engine: 'dot'
  }).then(function (element) {
    node.parentNode.appendChild(element)
    node.style.display = 'none'
  })
})
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>
<link href="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram-min.min.css" rel="stylesheet" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram.min.js" crossorigin="anonymous"
  onload="
    Array.from(document.getElementsByClassName('sequence-diagram')).forEach(dom => {
      const content = new DOMParser().parseFromString(dom.innerHTML, 'text/html').documentElement.textContent;
      dom.innerHTML = '';
      Diagram.parse(content).drawSVG(dom, {
        theme: 'simple',
        'font-family': 'Fira Code'
      })
    })"></script>


  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VLBDVW913"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2VLBDVW913');
</script>




  
</div>

</body>
</html>
