<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>MOCSCTF 2022 Postmortem :: Mystify</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="@blackb6a helped preparing some challenges for MOCSCTF, a 8.5-hour long CTF in Macau. This time I wrote nine challenges and @hoifanrd made one of them (3-AES). This blog post covers the intended solution for all of them.
These are the summary of the challenges:
   Challenge Name Category Solves     RSA Trio Crypto 2/43   Slightly Informative Crypto 2/43   NP-SHA256 Crypto 1/43   HMAC-SHA256 Crypto 2/43   RC4 Crypto 0/43   HashTable Misc 3/43   Wordle Crypto, Misc 0/43   3-AES Crypto, Misc 0/43   Elementary Reverse 0/43   Redactor Reverse 1/43    RSA Trio (Crypto) Challenge Summary When connected to the server, three 1024-bit primes $p$, $q$ and $r$ are generated." />
<meta name="keywords" content="ctf" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/2022-02-19-mocsctf/" />




<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/mystiz.css">






<link rel="apple-touch-icon" href="/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="/img/favicon/mystiz.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="mystiz613" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="MOCSCTF 2022 Postmortem">
<meta property="og:description" content="@blackb6a helped preparing some challenges for MOCSCTF, a 8.5-hour long CTF in Macau. This time I wrote nine challenges and @hoifanrd made one of them (3-AES). This blog post covers the intended solution for all of them." />
<meta property="og:url" content="/posts/2022-02-19-mocsctf/" />
<meta property="og:site_name" content="Mystify" />

  <meta property="og:image" content="/">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-02-19 17:50:00 &#43;0800 &#43;0800" />












  <script data-ad-client="ca-pub-3220069814773012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>
<body class="mystiz">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Mystify
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about-me">About Me</a></li>
        
      
        
          <li><a href="/blogroll">Blogroll</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about-me">About Me</a></li>
      
    
      
        <li><a href="/blogroll">Blogroll</a></li>
      
    
      
        <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/posts/2022-02-19-mocsctf/">MOCSCTF 2022 Postmortem</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-02-19 
      </span>
    
    
    <span class="post-author">:: Mystiz</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="/tags/mocsctf/">mocsctf</a>&nbsp;
    
    #<a href="/tags/challenge-writing/">challenge-writing</a>&nbsp;
    
  </span>
  

  

  <div class="post-content js-toc-content"><div>
        <p><a href="https://twitter.com/blackb6a" target="_blank" rel="nofollow">@blackb6a</a> helped preparing some challenges for MOCSCTF, a 8.5-hour long CTF in Macau. This time I wrote nine challenges and <a href="https://twitter.com/hoifanrd" target="_blank" rel="nofollow">@hoifanrd</a> made one of them (3-AES). This blog post covers the intended solution for all of them.</p>

<p>These are the summary of the challenges:</p>

<table>
<thead>
<tr>
<th>Challenge Name</th>
<th>Category</th>
<th>Solves</th>
</tr>
</thead>

<tbody>
<tr>
<td>RSA Trio</td>
<td>Crypto</td>
<td>2/43</td>
</tr>

<tr>
<td>Slightly Informative</td>
<td>Crypto</td>
<td>2/43</td>
</tr>

<tr>
<td>NP-SHA256</td>
<td>Crypto</td>
<td>1/43</td>
</tr>

<tr>
<td>HMAC-SHA256</td>
<td>Crypto</td>
<td>2/43</td>
</tr>

<tr>
<td>RC4</td>
<td>Crypto</td>
<td>0/43</td>
</tr>

<tr>
<td>HashTable</td>
<td>Misc</td>
<td>3/43</td>
</tr>

<tr>
<td>Wordle</td>
<td>Crypto, Misc</td>
<td>0/43</td>
</tr>

<tr>
<td>3-AES</td>
<td>Crypto, Misc</td>
<td>0/43</td>
</tr>

<tr>
<td>Elementary</td>
<td>Reverse</td>
<td>0/43</td>
</tr>

<tr>
<td>Redactor</td>
<td>Reverse</td>
<td>1/43</td>
</tr>
</tbody>
</table>

<h2 id="rsa-trio-crypto">RSA Trio (Crypto)<a href="#rsa-trio-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary">Challenge Summary<a href="#challenge-summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>When connected to the server, three 1024-bit primes $p$, $q$ and $r$ are generated. Let $n_1 = pq$, $n_2 = qr$ and $n_3 = rp$ and three RSA public keys $(n_1, e)$, $(n_2, e)$, $(n_3, e)$ are constructed (here <code>e = 0b10001</code> and $q &lt; p &lt; r$, i.e., $n_1 &lt; n_2 &lt; n_3$).</p>

<p>Let $\mathcal{E}(m)$ be the encryption function that returns the ciphertext $c$:</p>

<p><span  class="math">\[\begin{aligned}
& t_1 = m^e\ \text{mod}\ n_1 \\
& t_2 = {t_1}^e\ \text{mod}\ n_2 \\
& c = {t_2}^e\ \text{mod}\ n_3.
\end{aligned}\]</span></p>

<p>Long story short: the message is encrypted with the RSA public keys in order. Also, if $m \not\in [0, n_1)$, $t_1 \not\in [0, n_2)$ or $t_2 \not\in [0, n_3)$, nothing will be returned.</p>

<p>We are allowed to call the encryption function $\mathcal{E}$ for an arbitrary amount of times and are given $\mathcal{E}(\text{flag})$ at the very beginning. The goal is to recover the flag.</p>

<h3 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="recovering-n1">Recovering $n_1$<a href="#recovering-n1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>Since $t_1 = m^e\ \text{mod}\ n_1 \in [0, n_1) \subset [0, n_2)$, it is impossible that $t_1 \not\in [0, n_2)$. Likewise it is always true that $t_2 \in [0, n_3)$. That said, we can get a ciphertext of $m$ if and only if $m \in [0, n_1)$. Since $0 \leq n_1 &lt; 2^{2048}$, we can recover $n_1$ via binary search calling $\mathcal{E}$ 2048 times.</p>

<h4 id="recovering-n3">Recovering $n_3$<a href="#recovering-n3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>This part is easier. We must observe that <code>e = 0b10001</code> (instead of <code>e = 0x10001</code>), which makes $e = 17$. For we send $m$ with $0 \leq m^{289} &lt; n_2$ but $m^{4913} \geq n_3$, then $t_1 = m^{17}$ and $t_2 = m^{289}$ (not taken modulo) and $c = m^{4913}\ \text{mod}\ n_3$. This implies that $c$ is the remainder when $m^{4913}$ is divided by $n_3$. Well, $m = 2$ and $m = 3$ are such values. We can recover a small multiple of $n_3$ by</p>

<p><span  class="math">\[k \cdot n_3 := \gcd\left(2^{4913} - \mathcal{E}(2), 3^{4913} - \mathcal{E}(3)\right).\]</span></p>

<p>We can easily recover $n_3$ from $k$ by testing if they are divisible by small primes.</p>

<h4 id="finishing-the-challenge">Finishing the challenge<a href="#finishing-the-challenge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>From here, we obtain $n_1 = pq$ and $n_3 = rp$. We can recover $p$ by $p := \gcd(n_1, n_3)$, thus effectively recover $q = n_1 / p$ and $r = n_3 / p$. We will obtain private exponents $d_1$, $d_2$ and $d_3$, allow us to decrypt the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{shar1n9_pr1m3s_f0r_r5a_1s_n0t_4_sm4r7_m0v3}</code></pre></div>
<h2 id="slightly-informative-crypto">Slightly Informative (Crypto)<a href="#slightly-informative-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-1">Challenge Summary<a href="#challenge-summary-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are given a RSA public key $(n, e)$ with $n = pq$ and a encrypted flag $c$. We are also given $s$ and $t$ such that $d = sp + t$ ($d$ is the private exponent). The objective is to recover the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">n = 104761374953173292488929744863165210794654068795777885288141577481002622221368522222345141465054888216685195323019389786561685227925970380642821816770602985472200153940453825122714968250922188816858014096712757866955919806714643962473332876738158067418215518151671679136192434497079441504252290233276785611599
e = 65537
c = 65928964054587881283125968144498292857628864173177955118556976763155079656459679077792117840779590338576427244089037717506889027748698067761926112680228885555444571382015302945365206338671155793788123643640188995655372264100530540193424123290247632274913224252938261740392478884552717293366009033122985923910
s = 5142613903784744424286082317496829116877907073407033860339838239164453521174213069438631369864823275015906330523317080155171707469704307761287329022024572
t = 7967501076725747803058232903884621217031867311480596291389476854702834454579805205282313799601751011483434096767204486104203547013606991412953137405179501</code></pre></div>
<h3 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>To begin, we will recall how the private exponent $d$ is defined:</p>

<p><span  class="math">\[e \cdot d \equiv 1 \ (\text{mod}\ \phi(n)).\]</span></p>

<p>If we replace $\phi(n) = (p - 1)(q - 1)$ remove the use of modular equation, we can see that there exists a non-negative integer $k$ such that</p>

<p><span  class="math">\[e \cdot d = 1 + k(p - 1)(q - 1) = k[(n + 1) - (p + q)].\]</span></p>

<p>Let's substitute $d = sp + t$ so that is an equation of three unknowns: $p, q$ and $k$.</p>

<p><span  class="math">\[e (sp + t) = 1 + k[(n + 1) - (p + q)]\]</span></p>

<p>We can further eliminate the unknown $q$ because $pq = n$.</p>

<p><span  class="math">\[\begin{aligned}
& e (sp + t) = 1 + k[(n + 1) - (p + n/p)] \\
\Longrightarrow \quad & es \cdot p^2 + et \cdot p = p + k(n + 1) \cdot p - k \cdot p^2 - kn \\
\Longrightarrow \quad & (k + es) \cdot p^2 + [et - 1 - k(n+1)] \cdot p + kn = 0 \qquad [\dagger]
\end{aligned}\]</span></p>

<p>What we see is a quadratic equation in $p$. But guess what? $k$ is another unknown so what I said is not exactly true. Here comes one more fact:</p>

<p><span  class="math">\[\begin{aligned}
& e \cdot d = 1 + k \cdot \phi(n) > k \cdot \phi(n) \\
\Longrightarrow \quad & \frac{k}{e} < \frac{d}{\phi(n)} = 1 \\
\Longrightarrow \quad & k < e = 65537.
\end{aligned}\]</span></p>

<p>Because $k$ is also non-negative, $k$ could only be 0, 1, ..., or $e-1$. As there are only 65537 possibility, we can exhaust every $k$ into $[\dagger]$. Now we can solve 65537 quadratic equations and test every root $p$ obtained. That said, if $p$ is a positive integer such that $n$ is divisible by $p$, then we are able to factorize $n = pq$.</p>

<p>Eventually, we can compute $\phi(n) = (p - 1)(q - 1)$ and compute $d = e^{-1}\ \text{mod}\ \phi(n)$. We can use the private exponent to recover the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{st0p_l34k1ng_3x7r4_5tuffs_ab0u7_y0ur_r5a_k3y}</code></pre></div>
<p>&nbsp;</p>

<div class="alert info">
  <p><strong>Postmortem.</strong> <em>sahuang</em> from team <em>Project SEKAI</em> has an alternate solution, which is pretty elegant:</p>
<p>Since $e \cdot d \equiv 1\ (\text{mod}\ \phi(n))$, we also have $e \cdot d \equiv 1\ (\text{mod}\ (p-1))$ which lead to</p>
<p>$$e \cdot (sp + t) \equiv 1\ (\text{mod}\ (p-1)) \Longrightarrow e \cdot (s + t) \equiv 1\ (\text{mod}\ (p-1)).$$</p>
<p>That said, $p - 1$ is a factor of $M := e \cdot (s + t) - 1$. To be accurate, $M$ is a small multiple of $p - 1$. We can factor $M$ from <em>factordb</em> and obtain $p$, thus factoring $n$ as well.</p>

</div>


<h2 id="npsha256-crypto">NP-SHA256 (Crypto)<a href="#npsha256-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-2">Challenge Summary<a href="#challenge-summary-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>The challenge copies a Python SHA256 implementation from <a href="https://github.com/keanemind/python-sha-256/blob/370be6eba8c69c8adf8dfd719cd00f0bda752f39/sha256.py"><code>keanemind/Python-SHA-256</code></a> with few lines removed:</p>
<pre tabindex="0"><code class="language-diff-python&nbsp;diff-highlight" data-lang="diff-python&nbsp;diff-highlight">def generate_hash(message: bytearray) -&gt; bytearray:
    # (omitted)

    # Padding
    length = len(message) * 8 # len(message) is number of BYTES!!!
    message.append(0x80)
-   while (len(message) * 8 + 64) % 512 != 0:
-       message.append(0x00)
-
-   message += length.to_bytes(8, &#39;big&#39;) # pad to 8 bytes or 64 bits
-
-   assert (len(message) * 8) % 512 == 0, &#34;Padding did not complete properly!&#34;

    # Parsing
    blocks = [] # contains 512-bit chunks of message
    for i in range(0, len(message), 64): # 64 bytes is 512 bits
        blocks.append(message[i:i+64])</code></pre>
<p>The objective is to find a hash collision of the patched SHA256, i.e., find $m_1$ and $m_2$, at least 64-byte long, such that $m_1 \neq m_2$ and $\text{SHA256}(m_1) = \text{SHA256}(m_2)$.</p>

<h3 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>The solution is simple: Let $m_1$ and $m_2$ be the messages with 64 null bytes and 65 null bytes, respectively. Then $\text{SHA256}(m_1) = \text{SHA256}(m_2)$.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[&gt;] 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
[&gt;] 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
[&lt;] Good! MOCSCTF{ev3ry_d3t41l_1n_cryp70gr4phy_m4t73rs}</code></pre></div>
<p>But why? Let's compute $\text{SHA256}(m_3)$ and $\text{SHA256}(m_4)$, where $m_3$ and $m_4$ are the empty message and the message with one null byte respectively:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">m3 <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;&#39;</span>)
m4 <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;00&#39;</span>)</code></pre></div>
<p>Let's copy the <code>generate_hash</code> function to explain the stuffs. I have innotate the stuffs with comments:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_hash</span>(message: bytearray) <span style="color:#f92672">-&gt;</span> bytearray:
    <span style="color:#e6db74">&#34;&#34;&#34;Return a SHA-256 hash from the message passed.
</span><span style="color:#e6db74">    The argument should be a bytes, bytearray, or
</span><span style="color:#e6db74">    string object.&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">if</span> isinstance(message, str):
        message <span style="color:#f92672">=</span> bytearray(message, <span style="color:#e6db74">&#39;ascii&#39;</span>)
    <span style="color:#66d9ef">elif</span> isinstance(message, bytes):
        message <span style="color:#f92672">=</span> bytearray(message)
    <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> isinstance(message, bytearray):
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>

    <span style="color:#75715e"># Padding</span>
    length <span style="color:#f92672">=</span> len(message) <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>
    message<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0x80</span>)

    <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
    <span style="color:#75715e"># At this stage,</span>
    <span style="color:#75715e">#   message = bytes.fromhex(&#34;80&#34;)   # -- for m3</span>
    <span style="color:#75715e">#   message = bytes.fromhex(&#34;0080&#34;) # -- for m4</span>

    blocks <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(message), <span style="color:#ae81ff">64</span>): <span style="color:#75715e"># 64 bytes is 512 bits</span>
        blocks<span style="color:#f92672">.</span>append(message[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">64</span>])

    <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
    <span style="color:#75715e"># At this stage,</span>
    <span style="color:#75715e">#   blocks = [bytes.fromhex(&#34;80&#34;)]   # -- for m3</span>
    <span style="color:#75715e">#   blocks = [bytes.fromhex(&#34;0080&#34;)] # -- for m4</span>

    h0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x6a09e667</span>
    h1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xbb67ae85</span>
    h2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x3c6ef372</span>
    h3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa54ff53a</span>
    h5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x9b05688c</span>
    h4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x510e527f</span>
    h6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1f83d9ab</span>
    h7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5be0cd19</span>

    <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
    <span style="color:#75715e"># Since there is only one block, I&#39;ll rewrite below without losing the meaning:</span>
    message_block <span style="color:#f92672">=</span> blocks[<span style="color:#ae81ff">0</span>]

    message_schedule <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">64</span>):
        <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">15</span>:
            message_schedule<span style="color:#f92672">.</span>append(bytes(message_block[t<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>:(t<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>]))
            <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
            <span style="color:#75715e"># At this stage,</span>
            <span style="color:#75715e">#   message_schedule[0] = bytes.fromhex(&#34;80&#34;)   # -- for m3</span>
            <span style="color:#75715e">#   message_schedule[0] = bytes.fromhex(&#34;0080&#34;) # -- for m4</span>
            <span style="color:#75715e"># and for i = 1, 2, ..., 15</span>
            <span style="color:#75715e">#   message_schedule[i] = b&#34;&#34;                   # for both m3 and m4</span>
        <span style="color:#66d9ef">else</span>:
            term1 <span style="color:#f92672">=</span> _sigma1(int<span style="color:#f92672">.</span>from_bytes(message_schedule[t<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#39;big&#39;</span>))
            term2 <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(message_schedule[t<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span>], <span style="color:#e6db74">&#39;big&#39;</span>)
            term3 <span style="color:#f92672">=</span> _sigma0(int<span style="color:#f92672">.</span>from_bytes(message_schedule[t<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span>], <span style="color:#e6db74">&#39;big&#39;</span>))
            term4 <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(message_schedule[t<span style="color:#f92672">-</span><span style="color:#ae81ff">16</span>], <span style="color:#e6db74">&#39;big&#39;</span>)

            schedule <span style="color:#f92672">=</span> ((term1 <span style="color:#f92672">+</span> term2 <span style="color:#f92672">+</span> term3 <span style="color:#f92672">+</span> term4) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>)
            message_schedule<span style="color:#f92672">.</span>append(schedule)
            <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
            <span style="color:#75715e"># For i = 16, 17, ..., 64, message_schedule[i] for m3 and m4 are equal.</span>
            <span style="color:#75715e"># This is because that the big-endian representations for</span>
            <span style="color:#75715e"># bytes.fromhex(&#34;80&#34;) and bytes.fromhex(&#34;0080&#34;) are the same.</span>

    <span style="color:#66d9ef">assert</span> len(message_schedule) <span style="color:#f92672">==</span> <span style="color:#ae81ff">64</span>

    <span style="color:#75715e"># (omitted)</span>

    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
        t1 <span style="color:#f92672">=</span> ((h <span style="color:#f92672">+</span> _capsigma1(e) <span style="color:#f92672">+</span> _ch(e, f, g) <span style="color:#f92672">+</span> K[t] <span style="color:#f92672">+</span>
                int<span style="color:#f92672">.</span>from_bytes(message_schedule[t], <span style="color:#e6db74">&#39;big&#39;</span>)) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>)
        <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
        <span style="color:#75715e"># t1 on the i-th round looks for the big-endian representation for</span>
        <span style="color:#75715e"># message_schedule[i]. That said, t1 for m3 and m4 would always be the same.</span>
        <span style="color:#75715e"># After all, this makes a, b, ..., h for both m3 and m4 equal for each round.</span>

        <span style="color:#75715e"># (omitted)</span>
    
    <span style="color:#75715e"># [MYSTIZ&#39;S COMMENT]</span>
    <span style="color:#75715e"># Now h0, h1, ..., h7 for both m3 and m4 are equal.</span>
    <span style="color:#75715e"># That would imply the digests would be the same.</span>
    h0 <span style="color:#f92672">=</span> (h0 <span style="color:#f92672">+</span> a) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h1 <span style="color:#f92672">=</span> (h1 <span style="color:#f92672">+</span> b) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h2 <span style="color:#f92672">=</span> (h2 <span style="color:#f92672">+</span> c) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h3 <span style="color:#f92672">=</span> (h3 <span style="color:#f92672">+</span> d) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h4 <span style="color:#f92672">=</span> (h4 <span style="color:#f92672">+</span> e) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h5 <span style="color:#f92672">=</span> (h5 <span style="color:#f92672">+</span> f) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h6 <span style="color:#f92672">=</span> (h6 <span style="color:#f92672">+</span> g) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>
    h7 <span style="color:#f92672">=</span> (h7 <span style="color:#f92672">+</span> h) <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>

    <span style="color:#66d9ef">return</span> ((h0)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span> (h1)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span>
            (h2)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span> (h3)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span>
            (h4)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span> (h5)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span>
            (h6)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span> (h7)<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;big&#39;</span>))</code></pre></div>
<p>It is essentially the same for $m_1$ and $m_2$, except the initial values $h_0, h_1, ..., h_7$ are different. Let's leave that as readers' exercise.</p>

<h2 id="hmacsha256-crypto">HMAC-SHA256 (Crypto)<a href="#hmacsha256-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-3">Challenge Summary<a href="#challenge-summary-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are asked to find 64 pairs of $(k, m)$ such that $\text{HMAC-SHA256}_k(m)$ are all equal.</p>

<h3 id="solution-3">Solution<a href="#solution-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>When the key is shorter than the block size (64 for SHA256), it will be padded by zeros on the right.<sup class="footnote-ref" id="fnref:rfc-2104"><a class="footnote" href="#fn:rfc-2104">1</a></sup> For example, if the key is <code>hello world</code>, then it will be padded to <code>hello world_____________________________________________________</code> (hereby each <code>_</code> represents a null byte). It is easy to see that the keys <code>foo</code> and <code>foo_</code> would be padded into the same key, thus generating equal hashes for equal messages.</p>

<p>After all, the below 65 keys would be padded into the same way:</p>

<ul>
<li>an empty key</li>
<li><code>_</code> (one null byte)</li>
<li><code>__</code> (two null bytes)</li>
<li><code>___</code>  (three null bytes)<br>
...</li>
<li><code>________________________________________________________________</code> (64 null bytes)</li>
</ul>

<p>and they all generate equal hashes given the same message. By sending such keys to the server (for an arbitrary message), we can obtain the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{wh4t_i5_th3_u53_0f_5uch_c0111si0ns_w1th_d1ff3ren7_k3y5}</code></pre></div>
<h2 id="rc4-crypto">RC4 (Crypto)<a href="#rc4-crypto" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<div class="alert info">
  <strong>Disambiguation.</strong> Please do not be confused with the <a href="/posts/2021-01-18-firebird-internal-ctf/#rc4-misc">RC4 challenge</a> I made for Firebird Internal CTF in 2021.
</div>


<h3 id="challenge-summary-4">Challenge Summary<a href="#challenge-summary-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>When connected to the server, a 16-byte key will be generated for an altered RC4. We can call the below functions for an arbitrary number of time:</p>

<ol>
<li><strong>[Encrypt message]</strong> Send $m$ and obtain $\text{RC4}(m)$,</li>
<li><strong>[Encrypt flag]</strong> Obtain $\text{RC4}(\text{flag})$.</li>
</ol>

<p>The objective is to obtain the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RC4</span>:
    <span style="color:#66d9ef">def</span> __init__(self, key):
        keylength <span style="color:#f92672">=</span> len(key)

        s <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>)]

        j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
            j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> s[i] <span style="color:#f92672">+</span> key[i <span style="color:#f92672">%</span> keylength]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0xff</span>
            s[i], s[j] <span style="color:#f92672">=</span> s[j], s[i]

        self<span style="color:#f92672">.</span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        self<span style="color:#f92672">.</span>j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        self<span style="color:#f92672">.</span>s <span style="color:#f92672">=</span> s

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__next</span>(self):
        s, i, j <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>s, self<span style="color:#f92672">.</span>i, self<span style="color:#f92672">.</span>j

        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)    <span style="color:#f92672">%</span> <span style="color:#ae81ff">0xff</span>
        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> s[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0xff</span>

        s[i], s[j] <span style="color:#f92672">=</span> s[j], s[i]

        self<span style="color:#f92672">.</span>s, self<span style="color:#f92672">.</span>i, self<span style="color:#f92672">.</span>j <span style="color:#f92672">=</span> s, i, j

        <span style="color:#66d9ef">return</span> s[(s[i] <span style="color:#f92672">+</span> s[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0xff</span>]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self, message):
        <span style="color:#66d9ef">return</span> bytes(m<span style="color:#f92672">^</span>self<span style="color:#f92672">.</span>__next() <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> message)</code></pre></div>
<h3 id="solution-4">Solution<a href="#solution-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="whats-wrong-with-the-rc4-function">What's wrong with the RC4 function?<a href="#whats-wrong-with-the-rc4-function" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>The RC4 function is not implemented correctly. We can either observe this by</p>

<ol>
<li>comparing ciphertexts of an existing and the current RC4 implementations, or</li>
<li>reading the source code carefully.</li>
</ol>

<p>We can see that the error comes from <code>% 0xff</code>, which should be <code>&amp; 0xff</code> (or <code>% 256</code>, which is the same).</p>

<h4 id="exploiting-the-mistake">Exploiting the mistake<a href="#exploiting-the-mistake" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>By taking everything modulo 255, the indexes for <code>s</code> is always between $[0, 255)$. Thus <code>s[255]</code> is <em>never</em> accessed in the <code>__next</code> function. That said, <code>s[255]</code> (we will use $x$ below) would never be used in the keystream.</p>

<p>We can encrypt a bunch of null bytes and obtain the keystream bytes $(k_1, k_2, ..., k_n)$. If the set $\{k_1, k_2, ..., k_n\}$ has 255 elements, we can effectively recover $x$. After that, we can repeatedly obtain $\text{RC4}(\text{flag})$. If $y$ never appears in the $i$-th byte of $\text{RC4}(\text{flag})$, then $x \oplus y$ is the $i$-th byte of the flag (i.e., the plaintext). We can obtain the flag by working on this on every character:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{i_sh0uld_u5e_AND_0xff_in5t3ad_0f_M0D_0xff}</code></pre></div>
<h2 id="hashtable-misc">HashTable (Misc)<a href="#hashtable-misc" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-5">Challenge Summary<a href="#challenge-summary-5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are given a <a href="https://gist.github.com/Tetsuya3850/fe841bf1f1088fe1f804c189db4c9daf">Python implementation</a> of hash table. There is a server that allows us to interact with the hash table ($k_0$ is a 16-byte secret):</p>

<ol>
<li><strong>[Set]</strong> Given $k$ and $v$, sets $\text{HashTable}[k] := v$.</li>
<li><strong>[Get]</strong> Given $k$, gets $\text{HashTable}[k]$.</li>
<li><strong>[Delete]</strong> Given $k$, removes $\text{HashTable}[k]$.</li>
<li><strong>[Put secret]</strong> Sets $\text{HashTable}[k_0] := \text{no flag for you}$.</li>
<li><strong>[Get secret]</strong> If $\text{HashTable}[k_0] \neq \text{no flag for you}$ then we are given the flag (we need to call <em>put secret</em> at least once).</li>
</ol>

<h3 id="solution-5">Solution<a href="#solution-5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>There are at least two bugs of the implementation:</p>

<ol>
<li>If the key $\hat{k}$ is on the first of the bucket, then all entries from the same bucket will be removed upon $\text{Delete}(\hat{k})$.</li>
<li>Suppose that $\text{HashTable}[\hat{k}] = v_1$. Calling $\text{Set}(\hat{k}, v_2)$ would <em>not</em> make the subsequent calls of $\text{Get}(\hat{k})$ to return $v_2$ (i.e., the key is not overwritten).</li>
</ol>

<p>We will use the first bug to remove $\text{HashTable}[k_0]$ without knowing what $k_0$. Assume that $k_0$ maps to the $b$-th bucket. We can retrieve the flag with the below steps:</p>

<ol>
<li>Find a key $k_1$ that also maps to the $b$-th bucket.</li>
<li>Call $\text{Set}(k_1, \text{whatever})$ to occupy the first slot of the $b$-th bucket.</li>
<li>Call $\text{PutSecret}$, which puts the secret in the second slot of $b$-th bucket.</li>
<li><strong>&lt;🐞&gt;</strong> Call $\text{Delete}(k_1)$ to remove <em>all</em> of the entries from the $b$-th bucket. That said $\text{HashTable}(k_0)$ is accidentally removed.</li>
<li>Call $\text{GetSecret}$. Since $\text{HashTable}[k_0]$ removed, $\text{HashTable}[k_0] \neq \text{no flag for you}$ and thus we have the flag.</li>
</ol>

<p>To solve the challenge, we simply occupy the first slot of all buckets in step 2 and remove all of the entries in step 4. Eventually we have the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{wr1t3_un1t_t3st5_f0r_y0ur_s4n1ty}</code></pre></div>
<h2 id="wordle-crypto-misc">Wordle (Crypto, Misc)<a href="#wordle-crypto-misc" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-6">Challenge Summary<a href="#challenge-summary-6" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are given a server that plays Wordle with us. The words are picked randomly from the <code>Random</code> class defined below (which is a linear congruential generator):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Random</span>:
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>seed       <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>getrandbits(<span style="color:#ae81ff">128</span>)
        self<span style="color:#f92672">.</span>multiplier <span style="color:#f92672">=</span> <span style="color:#ae81ff">271828182845904523536028</span>
        self<span style="color:#f92672">.</span>increment  <span style="color:#f92672">=</span> <span style="color:#ae81ff">314159265358979323846264</span>
        self<span style="color:#f92672">.</span>modulus    <span style="color:#f92672">=</span> <span style="color:#ae81ff">246024225711064289902592</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>multiplier <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>increment) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>modulus
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed</code></pre></div>
<p>We can play up to fifty games if we don't lose a game. More importantly, the goal is to guess the word in the first time for ten consecutive games.</p>




<div class="code-toolbar">
<pre class='language-bash command-line' data-output='2-71' data-user='mystiz' data-host='foci'>
<code class="language-bash">nc HOST PORT
🎲 Wordle #1
🔍 games
    #1 | games | ⬜⬜⬜🟨🟩

🔍 repot
    #1 | games | ⬜⬜⬜🟨🟩
    #2 | repot | ⬜🟩⬜🟩⬜

🔍 zeros
    #1 | games | ⬜⬜⬜🟨🟩
    #2 | repot | ⬜🟩⬜🟩⬜
    #3 | zeros | ⬜🟩⬜🟩🟩

🔍 demos
    #1 | games | ⬜⬜⬜🟨🟩
    #2 | repot | ⬜🟩⬜🟩⬜
    #3 | zeros | ⬜🟩⬜🟩🟩
    #4 | demos | 🟩🟩⬜🟩🟩

🔍 locks             
    #1 | games | ⬜⬜⬜🟨🟩
    #2 | repot | ⬜🟩⬜🟩⬜
    #3 | zeros | ⬜🟩⬜🟩🟩
    #4 | demos | 🟩🟩⬜🟩🟩
    #5 | locks | 🟨🟨⬜⬜🟩

🔍 delos
    #1 | games | ⬜⬜⬜🟨🟩
    #2 | repot | ⬜🟩⬜🟩⬜
    #3 | zeros | ⬜🟩⬜🟩🟩
    #4 | demos | 🟩🟩⬜🟩🟩
    #5 | locks | 🟨🟨⬜⬜🟩
    #6 | delos | 🟩🟩🟩🟩🟩

✨ Nice!
🎲 Wordle #2
🔍 delta
    #1 | delta | ⬜🟩⬜⬜🟨

🔍 betas
    #1 | delta | ⬜🟩⬜⬜🟨
    #2 | betas | ⬜🟩⬜🟨🟩

🔍 doabs
    #1 | delta | ⬜🟩⬜⬜🟨
    #2 | betas | ⬜🟩⬜🟨🟩
    #3 | doabs | ⬜⬜🟩⬜🟩

🔍 gears
    #1 | delta | ⬜🟩⬜⬜🟨
    #2 | betas | ⬜🟩⬜🟨🟩
    #3 | doabs | ⬜⬜🟩⬜🟩
    #4 | gears | ⬜🟩🟩🟩🟩

🔍 pears
    #1 | delta | ⬜🟩⬜⬜🟨
    #2 | betas | ⬜🟩⬜🟨🟩
    #3 | doabs | ⬜⬜🟩⬜🟩
    #4 | gears | ⬜🟩🟩🟩🟩
    #5 | pears | ⬜🟩🟩🟩🟩

🔍 tears
    #1 | delta | ⬜🟩⬜⬜🟨
    #2 | betas | ⬜🟩⬜🟨🟩
    #3 | doabs | ⬜⬜🟩⬜🟩
    #4 | gears | ⬜🟩🟩🟩🟩
    #5 | pears | ⬜🟩🟩🟩🟩
    #6 | tears | ⬜🟩🟩🟩🟩

👋 You lose! The correct word is nears.</code>
</pre>
</div>

<h3 id="solution-6">Solution<a href="#solution-6" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="playing-wordle">Playing Wordle<a href="#playing-wordle" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>Having a strategy of playing Wordle is now a survival skill. Since there are a lot of blog posts and resources online, I am not going to explain it in my way. These are some interesting ones:</p>

<ul>
<li><em>Maximising Differential Entropy to Solve Wordle</em> by <em>Aditya Sengupta</em> (<a href="https://aditya-sengupta.github.io/coding/2022/01/13/wordle.html">Link</a>)</li>
<li><em>Unwordle</em> by <em>sadmoody</em> (<a href="_https://sadmoody.github.io/unwordle/">Link</a>)</li>
<li><em>Absurdle</em> by <em>qntm</em> (<a href="https://qntm.org/wordle">Link</a>)</li>
<li><em>Solving Wordle using information theory</em> by <em>3Blue1Brown</em> (<a href="https://www.youtube.com/watch?v=v68zYyaEmEA">Link</a>)</li>
</ul>

<h4 id="analysing-the-random-class">Analysing the <code>Random</code> class<a href="#analysing-the-random-class" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>The $n$-th number, $x_n$, outputed from the PRNG will be</p>

<p><span  class="math">\[x_n = \begin{cases}
(a x_{n-1} + b)\ \text{mod}\ m & \text{if}\ n > 0 \\
\text{seed} & \text{if}\ n = 0
\end{cases},\]</span></p>

<p>where $a$, $b$ and $m$ are three numbers given above. We can express $x_n$ in terms of $\text{seed}$:</p>

<p><span  class="math">\[\begin{aligned}
x_n &\equiv a x_{n-1} + b \equiv a \cdot (a x_{n-2} + b) + b \equiv a^2 \cdot x_{n-2} + b \cdot (a + 1) \\
&\equiv a^2 \cdot (a x_{n-3} + b) + b \cdot (a + 1) \equiv a^3 \cdot x_{n-3} + b \cdot (a^2 + a + 1) \\
&\equiv ... \equiv a^n \cdot x_0 + b \cdot (a^{n-1} + a^{n-2} + ... + 1) \\
&\equiv a^n \cdot \text{seed} + b \cdot (a^{n-1} + a^{n-2} + ... + 1) \quad (\text{mod}\ m)
\end{aligned}\]</span></p>

<p>Interestingly, $m = 2^{64} \cdot 13337$ and $a$ and $b$ are multiple of 4 (that said, there exist integers $u$ and $v$ such that $a = 4u$ and $b = 4v$).</p>

<p>We can consider the whole thing under mod $2^{64}$:</p>

<p><span  class="math">\[\begin{aligned}
x_n &\equiv a^n \cdot \text{seed} + b \cdot (a^{n-1} + a^{n-2} + ... + 1) \\
&\equiv (4u)^n \cdot \text{seed} + 4v \cdot [(4u)^{n-1} + (4u)^{n-2} + ... + 1] \quad (\text{mod}\ 2^{64})
\end{aligned}\]</span></p>

<p>In particular, when $n \geq 32$, we have $4^n = 2^{2n} = 2^{64} \cdot 2^{2n - 64} \equiv 0\ (\text{mod}\ 2^{64})$. We have:</p>

<p><span  class="math">\[\begin{aligned}
x_n &\equiv (4u)^n \cdot \text{seed} + 4v \cdot [(4u)^{n-1} + (4u)^{n-2} + ... + 1] \\
&\equiv 4^n \cdot u^n \cdot \text{seed} + 4v \cdot [4^{n-1} \cdot u^{n-1} + 4^{n-2} \cdot u^{n-2} + ... + 1] \\
&\equiv 0 \cdot u^n \cdot \text{seed} + 4v \cdot [0 \cdot u^{n-1} + ... + 0 \cdot u^{32} + 4^{31} \cdot u^{31} + 4^{30} \cdot u^{30} + ... + 1] \\
&\equiv 4v \cdot [4^{31} \cdot u^{31} + 4^{30} \cdot u^{30} + ... + 1] \\
&\equiv 9640705563541584152 \quad (\text{mod}\ 2^{64})
\end{aligned}\]</span></p>

<p>This imply that $x_n\ \text{mod}\ 2^{64}$ is indepedent of the seed when $n$ is big. On the other hand, $x_n\ \text{mod}\ 13337$ is still unknown. Luckily there are only 13337 possibilities so we can exhaust them.</p>

<p>After all, for $n \geq 32$, there exists an integer $0 \leq u_n &lt; 13337$ such that</p>

<p><span  class="math">\[x_n = 9640705563541584152 + 2^{64} \cdot u_n.\]</span></p>

<p>From here, we can devise with the below strategy:</p>

<ol>
<li>Play 34 rounds and obtain $x_{33}\ \text{mod}\ 12972$ and $x_{34}\ \text{mod}\ 12972$.</li>
<li>Recover $x_{34}$ using $x_{33}\ \text{mod}\ 12972$ and $x_{34}\ \text{mod}\ 12972$.</li>
<li>Compute $x_{35}, x_{36}, ..., x_{44}$ so that we can guess the words immediately.</li>
<li>??</li>
<li>Profit!</li>
</ol>

<p>If everything goes well, then we will obtain the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{c4n_y0u_pr3d1c7_th3_4ctu4l_w0rd13_s0lu71on5_n0w}</code></pre></div>
<p>By the way, it is much easier to get the answers for Wordle - they are hardcoded in the JavaScript files.</p>

<h2 id="3aes-crypto-misc">3-AES (Crypto, Misc)<a href="#3aes-crypto-misc" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-7">Challenge Summary<a href="#challenge-summary-7" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>Denote $\text{3AES}: \mathcal{M} \rightarrow \mathcal{C}$ by $c := \text{3AES}(m)$, where</p>

<p><span  class="math">\[\begin{aligned}
t_1 &= \text{AES-CBC}_{k_1, \nu_1}(m) \\
t_2 &= \text{AES-CBC}_{k_2, \nu_2}(t_1) \\
c &= \text{AES-CBC}_{k_3, \nu_3}(t_2).
\end{aligned}\]</span></p>

<p>When connected to the server, three sets of key-IV pairs $(k_i, \nu_i)$ (for $i = 1, 2, 3$) are generated. Here</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">key <span style="color:#f92672">=</span> md5(os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">3</span>))<span style="color:#f92672">.</span>digest()
iv  <span style="color:#f92672">=</span> md5(os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">6</span>))<span style="color:#f92672">.</span>digest()</code></pre></div>
<p>We are allowed to call the below functions for an arbitrary number of times:</p>

<ol>
<li><strong>[Encrypt message]</strong> Given $m$ and we get $\text{3AES}(m)$.</li>
<li><strong>[Encrypt flag]</strong> We get $\text{3AES}(\text{flag})$.</li>
</ol>

<p>The objective is to recover the flag.</p>

<div class="alert danger">
  <strong>Incorrect cipher definition!</strong> This is not the cipher we are going to analyse. We will explain why and state the actual cipher to-be studied later.
</div>


<h3 id="solution-7">Solution<a href="#solution-7" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<h4 id="the-cipher-does-not-behave-as-expected">The cipher does not behave as expected<a href="#the-cipher-does-not-behave-as-expected" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">keys <span style="color:#f92672">=</span> [list()] <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_keys</span>():
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(keys)):
        key <span style="color:#f92672">=</span> md5(os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">3</span>))<span style="color:#f92672">.</span>digest()
        iv <span style="color:#f92672">=</span> md5(os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">6</span>))<span style="color:#f92672">.</span>digest()
        keys[i]<span style="color:#f92672">.</span>append(key)
        keys[i]<span style="color:#f92672">.</span>append(iv)</code></pre></div>
<p>After <code>gen_keys</code> is called, one may expect <code>keys</code> would look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">keys <span style="color:#f92672">=</span> [
    [key1, iv1],
    [key2, iv2],
    [key3, iv3]
]</code></pre></div>
<p>This is indeed incorrect. In reality, <code>keys</code> would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">keys <span style="color:#f92672">=</span> [
    [key1, iv1, key2, iv2, key3, iv3],
    [key1, iv1, key2, iv2, key3, iv3],
    [key1, iv1, key2, iv2, key3, iv3]
]</code></pre></div>
<p>You can refer to <a href="https://stackoverflow.com/questions/240178/list-of-lists-changes-reflected-across-sublists-unexpectedly">this StackOverflow question</a> for an explanation of the behaviour. Anyway, this is the <em>actual</em> definition of $\text{3AES}: \mathcal{M} \rightarrow \mathcal{C}$. Let $c := \text{3AES}(m)$, then</p>

<p><span  class="math">\[\begin{aligned}
t_1 &= \text{AES-CBC}_{k, \nu}(m) \\
t_2 &= \text{AES-CBC}_{k, \nu}(t_1) \\
c &= \text{AES-CBC}_{k, \nu}(t_2).
\end{aligned}\]</span></p>

<p>Here $k$ and $\nu$ are respectively <code>key1</code> and <code>iv1</code> defined above.</p>

<h4 id="attacking-the-cipher">Attacking the cipher<a href="#attacking-the-cipher" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>

<p>Since there are only $2^{24}$ possible keys, we can easily exhaust them to obtain $k$. If we have the right key, we can recover $\nu$ by sending 48 null bytes as the plaintext. In that way we have $m_1, m_2, m_3$ and $c_1, c_2, c_3$ as shown in the below figure. We omit the padding blocks ($m_4$ and $c_4$) for simplicity.</p>


  <figure class="center" >
    <img src="/images/2022-02-19-mocsctf/3-aes-blocks-1.png"   />
    
      <figcaption class="right" >The blocks for 3-AES, here we knew the green ones immediately.</figcaption>
    
  </figure>



<p>This is how we derive $\nu$ from $m_1, m_2, m_3$ and $c_1, c_2, c_3$ given a <em>correct</em> key ($\text{AESEnc}$ and $\text{AESDec}$ are respectively the encrypt and decrypt functions):</p>

<p><span  class="math">\[\begin{aligned}
s_2 &:= c_1 \oplus \text{AESDec}_k(c_2) \\
s_3 &:= c_2 \oplus \text{AESDec}_k(c_3) \\
r_3 &:= s_2 \oplus \text{AESDec}_k(s_3) \\
r_2 &:= m_3 \oplus \text{AESDec}_k(r_3) \\
r_1 &:= m_2 \oplus \text{AESDec}_k(r_2) \\
\nu &:= m_1 \oplus \text{AESDec}_k(r_1)
\end{aligned}\]</span></p>


  <figure class="center" >
    <img src="/images/2022-02-19-mocsctf/3-aes-blocks-2.png"   />
    
      <figcaption class="right" >We have six more blocks (including the IV, $\nu$) if we knew the key.</figcaption>
    
  </figure>



<p>However, we do not know whether the key is correct. We can determine the correctness of the key by compute $c_1'$ and check if $c_1 = c_1'$:</p>

<p><span  class="math">\[\begin{aligned}
s_1 &:= \text{AESEnc}(\nu \oplus r_1) \\
c_1' &:= \text{AESEnc}(\nu \oplus s_1)
\end{aligned}\]</span></p>

<p>After we have the correct $(k, \nu)$, we can get $\text{3AES}(\text{flag})$ and decrypt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{pl34s3_h4nd13_y0ur_py7h0n_l1st5_w3ll}</code></pre></div>
<h2 id="elementary-reverse">Elementary (Reverse)<a href="#elementary-reverse" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-8">Challenge Summary<a href="#challenge-summary-8" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are given a Linux binary that prints the flag slowly. Players are expected to reverse the binary and optimize the algorithm.</p>

<h3 id="solution-8">Solution<a href="#solution-8" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>It is not difficult to see from decompilers (like IDA or Ghidra) that the program evaluates $\text{p}(0), \text{p}(1), ..., \text{p}(64)$ from a given polynomial $\text{p}$.</p>

<p>Why is it slow? This is how I define <code>a + b</code>, <code>a * b</code> and <code>a ^ b</code> (exponentation):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#define n 1000000007
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// O(a + b)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">_add</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> a; i<span style="color:#f92672">++</span>) c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> b; i<span style="color:#f92672">++</span>) c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">return</span> c;
}

<span style="color:#75715e">// O(a + b)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">_sub</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {    
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> a; i<span style="color:#f92672">++</span>) c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> b; i<span style="color:#f92672">++</span>) c <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>;
    
    <span style="color:#66d9ef">return</span> c;
}

<span style="color:#75715e">// O(a + b)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> _add(a, b);
    <span style="color:#66d9ef">if</span> (c <span style="color:#f92672">&gt;=</span> n) c <span style="color:#f92672">=</span> _sub(c, n);
    <span style="color:#66d9ef">return</span> c;
}

<span style="color:#75715e">// O(n * b)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">mul</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> b; i<span style="color:#f92672">++</span>) {
        c <span style="color:#f92672">=</span> add(c, a);
    }
    <span style="color:#66d9ef">return</span> c;
}

<span style="color:#75715e">// O(n ^ b)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">pow</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> b; i<span style="color:#f92672">++</span>) {
        c <span style="color:#f92672">=</span> mul(c, a);
    }
    <span style="color:#66d9ef">return</span> c;
}</code></pre></div>
<p>Also, the coefficients of the polynomial is given in the <code>main</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">int</span> polynomial[] <span style="color:#f92672">=</span> {
    <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">543680933</span>, <span style="color:#ae81ff">779305823</span>, <span style="color:#ae81ff">406010255</span>, <span style="color:#ae81ff">852593453</span>,
    <span style="color:#ae81ff">670940274</span>, <span style="color:#ae81ff">400957584</span>, <span style="color:#ae81ff">848777990</span>, <span style="color:#ae81ff">534939184</span>, <span style="color:#ae81ff">328847351</span>,
    <span style="color:#ae81ff">616300066</span>, <span style="color:#ae81ff">359055106</span>, <span style="color:#ae81ff">161410101</span>, <span style="color:#ae81ff">171509744</span>, <span style="color:#ae81ff">155648929</span>,
    <span style="color:#ae81ff">916365238</span>, <span style="color:#ae81ff">18733844</span>, <span style="color:#ae81ff">380452845</span>, <span style="color:#ae81ff">509377978</span>, <span style="color:#ae81ff">800691109</span>,
    <span style="color:#ae81ff">908467961</span>, <span style="color:#ae81ff">104753231</span>, <span style="color:#ae81ff">181241660</span>, <span style="color:#ae81ff">273070766</span>, <span style="color:#ae81ff">93557074</span>,
    <span style="color:#ae81ff">561221533</span>, <span style="color:#ae81ff">449550761</span>, <span style="color:#ae81ff">188262493</span>, <span style="color:#ae81ff">915004277</span>, <span style="color:#ae81ff">426375697</span>,
    <span style="color:#ae81ff">665693795</span>, <span style="color:#ae81ff">107906776</span>, <span style="color:#ae81ff">665848870</span>, <span style="color:#ae81ff">211169645</span>, <span style="color:#ae81ff">53616008</span>,
    <span style="color:#ae81ff">489964557</span>, <span style="color:#ae81ff">908019215</span>, <span style="color:#ae81ff">786707135</span>, <span style="color:#ae81ff">573479073</span>, <span style="color:#ae81ff">905263359</span>,
    <span style="color:#ae81ff">938064888</span>, <span style="color:#ae81ff">780724541</span>, <span style="color:#ae81ff">361367421</span>, <span style="color:#ae81ff">636367390</span>, <span style="color:#ae81ff">816611492</span>,
    <span style="color:#ae81ff">238098701</span>, <span style="color:#ae81ff">596575814</span>, <span style="color:#ae81ff">426971134</span>, <span style="color:#ae81ff">943814120</span>, <span style="color:#ae81ff">365926771</span>,
    <span style="color:#ae81ff">929927764</span>, <span style="color:#ae81ff">885597612</span>, <span style="color:#ae81ff">895263918</span>, <span style="color:#ae81ff">678662340</span>, <span style="color:#ae81ff">387318491</span>,
    <span style="color:#ae81ff">644785517</span>, <span style="color:#ae81ff">566974198</span>, <span style="color:#ae81ff">229009720</span>, <span style="color:#ae81ff">874699826</span>, <span style="color:#ae81ff">637234082</span>,
    <span style="color:#ae81ff">673340960</span>, <span style="color:#ae81ff">577186089</span>, <span style="color:#ae81ff">903058253</span>, <span style="color:#ae81ff">424604291</span>, <span style="color:#ae81ff">663043221</span>
};
<span style="color:#75715e">// p(x) = 663043221 * x^55 + 424604291 * x^54 + ... + 543680933 * x + 77
</span></code></pre></div>
<p>Anyway it is easy to optimize the algorithm - you can just implement <code>a + b</code>, <code>a * b</code> and <code>a ^ b</code> in a standard way and the flag would be shown immediately:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{th1s_pr0gr4m_1s_4lr34dy_sl0w_d01ng_ar1thm3t1c_0p3ra7i0n5}</code></pre></div>
<h2 id="redactor-reverse">Redactor (Reverse)<a href="#redactor-reverse" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>

<h3 id="challenge-summary-9">Challenge Summary<a href="#challenge-summary-9" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>We are given a <code>.exe</code> file which is suggested to run in the background. Players may observe that the program would redact the flag (or part of the flag) that exists in the clipboard. For example, if one copies the first line from the clipboard, it became the second line after pasting.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{what_is_this?}
********what_is_this?}</code></pre></div>
<h3 id="solution-9">Solution<a href="#solution-9" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

<p>Since the program is compiled by <em>PyInstaller</em>, one may try <a href="https://github.com/extremecoders-re/pyinstxtractor">PyInstaller Extractor</a> to recover the source code (I did not try this, however).</p>

<p>If players are running the program during the CTF, I expect that they will be copy-pasting flags occasionally. The program redacts part of the flag they obtained and the players could have an insight on the behaviour of the program. We can obtain the flag byte-by-byte by exhausting the characters:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{0 MOCSCTF{1 MOCSCTF{2 MOCSCTF{3 MOCSCTF{4 MOCSCTF{5 MOCSCTF{6 MOCSCTF{7
MOCSCTF{8 MOCSCTF{9 MOCSCTF{a MOCSCTF{b MOCSCTF{c MOCSCTF{d MOCSCTF{e MOCSCTF{f
MOCSCTF{g MOCSCTF{h MOCSCTF{i MOCSCTF{j MOCSCTF{k MOCSCTF{l MOCSCTF{m MOCSCTF{n
MOCSCTF{o MOCSCTF{p MOCSCTF{q MOCSCTF{r MOCSCTF{s MOCSCTF{t MOCSCTF{u MOCSCTF{v
MOCSCTF{w MOCSCTF{x MOCSCTF{y MOCSCTF{z MOCSCTF{A MOCSCTF{B MOCSCTF{C MOCSCTF{D
MOCSCTF{E MOCSCTF{F MOCSCTF{G MOCSCTF{H MOCSCTF{I MOCSCTF{J MOCSCTF{K MOCSCTF{L
MOCSCTF{M MOCSCTF{N MOCSCTF{O MOCSCTF{P MOCSCTF{Q MOCSCTF{R MOCSCTF{S MOCSCTF{T
MOCSCTF{U MOCSCTF{V MOCSCTF{W MOCSCTF{X MOCSCTF{Y MOCSCTF{Z MOCSCTF{! MOCSCTF{&#34;
MOCSCTF{# MOCSCTF{$ MOCSCTF{% MOCSCTF{&amp; MOCSCTF{&#39; MOCSCTF{( MOCSCTF{) MOCSCTF{*
MOCSCTF{+ MOCSCTF{, MOCSCTF{- MOCSCTF{. MOCSCTF{/ MOCSCTF{: MOCSCTF{; MOCSCTF{&lt;
MOCSCTF{= MOCSCTF{&gt; MOCSCTF{? MOCSCTF{@ MOCSCTF{[ MOCSCTF{\ MOCSCTF{] MOCSCTF{^
MOCSCTF{_ MOCSCTF{` MOCSCTF{{ MOCSCTF{| MOCSCTF{} MOCSCTF{~</code></pre></div>
<p>It became the below after copy-pasting. Note that <code>MOCSCTF{c</code> has been replaced to <code>*********</code> and therefore we know <code>MOCSCTF{c</code> is the prefix of the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">********0 ********1 ********2 ********3 ********4 ********5 ********6 ********7
********8 ********9 ********a ********b ********* ********d ********e ********f
********g ********h ********i ********j ********k ********l ********m ********n
********o ********p ********q ********r ********s ********t ********u ********v
********w ********x ********y ********z ********A ********B ********C ********D
********E ********F ********G ********H ********I ********J ********K ********L
********M ********N ********O ********P ********Q ********R ********S ********T
********U ********V ********W ********X ********Y ********Z ********! ********&#34;
********# ********$ ********% ********&amp; ********&#39; ********( ********) *********
********+ ********, ********- ********. ********/ ********: ********; ********&lt;
********= ********&gt; ********? ********@ ********[ ********\ ********] ********^
********_ ********` ********{ ********| ********} ********~</code></pre></div>
<p>We can obtain the flag by repeating the process.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">MOCSCTF{cryp70curr3ncy_4s537s_4r3_s0m3t1m3s_5tol3n_v1a_cl1pb04rd}</code></pre></div><div class="footnotes">

<hr>

<ol>
<li id="fn:rfc-2104">H. Krawczyk, M. Bellare, R. Canetti (1997) &quot;HMAC: Keyed-Hashing for Message Authentication&quot;<br><a href="https://datatracker.ietf.org/doc/html/rfc2104#section-2">https://datatracker.ietf.org/doc/html/rfc2104#section-2</a>
 <a class="footnote-return" href="#fnref:rfc-2104">↩</a></li>
</ol>
</div>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="/posts/2022-02-14-intigriti-xss/">
                <span class="button__text">Intigriti&#39;s XSS Challenge (February 2022)</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>


<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    MOCSCTF 2022 Postmortem
  </a>
  <div class="js-toc"></div>
</aside>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
      headingSelector: 'h1, h2, h3, h4',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
</script>



  </div>
  <aside class="ads">
    
  
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-3220069814773012"
    data-ad-slot="6927401005"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  </aside>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2022 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }], trust: true })"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
<script>
var viz = new Viz();

document.querySelectorAll("[class=graphviz]").forEach(node => {
  const escape = function (s) {
    const t = s.replace(/&amp;/g, '&')
    return t.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#34;/g, '"')
  }
  viz.renderSVGElement(escape(node.innerText), {
    engine: 'dot'
  }).then(function (element) {
    node.parentNode.appendChild(element)
    node.style.display = 'none'
  })
})
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>

  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180181192-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-180181192-1');
</script>



  
</div>

</body>
</html>
