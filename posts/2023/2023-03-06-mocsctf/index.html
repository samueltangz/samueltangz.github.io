<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>MOCSCTF 2023 Postmortem :: Mystify</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="I prepared three challenges on behalf of @blackb6a for MOCSCTF, which is a 8-hour long CTF happened yesterday. This blogpost serves as the write-up for the three challenges that I wrote.
There are two solves (out of 40 participants) for Three-pass, and zero solves for jav-asr-ipt and Catch-22 Mini.
Three-pass Challenge Summary  Shamir is a famous cryptographer. He invented the three-pass protocol, so I don&amp;rsquo;t see it is unsafe." />
<meta name="keywords" content="ctf" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://mystiz.hk/posts/2023/2023-03-06-mocsctf/" />




<link rel="stylesheet" href="https://mystiz.hk/assets/style.css">

  <link rel="stylesheet" href="https://mystiz.hk/assets/mystiz.css">






<link rel="apple-touch-icon" href="https://mystiz.hk/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://mystiz.hk/img/favicon/mystiz.png">





<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://mystiz.hk/images/2023-03-06-mocsctf/thumbnail.png" />


  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="mystiz613" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="MOCSCTF 2023 Postmortem">
<meta property="og:description" content="I prepared three challenges on behalf of @blackb6a for MOCSCTF, which is a 8-hour long CTF happened yesterday. This blogpost serves as the write-up for the three challenges that I wrote.

There are two solves (out of 40 participants) for Three-pass, and zero solves for jav-asr-ipt and Catch-22 Mini." />
<meta property="og:url" content="https://mystiz.hk/posts/2023/2023-03-06-mocsctf/" />
<meta property="og:site_name" content="Mystify" />

  <meta property="og:image" content="https://mystiz.hk/images/2023-03-06-mocsctf/thumbnail.png">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2023-03-06 00:45:00 &#43;0800 &#43;0800" />












  <script data-ad-client="ca-pub-3220069814773012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>
<body class="mystiz">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Mystify
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about-me">About Me</a></li>
        
      
        
          <li><a href="/blogroll">Blogroll</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about-me">About Me</a></li>
      
    
      
        <li><a href="/blogroll">Blogroll</a></li>
      
    
      
        <li><a href="/crypto-in-ctf">Crypto in CTF</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://mystiz.hk/posts/2023/2023-03-06-mocsctf/">MOCSCTF 2023 Postmortem</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2023-03-06 
      </span>
    
    
    <span class="post-author">:: Mystiz</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://mystiz.hk/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/mocsctf/">mocsctf</a>&nbsp;
    
    #<a href="https://mystiz.hk/tags/challenge-writing/">challenge-writing</a>&nbsp;
    
  </span>
  

  

  
    <img src="https://mystiz.hk/images/2023-03-06-mocsctf/thumbnail.png" class="post-cover center" alt="MOCSCTF 2023 Postmortem" />
  

  <div class="post-content js-toc-content"><div>
        <p>I prepared three challenges on behalf of <a href="https://twitter.com/blackb6a" target="_blank" rel="nofollow">@blackb6a</a> for MOCSCTF, which is a 8-hour long CTF happened yesterday. This blogpost serves as the write-up for the three challenges that I wrote.</p>
<p>There are two solves (out of 40 participants) for <em>Three-pass</em>, and zero solves for <em>jav-asr-ipt</em> and <em>Catch-22 Mini</em>.</p>
<h2 id="three-pass">Three-pass<a href="#three-pass" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary">Challenge Summary<a href="#challenge-summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Shamir is a famous cryptographer. He invented the three-pass protocol, so I don&rsquo;t see it is unsafe.</p>
<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20230304-mocsctf/three-pass/public/chall.py">chall.py</a>, <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20230304-mocsctf/three-pass/public/output.txt">output.txt</a></p>
</blockquote>
<p>Let $(n, e_1)$ and $(n, e_2)$ be the RSA public keys of Alice and Bob, where $d_1$ and $d_2$ are their respective private keys. The flag, $m$, is transmitted from Alice to Bob via a three-pass protocol, specified below:</p>
<ol>
<li>Alice encrypts $m$, i.e., $c_1 := m^{e_1}\ \text{mod}\ n$ and sends it to Bob,</li>
<li>Bob encrypts $c_1$, i.e., $c_2 := {c_1}^{e_2}\ \text{mod}\ n$ and sends it to Alice,</li>
<li>Alice decrypts $c_2$, i.e., $c_3 := {c_2}^{d_1}\ \text{mod}\ n$ and sends it to Bob,</li>
<li>Bob decrypts $c_3$ and obtains the flag.</li>
</ol>
<p>We have intercepted $c_1$, $c_2$ and $c_3$. The objective is to recover the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10964288917862750817371943000644790354245952753624811184742882075573503291159213275792617289565174542016890536882446152316020614664981464561310177070588847541824015432685005516483258970286016579654507584001942145685835639042544771196025875926934824854654629287406804175169781542930744041035961354498413636479318500015887509695151706774163342176270668595764352803054030180712959407702145232968072095960248622217033412500318802588364053218099740479457499745048733598734525822270979536699859476431259697698977724661051925808662192259594147272928685323228026419764554817739443779978259966996524027223685447697163661582141</span>
e_a <span style="color:#f92672">=</span> <span style="color:#ae81ff">7850787509111121843704296046292796209765523362760822778441073322435061020720960202570760122216883325800836925397165034377438443919262547805439050014666281823875017212696850811879873382570464494837703959487875345718181692595018804771684090856135860439183994856735097837364198982869125965085926802347005468560464386462672258583800564648667864628707942109097607368504685011961161864010504692066710237072873338338305230789347300824187187203329273552252494078998862280494814565327762466244260365644318201153240217889101138476813458833584425652814637203342017834450974917962290891504378066826883314533426272066008529842659</span>
e_b <span style="color:#f92672">=</span> <span style="color:#ae81ff">4453987268676227673717138546198543778490256900761885216399493398056068349494658337928641078100794899095850901032758903950680172209634150955381186281328572137323548410693241837784440962944102633978874827798938332394944037503353368648953561717131174637446457475027140019091092814780388647445775628641143448349527427439477564690099543443277709928131151980500888754622299623842491816224578733956512936055767159814756376096327386916365143301608788828874264501835661518243456338370292578817419693818015476586557623659740708608431858063310083629564657171971965399525567277003986302573053057000412895654326773385514407577323</span>
c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">635625603722527732406242842327753945350725694571974401488962916610274697646481993610344372428481397325589618737844538706053099675067921762751397619785858707957914817999667697230069995167574307245259456697677215623906029979279072230370958181299051620924365760774594664872675088357135514004300428557363385290172008755962046341521452462577198740003483664903692948347491024627628714880272778802999826100226453863040788568957321338962180604682917073805800695632705757598907639967058123378499630550480712280533714911130683207438745204963799144060687206195796524968658243175519491950409074500917177663168800511171334501803</span>
c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7795281813608171817794892741379735062226556576265028882723464622060019286100732342981451027687820523245444314645382694811723793808174497214300156934179794205555622005157083862445686945032043405320639519697203684857899172411018428771375767426980596031822470310203233833523614211317164419285700300611034139157137457296864576086638001016651797271883268571688978451037356211059045746855900975366642645162497731774792257449712576044309087316579987978439947563661504990736364718671512316976584629358223866771466264690390020136453075012318174610037220780428939084103590144731860113940987394856986607531349399972658436455908</span>
c3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7977921283916873018972258656375438636109648078403403856621256960780183659895530492670743805496687518166195286817025982922117207776910469434997789880448174416587980565856067901272107239948266338560630544165615179249646506219882043808647728828971598358249751709624378172857533066558532071073613752930847449500166165240327454355080420431675080444647400925253148611373039389289751613423304374279739869798080453011631508870963029540554868047053218458677269611062574257854538626076547078009591179864813931791542273673139423996224246974845576047905869390859665905099569747606150666678631706721843828247029345061154431341829</span>
</code></pre></div><h3 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>If we write $c_1$, $c_2$ and $c_3$ into a relation of $m$, $e_1$, $e_2$ and $n$, they are:</p>
<p>$$\left\{\begin{aligned}
c_1 &amp;= m^{e_1} \ \text{mod}\ n \\
c_2 &amp;= m^{e_1 e_2} \ \text{mod}\ n \\
c_3 &amp;= m^{e_2} \ \text{mod}\ n
\end{aligned}\right..$$</p>
<p>In particular, since $\gcd(e_1, e_2) = 1$, we can obtain $x$ and $y$ such that $x e_1 + y e_2 = 1$ using the extended Euclidean algorithm. In that way we can recover $m$ by computing ${c_1}^x {c_3}^y$, because</p>
<p>$${c_1}^x {c_3}^y = m^{e_1 \cdot x} \cdot m^{e_2 \cdot y} = m^{xe_1 + ye_2} = m^1 = m \ \text{mod}\ n.$$</p>
<p>Therefore we have the flag <code>MOCSCTF{h0w_c0u1d_w3_m4k3_4_s3cur3_7hr33_p4s5}</code>.</p>
<h2 id="jav-asr-ipt">jav-asr-ipt<a href="#jav-asr-ipt" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-1">Challenge Summary<a href="#challenge-summary-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>Mystiz understands that not everyone writes Python. He specifically creates a crypto challenge in Javascript so that you can run on browsers.</p>
<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20230304-mocsctf/jav-asr-ipt/public/app.js">app.js</a>, <a href="https://github.com/samueltangz/ctf-archive-created/blob/master/20230304-mocsctf/jav-asr-ipt/public/output.json">output.json</a></p>
</blockquote>
<p>This challenge implements the RSA algorithm in Javascript. In particular, the below snippet is how the 1024-bit primes $p$ and $q$ are generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generatePrime</span>(<span style="color:#a6e22e">p0</span>) {
  <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">p0</span>
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1022</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
      <span style="color:#66d9ef">if</span> (Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.5</span>) {
        <span style="color:#a6e22e">p</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">BigInt</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#a6e22e">i</span>)
      }
    }
    <span style="color:#75715e">// isPrime implements the Miller-Rabin primality test
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// with the 50 smallest primes.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isPrime</span>(<span style="color:#a6e22e">p</span>)) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>
  }
}

<span style="color:#75715e">// Guaranteed that p - q has a large enough difference:
</span><span style="color:#75715e">// p = 0b11xxx...xxx and q = 0b10xxx...xxx
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">generatePrime</span>(<span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;2&#39;</span>) <span style="color:#f92672">**</span> <span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;1023&#39;</span>))
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">generatePrime</span>(<span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;2&#39;</span>) <span style="color:#f92672">**</span> <span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;1023&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;2&#39;</span>) <span style="color:#f92672">**</span> <span style="color:#a6e22e">BigInt</span>(<span style="color:#e6db74">&#39;1022&#39;</span>))
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">q</span>
</code></pre></div><h3 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>If we look at the <code>generatePrime</code> function, it appears that $p$ is generated by 1022 random bits $x_0, x_1, &hellip;, x_{1021}$, and</p>
<p>$$p = 2^{1023} + x_0 + x_1 \cdot 2 + &hellip; + x_{1021} \cdot 2^{1021}.$$</p>
<p>Similarly for $q$. It seems to depend on 1022 random bits $y_0, y_1, &hellip;, y_{1021}$:</p>
<p>$$q = 2^{1023} + 2^{1022} + y_0 + y_1 \cdot 2 + &hellip; + y_{1021} \cdot 2^{1021}.$$</p>
<p>However, this is not the case. Below is a snippet from the JavaScript documentation on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Left_shift">left shift operator</a>:</p>
<blockquote>
<p>The left shift (<code>&lt;&lt;</code>) operator shifts the first operand the specified number of bits, modulo 32, to the left&hellip;</p>
</blockquote>
<p>With that said, when $i \geq 32$, $b_i$ are shifted $i \ \text{mod}\ 32$ bits instead of $i$ bits. Additionally, <code>1&lt;&lt;31</code> equals to $-2^{31}$.</p>
<p>For instance, $p$ is still generated by $x_0, x_1, &hellip;, x_{1021}$, but</p>
<p>$$\begin{aligned}
p &amp;= 2^{1023} - 2^{31} (x_{31} + x_{63} + &hellip; + x_{991}) + 2^{30} (x_{30} + x_{62} + &hellip; + x_{990}) \\
&amp; \qquad + 2^{29} (x_{29} + x_{61} + &hellip; + x_{1021}) + &hellip; + (x_0 + x_{32} + &hellip; + x_{992}).
\end{aligned}$$</p>
<p>Since $x_0, x_1, &hellip;, x_{1021}$ are either 0 or 1, we can see that the upper bound of $p$ being</p>
<p>$$\begin{aligned}
p &amp;&lt; 2^{1023} - 2^{31} (0 + 0 + &hellip; + 0) + 2^{30} (1 + 1 + &hellip; + 1) \\
&amp; \qquad + 2^{29} (1 + 1 + &hellip; + 1) + &hellip; + (1 + 1 + &hellip; + 1) \\
&amp; = 2^{1023} + 2^{30} \cdot 31 + 2^{29} \cdot 32 + &hellip; + 32 \\
&amp; &lt; 2^{1023} + 2^{30} \cdot 32 + 2^{29} \cdot 32 + &hellip; + 32 \\
&amp; &lt; 2^{1023} + 2^{31} \cdot 32 = 2^{1023} + 2^{36},
\end{aligned}$$</p>
<p>and its lower bound being</p>
<p>$$\begin{aligned}
p &amp;&gt; 2^{1023} - 2^{31} (1 + 1 + &hellip; + 1) + 2^{30} (0 + 0 + &hellip; + 0) \\
&amp; \qquad + 2^{29} (0 + 0 + &hellip; + 0) + &hellip; + (0 + 0 + &hellip; + 0) \\
&amp; = 2^{1023} - 2^{31} \cdot 31 &gt; 2^{1023} - 2^{31} \cdot 32 = 2^{1023} - 2^{36}.
\end{aligned}$$</p>
<p>Thus we have $2^{1023} - 2^{36} &lt; p &lt; 2^{1023} + 2^{36}$. Similarly $3 \cdot 2^{1022} - 2^{36} &lt; q &lt; 3 \cdot 2^{1022} + 2^{36}$. We can obtain $p$ by exhausting the values in $(2^{1023} - 2^{36}, 2^{1023} + 2^{36})$ and check if it is a factor of $n$.</p>
<h4 id="recover-p-and-q-mathematically">Recover $p$ and $q$ mathematically<a href="#recover-p-and-q-mathematically" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>This is an alternate solution apart from the brute-force approach.</p>
<p>Let $-2^{36} &lt; \Delta p, \Delta q &lt; 2^{36}$ such that</p>
<p>$$\left\{\begin{aligned}
p &amp;= 2^{1023} + \Delta p \\
q &amp;= 3 \cdot 2^{1022} + \Delta q
\end{aligned}\right.$$</p>
<p>Then $n = pq = (2^{1023} + \Delta p)(3 \cdot 2^{1022} + \Delta q) = 6 \cdot 2^{2044} + 2^{1022} \cdot (3 \Delta p + 2 \Delta q) + \Delta p \cdot \Delta q$.</p>
<p>We can compute $n\ \text{mod}\ 2^{1022}$ to obtain $\Delta p \cdot \Delta q$. With that, we can deduce $3 \Delta p + 2 \Delta q$ as</p>
<p>$$3 \Delta p + 2 \Delta q = (n - 6 \cdot 2^{2044} - \Delta p \cdot \Delta q) / 2^{1022}.$$</p>
<p>Let $v := \Delta p \cdot \Delta q$ and $u := 3 \Delta p + 2 \Delta q$ be the values we obtained. We can combine both relations as a quadratic equation in $\Delta p$:</p>
<p>$$- 3 \Delta p^2 + u \cdot \Delta p - 2v = 0.$$</p>
<p>By solving the quadratic equation, we can obtain $\Delta p$ and is able to factor $n$.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000068b26bb1</span>
q <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001772381d5</span>
</code></pre></div><p>After that, we can compute the private key $d$ and obtain the flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">MOCSCTF{why_d0_w3_t4ke_m0d_32_to_th3_s3c0nd_op3r4nd}
</code></pre></div><h2 id="catch-22-mini">Catch-22 Mini<a href="#catch-22-mini" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="challenge-summary-2">Challenge Summary<a href="#challenge-summary-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>You need a key to open the door&hellip; but what if the key is in the room?</p>
<p>By the way, if you find this challenge similar to HKCERT CTF 2022&rsquo;s &ldquo;Catch-22&rdquo;, it is. I literally plagarized that, except that:</p>
<ol>
<li>I used CBC instead of ECB to encrypt the token, and</li>
<li>I made the map a little bit smaller, and</li>
<li>I changed the category from crypto to misc,</li>
<li>I refacted the code a little bit to make the logic clearer.</li>
</ol>
<p>Not a solution: <a href="https://hackmd.io/@blackb6a/hkcert-ctf-2022-ii-en-6a196795">https://hackmd.io/@blackb6a/hkcert-ctf-2022-ii-en-6a196795</a></p>
<p>By the way, if you want the source code for Catch-22, there you go: <a href="https://github.com/samueltangz/ctf-archive-created/tree/master/20221111-hkcert-ctf/catch-22/public">https://github.com/samueltangz/ctf-archive-created/tree/master/20221111-hkcert-ctf/catch-22/public</a></p>
<p>http://HOST:PORT/</p>
<p>Attachments: <a href="https://github.com/samueltangz/ctf-archive-created/tree/master/20230304-mocsctf/catch-22/public">source.zip</a></p>
</blockquote>
<p>We are given another web game. The player can navigate in the map and the goal is to access the flag.</p>

  <figure class="center" >
    <img src="/images/2023-03-06-mocsctf/catch-22-summary.png"   />
    
  </figure>


<h3 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="alert info">
  🎉 <strong>Credits.</strong> Thanks <em>@LifeIsHard</em> for testing the challenge and giving comments before it is released.
</div>

<h4 id="comparing-catch-22-and-catch-22-mini">Comparing Catch-22 and Catch-22 Mini<a href="#comparing-catch-22-and-catch-22-mini" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Since <em>Catch-22</em> is similar to <em>Catch-22 Mini</em>, let&rsquo;s look at the code and see the diff betwen the two challenges:</p>
<pre tabindex="0"><code class="language-diff-js&nbsp;diff-highlight" data-lang="diff-js&nbsp;diff-highlight">  /* src/app.js */

      const newToken = encryptToken({
        username,
-       x: 13,
-       y: 5,
+       x: 5,
+       y: 1,
        inventory: [],
        onMapItems: [
-         {item: ITEMS.KEY, x: 3, y: 4},
-         {item: ITEMS.DOOR, x: 4, y: 5},
-         {item: ITEMS.DOOR, x: 5, y: 5},
-         {item: ITEMS.DOOR, x: 6, y: 5},
-         {item: ITEMS.KEY, x: 15, y: 1},
+         {item: ITEMS.KEY, x: 2, y: 0},
+         {item: ITEMS.DOOR, x: 3, y: 1}
        ]
      })
</code></pre><pre tabindex="0"><code class="language-diff-js&nbsp;diff-highlight" data-lang="diff-js&nbsp;diff-highlight">  /* src/actions.js */

  function isWalkable (x, y, state) {
    // You should not walk out of bounds
    if (x &lt; 0 || x &gt;= MAP.length) return false
    if (y &lt; 0 || y &gt;= MAP[x].length) return false

    // You should not walk more than one blocks away
    if (Math.abs(state.x - x) + Math.abs(state.y - y) != 1) return false
    
    // You should not walk if there is a door blocking
    if (state.onMapItems.find(item =&gt; item.x === x &amp;&amp; item.y === y &amp;&amp; item.item === ITEMS.DOOR)) return false

-   return [TILES.PATH, TILES.PATH_WITH_FLAG].includes(MAP[x][y])
+   // Update by Mystiz at (2022.12.27): Use &quot;not wall&quot; to determine for simplicity.
+   // return [TILES.PATH, TILES.PATH_WITH_FLAG].includes(MAP[x][y])
+   return ![TILES.WALL].includes(MAP[x][y])
  }
</code></pre><pre tabindex="0"><code class="language-diff-js&nbsp;diff-highlight" data-lang="diff-js&nbsp;diff-highlight">  /* src/constants.js */

  const MAP = [
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.PATH_WITH_FLAG, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.PATH, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.PATH, TILES.WALL],
-   [TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL, TILES.WALL],
+   [TILES.PATH, TILES.PATH_WITH_FLAG, TILES.PATH],
+   [TILES.PATH, TILES.PATH, TILES.PATH],
+   [TILES.PATH, TILES.PATH, TILES.PATH],
+   [TILES.WALL, TILES.PATH, TILES.WALL],
+   [TILES.PATH, TILES.PATH, TILES.PATH],
+   [TILES.PATH, TILES.PATH, TILES.PATH],
+   [TILES.PATH, TILES.PATH, TILES.PATH],
  ]
</code></pre><pre tabindex="0"><code class="language-diff-js&nbsp;diff-highlight" data-lang="diff-js&nbsp;diff-highlight">  /* src/util.js */

  function encryptToken (state) {
    const token = JSON.stringify(state)
-   const cipher = crypto.createCipheriv('aes-128-ecb', key, null)
+   const cipher = crypto.createCipheriv('aes-128-cbc', key, Buffer.alloc(16))
    cipher.setAutoPadding(true)
    const encryptedToken = Buffer.concat([
+     Buffer.alloc(16),
      cipher.update(token),
      cipher.final()
    ])
    return encryptedToken.toString('hex')
  }

  function decryptToken (encryptedTokenHex) {
    const encryptedToken = Buffer.from(encryptedTokenHex, 'hex')
-   const cipher = crypto.createDecipheriv('aes-128-ecb', key, null)
+   const cipher = crypto.createDecipheriv('aes-128-cbc', key, encryptedToken.slice(0, 16))
    cipher.setAutoPadding(true)
    const token = Buffer.concat([
-     cipher.update(encryptedToken),
+     cipher.update(encryptedToken.slice(16)),
      cipher.final()
    ]).toString()
    const state = JSON.parse(token)
    return { token, state }
  }
</code></pre><ul>
<li><code>src/app.js</code> changes the initial position of the player (from $(13, 5)$ to $(5, 1)$) and updated the items on the map (removed one key and two doors).</li>
<li><code>src/actions.js</code> replaces the <code>isWalkable</code> logic by using a blocklist instead of an allowlist.</li>
<li><code>src/constants.js</code> defines a smaller map in play.</li>
<li><code>src/util.js</code> uses AES-CBC to encrypt tokens (instead of AES-ECB) to mitigate the cut-and-paste attack.</li>
</ul>
<h4 id="the-mysterious-1--varepsilon--1">The mysterious $1 + \varepsilon = 1$<a href="#the-mysterious-1--varepsilon--1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>The intended vulnerability this time was introduced by the new <code>isWalkable</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isWalkable</span> (<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>, <span style="color:#a6e22e">state</span>) {
  <span style="color:#75715e">// You should not walk out of bounds
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">MAP</span>.<span style="color:#a6e22e">length</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">y</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">MAP</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">length</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

  <span style="color:#75715e">// You should not walk more than one blocks away
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">+</span> Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
  
  <span style="color:#75715e">// You should not walk if there is a door blocking
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">onMapItems</span>.<span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">item</span> =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">item</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">ITEMS</span>.<span style="color:#a6e22e">DOOR</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

  <span style="color:#75715e">// Update by Mystiz at (2022.12.27): Use &#34;not wall&#34; to determine for simplicity.
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// return [TILES.PATH, TILES.PATH_WITH_FLAG].includes(MAP[x][y])
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">!</span>[<span style="color:#a6e22e">TILES</span>.<span style="color:#a6e22e">WALL</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">MAP</span>[<span style="color:#a6e22e">x</span>][<span style="color:#a6e22e">y</span>])
}
</code></pre></div><p>Previously in <em>Catch-22</em>, the destination tile was required to be either <code>TILES.PATH</code> or <code>TILES.PATH_WITH_FLAG</code> for the player to walk on. It is changed so that the tile is not <code>TILES.WALL</code>. Although they seemed equivalent, they are not. You can now walk on a tile if it is <code>undefined</code>.</p>
<p>However, how do we walk on an <em>undefined</em> tile? Note that <code>x</code> and <code>y</code> need not to be integers. It is pretty tricky. For instance, if we are at $(5, 1)$, we cannot move to $(4.5, 1.5)$ because <code>MAP[4.5]</code> is <code>undefined</code>. <code>MAP[4.5][1.5]</code> would raise an <code>TypeError</code>, saying that we cannot read properties of undefined.</p>
<p>To make <code>MAP[x][y]</code> undefined, we have to let <code>MAP[x]</code> returning an array first. With that said, <code>x</code> should be an integer and at the same time <code>y</code> should not. At $(4, 0)$, we can move to $(3, 0.0000000000000001)$. Let&rsquo;s look at the checks one by one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// x = 3: it falls within 0 &lt;= x &lt; MAP.length = 7.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">MAP</span>.<span style="color:#a6e22e">length</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

<span style="color:#75715e">// y = 0.0000000000000001: it falls within 0 &lt;= y &lt; MAP[3].length = 3.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">y</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">MAP</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">length</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

<span style="color:#75715e">// |4 - 3| + |0 - 0.0000000000000001| = 1.0000000000000001...
</span><span style="color:#75715e">// ❗ should be returning false here?
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">x</span>) <span style="color:#f92672">+</span> Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">y</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

<span style="color:#75715e">// There is no onMapItems having coordinates (3, 0.0000000000000001).
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">onMapItems</span>.<span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">item</span> =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">item</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">ITEMS</span>.<span style="color:#a6e22e">DOOR</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>

<span style="color:#75715e">// Since MAP[3][0.0000000000000001] is undefined, it is not equal to TILES.WALL.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> <span style="color:#f92672">!</span>[<span style="color:#a6e22e">TILES</span>.<span style="color:#a6e22e">WALL</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">MAP</span>[<span style="color:#a6e22e">x</span>][<span style="color:#a6e22e">y</span>])
</code></pre></div><p>Let&rsquo;s have a little experiment on the Javascript console. The second line returns <code>1</code> instead of <code>1.0000000000000001</code> because Javascript follows IEEE754 for floating point numbers, which has a 53-bit precision:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.0000000000000001</span> <span style="color:#75715e">// outputs 1e-16
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.0000000000000001</span> <span style="color:#75715e">// outputs 1
</span></code></pre></div><p>With the above property, we can write a Javascript snippet and paste to the console (after the player enters the grid) to grab the flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">move</span>(<span style="color:#a6e22e">dx</span>, <span style="color:#a6e22e">dy</span>) { <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">_action</span>({<span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;move&#39;</span>, <span style="color:#a6e22e">dx</span>, <span style="color:#a6e22e">dy</span>}) }
<span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pickFlag</span>() { <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">_action</span>({<span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;pick-flag&#39;</span>}) }

<span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)                   <span style="color:#75715e">// (5, 1) -&gt; (5, 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)                   <span style="color:#75715e">// (5, 0) -&gt; (4, 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0.0000000000000001</span>)  <span style="color:#75715e">// (4, 0) -&gt; (3, 0.0000000000000001)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">0.0000000000000001</span>) <span style="color:#75715e">// (3, 0.0000000000000001) -&gt; (2, 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)                   <span style="color:#75715e">// (2, 0) -&gt; (1, 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)                   <span style="color:#75715e">// (1, 0) -&gt; (0, 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">move</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)                    <span style="color:#75715e">// (0, 0) -&gt; (0, 1)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">pickFlag</span>()
</code></pre></div>
  <figure class="center" >
    <img src="/images/2023-03-06-mocsctf/catch-22-flag.webp"   />
    
      <figcaption class="right" >Running the script in action.</figcaption>
    
  </figure>


<p>Running the script, we can get the flag <code>MOCSCTF{n0w_y0u_c4n_cl1p_thr0u9h}</code>.</p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://mystiz.hk/posts/2023/2023-03-12-idekctf/">
                <span class="button__icon">←</span>
                <span class="button__text">idekCTF 2022* Writeup</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://mystiz.hk/posts/2023/2023-01-30-firebird-internal-ctf/">
                <span class="button__text">Firebird Internal CTF 2023 Writeup</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>


<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    MOCSCTF 2023 Postmortem
  </a>
  <div class="js-toc"></div>
</aside>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
      headingSelector: 'h1, h2, h3, h4',
      orderedList: false,
      headingLabelCallback: s => s.substr(0, s.length-2),
      collapseDepth: 2
  });
</script>



  </div>
  <aside class="ads">
    
  
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-3220069814773012"
    data-ad-slot="6927401005"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  </aside>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://mystiz.hk/assets/main.js"></script>
<script src="https://mystiz.hk/assets/prism.js"></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }], trust: true })"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
<script>
var viz = new Viz();

document.querySelectorAll("[class=graphviz]").forEach(node => {
  const escape = function (s) {
    const t = s.replace(/&amp;/g, '&')
    return t.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#34;/g, '"')
  }
  viz.renderSVGElement(escape(node.innerText), {
    engine: 'dot'
  }).then(function (element) {
    node.parentNode.appendChild(element)
    node.style.display = 'none'
  })
})
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>
<link href="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram-min.min.css" rel="stylesheet" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-min.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram.min.js" crossorigin="anonymous"
  onload="
    Array.from(document.getElementsByClassName('sequence-diagram')).forEach(dom => {
      const content = new DOMParser().parseFromString(dom.innerHTML, 'text/html').documentElement.textContent;
      dom.innerHTML = '';
      Diagram.parse(content).drawSVG(dom, {
        theme: 'simple',
        'font-family': 'Fira Code'
      })
    })"></script>


  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VLBDVW913"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2VLBDVW913');
</script>




  
</div>

</body>
</html>
